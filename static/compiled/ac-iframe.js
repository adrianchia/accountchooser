(function(){var a=void 0,g=!0,h=null,i=!1,j=window,l=document,n=JSON;function o(b,c){return b.toJSON=c}
var p="origin",q="replace",r="data",s="trim",t="setAttribute",u="attachEvent",v="getTime",w="documentElement",x="toString",y="toJSON",z="split",A="localStorage",B="parent",C="removeItem",D="displayName",E="isArray",F="postMessage",G="push",H="Request",I="stringify",J="indexOf",K="param",L="parse",M="length",N="prototype",O="clientWidth",P="document",Q="body",R="call",S="clientHeight",T="toLowerCase",U="",aa=" from ",ba='" is invalid.',ca="&",da="(^|;) ?",ea="*",fa="2.0",ga="; Path=/; expires=",V=
"=",ha="=([^;]*)(;|$)",ia="=; Path=/; expires=",W="?",ja="@",ka="Clear CDS browser config.",la="Error request format: ",ma="Failed to clear from cookie: ",na="Failed to clear from localStorage: ",oa="Failed to parse request: ",pa="Failed to read from cookie: ",qa="Failed to read from localStorage: ",ra="Failed to write to cookie: ",sa="Failed to write to localStorage: ",ta="Get CDS browser config: ",ua="Ignore expired JSON-RPC object: [",va="Ignore invalid JSON-RPC object: [",wa="Invalid JSON-RPC object: not a JSON object.",
xa="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",ya="Invalid parameter",za="MSIE",Aa="Method not found",Ba="Parameter %%param%% cannot be an empty array.",X="Parameter %%param%% cannot be empty.",Ca="Parameter %%param%% cannot be null.",Da="Parameter %%param%% is not a function.",Ea="Parameter %%param%% is not an array.",Fa="Read saved accounts from storage: ",Ga="Received message: ",Ha="Register handler for postMessage failed.",Ia="Save accounts to storage: ",Ja="Send message: ",Ka=
"Service is disabled. Method is not available.",La="Set CDS browser config: ",Ma="Successfully parsing request: ",Na='The query "',Oa="Unrecognized rpcObject: ",Pa="[object Array]",Qa="[object Function]",Ra="]",Sa="account",Ta="chooserAccounts",Ua="cookieName",Va="disabled",Wa="form",Xa="handler",Ya="hidden",Y="id",Za="input",$a="localStorage",ab="localStorageKey",bb="message",cb="name",db="object",eb="onmessage",fb="opt_cookieName",gb="opt_localStorageKey || opt_cookieName",hb="parentClass",ib="post",
jb="query",kb="requestId",lb="serviceName",mb="targetWindow",nb="type",ob="value",Z;j.accountchooser=j.accountchooser||{};j.cds=j.accountchooser;j.accountchooser.util=j.accountchooser.util||{};j.accountchooser.util.log=function(b){try{j.console&&j.console.log&&j.console.log(b)}catch(c){}};j.accountchooser.util.uuidCounter_=(new Date)[v]();j.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++j.accountchooser.util.uuidCounter_};
j.accountchooser.util.createForm_=function(b,c,d){if(!b)throw"The targetUrl cannot be null.";var e=j[P].createElement(Wa);e.method=ib;e.action=b;if(c)for(var f in c)b=j[P].createElement(Za),b[t](nb,Ya),b[t](cb,f),c[f]===h||c[f]===a?b[t](ob,U):b[t](ob,c[f]),e.appendChild(b);d&&(e.target=d);j[P][Q].appendChild(e);return e};j.accountchooser.util.postTo=function(b,c,d){b=j.accountchooser.util.createForm_(b,c,d);b.submit();j[P][Q].removeChild(b)};
j.accountchooser.util.parseUrlParams=function(b){for(var c={},b=b.slice(b[J](W)+1)[z](ca),d=0;d<b[M];d++){var e=b[d][z](V);c[e[0]]=2==e[M]?decodeURIComponent(e[1]):a}return c};j.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[J](W)),e=j.accountchooser.util.parseUrlParams(b);j.accountchooser.util.postTo(d,e,c)};j.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=navigator.appVersion[J](za)&&(b=parseFloat(navigator.appVersion[z](za)[1]));return 7<b};
j.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[G](c[e]?e+V+c[e]:e);return b+W+d.join(ca)};j.accountchooser.util.isArray=function(b){return"undefined"!==typeof jQuery?jQuery[E](b):Object[N][x][R](b)===Pa};j.accountchooser.util.isFunction=function(b){return"undefined"!==typeof jQuery?jQuery.isFunction(b):Object[N][x][R](b)===Qa};
j.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(b,c);if(c[J])return c[J](b);for(var d=c[M],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};j.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof jQuery)return jQuery(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[P]&&b[P][w]&&b[P][w][O]?c=b[P][w][O]:b[P]&&(b[P][Q]&&b[P][Q][O])&&(c=b[P][Q][O]);return c};
j.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof jQuery)return jQuery(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[P]&&b[P][w]&&b[P][w][S]?c=b[P][w][S]:b[P]&&(b[P][Q]&&b[P][Q][S])&&(c=b[P][Q][S]);return c};j.accountchooser.util.trim=function(b){return"undefined"!==typeof jQuery?jQuery[s](b):b==h?U:String[N][s]?String[N][s][R](b):b[q](/^[\s\xa0]+/,U)[q](/[\s\xa0]+$/,U)};
j.accountchooser.util.extend=function(b,c,d){if(3>arguments[M])return c||{};if("undefined"!==typeof jQuery){var e=Array[N].slice[R](arguments,b?0:1);return jQuery.extend.apply(jQuery,e)}if(typeof c!==db||c==h)c={};for(var e=2,f=arguments[M];e<f;e++){var k=arguments[e];if(k!=h)for(var m in k)k[m]===a||c===k[m]||(b&&typeof k[m]==db?(j.accountchooser.util[E](k[m])&&!j.accountchooser.util[E](c[m])&&(c[m]=[]),c[m]=j.accountchooser.util.extend(g,c[m],k[m])):c[m]=k[m])}return c};j.accountchooser.param={};
j.accountchooser[K].notNull=function(b,c){(b===a||b===h)&&j.accountchooser[K].throwError_(Ca,c)};j.accountchooser[K].notEmpty=function(b,c){b||j.accountchooser[K].throwError_(X,c)};j.accountchooser[K].notEmptyArray=function(b,c){b||j.accountchooser[K].throwError_(X,c);j.accountchooser.util[E](b)||j.accountchooser[K].throwError_(Ea,c);b[M]||j.accountchooser[K].throwError_(Ba,c)};
j.accountchooser[K].notEmptyFunction=function(b,c){b||j.accountchooser[K].throwError_(X,c);j.accountchooser.util.isFunction(b)||j.accountchooser[K].throwError_(Da,c)};j.accountchooser[K].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}throw b[q](/\%\%param\%\%/g,c?" '"+c+"'":U);};Function[N].inheritsFrom=function(b){j.accountchooser[K].notEmptyFunction(b,hb);this.prototype=new b;this[N].constructor=this;this[N].parentClass=b[N]};
j.accountchooser.util.VALID_EMAIL_REGEX_=/^\w+(\.\w+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.isValidEmail=function(b){return b&&h!=j.accountchooser.util.VALID_EMAIL_REGEX_.exec(b)};j.accountchooser.util.isValidDomain=function(b){return b&&h!=j.accountchooser.util.VALID_DOMAIN_REGEX_.exec(b)};j.accountchooser.util.getEmailDomain=function(b){if((b=j.accountchooser.util[s](b))&&j.accountchooser.util.isValidEmail(b))return b[z](ja)[1][T]()};
j.accountchooser.util.getEmailUsername=function(b){if((b=j.accountchooser.util[s](b))&&j.accountchooser.util.isValidEmail(b))return b[z](ja)[0][T]()};j.accountchooser.util.isDomainInNascar=function(b){if(b){var c=j.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};
j.accountchooser.util.Storage=function(b,c){j.accountchooser[K].notEmpty(b||c,gb);j.accountchooser.util.Storage.isLocalStorageSupported()||j.accountchooser[K].notEmpty(c,fb);this.localStorageKey_=b;this.cookieName_=c};j.accountchooser.util.Storage.isLocalStorageSupported=function(){try{return $a in j&&j[A]!==h}catch(b){return i}};Z=j.accountchooser.util.Storage[N];
Z.read=function(){if(j.accountchooser.util.Storage.isLocalStorageSupported()&&this.isLocalStorageAllowed_())return this.readFromLocalStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(b){j.accountchooser.util.Storage.isLocalStorageSupported()&&this.isLocalStorageAllowed_()?this.writeToLocalStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};
Z.clear=function(){j.accountchooser.util.Storage.isLocalStorageSupported()&&this.isLocalStorageAllowed_()&&this.clearFromLocalStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isLocalStorageAllowed_=function(){return!!this.localStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromLocalStorage_=function(){j.accountchooser[K].notEmpty(this.localStorageKey_,ab);try{var b=j[A].getItem(this.localStorageKey_);if(b)return n[L](b)}catch(c){j.accountchooser.util.log(qa+c)}};Z.writeToLocalStorage_=function(b){j.accountchooser[K].notEmpty(this.localStorageKey_,ab);try{var c=n[I](b);j[A].setItem(this.localStorageKey_,c)}catch(d){j.accountchooser.util.log(sa+d)}};
Z.clearFromLocalStorage_=function(){j.accountchooser[K].notEmpty(this.localStorageKey_,ab);try{j[A][C](this.localStorageKey_)}catch(b){j.accountchooser.util.log(na+b)}};Z.readFromCookie_=function(){j.accountchooser[K].notEmpty(this.cookieName_,Ua);var b=l.cookie.match(da+this.cookieName_+ha);if(b&&(b=j.accountchooser.util[s](b[2])))try{return n[L](unescape(b))}catch(c){j.accountchooser.util.log(pa+c)}};
Z.writeToCookie_=function(b){j.accountchooser[K].notEmpty(this.cookieName_,Ua);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),k=new Date(d,e,f);l.cookie=this.cookieName_+V+escape(n[I](b))+ga+k.toGMTString()}catch(m){j.accountchooser.util.log(ra+m)}};Z.clearFromCookie_=function(){j.accountchooser[K].notEmpty(this.cookieName_,Ua);try{var b=new Date;b.setTime(b[v]()-1);l.cookie=this.cookieName_+ia+b.toGMTString()}catch(c){j.accountchooser.util.log(ma+c)}};
j.accountchooser.util.accountstorage={};j.accountchooser.util.accountstorage.ACCOUNTS_=Ta;j.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_,j.accountchooser.util.accountstorage.AC_COOKIE_NAME_);j.accountchooser.util.accountstorage.read_=function(){var b=j.accountchooser.util.accountstorage.storage_.read();j.accountchooser.util.log(Fa+n[I](b));return b};
j.accountchooser.util.accountstorage.write_=function(b){j.accountchooser.util.log(Ia+n[I](b));j.accountchooser.util.accountstorage.storage_.write(b)};j.accountchooser.util.accountstorage.readAccounts=function(){var b=j.accountchooser.util.accountstorage.read_();if(!b||!j.accountchooser.util[E](b))b=[];return b};
j.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[M];f++)if(j.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=g;break}if(e&&(!b[D]&&e[D]&&(b.displayName=e[D]),!b.photoUrl&&e.photoUrl))b.photoUrl=e.photoUrl;d.unshift(b);j.accountchooser.util.accountstorage.write_(d);return!c};
j.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[M];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=g;break}j.accountchooser.util.accountstorage.write_(d);return c};j.accountchooser.util.accountstorage.clearAccounts=function(){j.accountchooser.util.accountstorage.storage_.clear()};
j.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=j.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[M];f++)if(j.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);j.accountchooser.util.accountstorage.write_(e);break}};
j.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&j.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[D]&&(c.displayName=b[D]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=a&&(c.legacy=b.legacy)})};
j.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[M];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);j.accountchooser.util.accountstorage.write_(d);return f}};j.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?i:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?g:i};j.accountchooser.updateSavedAccount=function(b){j.accountchooser.util.accountstorage.addAccount(b)};
j.accountchooser.removeSavedAccount=function(b){return j.accountchooser.util.accountstorage.removeAccount(b)};j.accountchooser.clearSavedAccounts=function(){j.accountchooser.util.accountstorage.clearAccounts()};j.accountchooser.util.accountstorage.ACCOUNTS_=Ta;j.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__cds__ac__";j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_,j.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
j.accountchooser.util.accountstorage.readAccounts=function(b){var c=j.accountchooser.util.accountstorage.read_();if(!c||!j.accountchooser.util[E](c))c=[];if(!b)return c;if(b.withEmail)var d=function(b){return j.accountchooser.util.isValidEmail(b.email)},c=j.accountchooser.util.accountstorage.filter_(c,d);b.idpList&&0!=b.idpList[M]&&(d=function(c){return(c=c.providerId||j.accountchooser.util.getEmailDomain(c.email))?0<=j.accountchooser.util[J](c,b.idpList):i},c=j.accountchooser.util.accountstorage.filter_(c,
d));return c};j.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[M];e++)c(b[e])&&d[G](b[e]);return d};j.accountchooser.util.browserconfig={};j.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";j.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";j.accountchooser.util.browserconfig.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.browserconfig.SETTINGS_KEY_,j.accountchooser.util.browserconfig.COOKIE_NAME_);
j.accountchooser.util.browserconfig.getAll=function(){var b=j.accountchooser.util.browserconfig.storage_.read()||{};j.accountchooser.util.log(ta+n[I](b));return b};j.accountchooser.util.browserconfig.setAll=function(b){j.accountchooser.util.log(La+n[I](b));j.accountchooser.util.browserconfig.storage_.write(b)};j.accountchooser.util.browserconfig.clearAll=function(){j.accountchooser.util.log(ka);j.accountchooser.util.browserconfig.storage_.clear()};j.accountchooser.util.browserconfig.get=function(b){return j.accountchooser.util.browserconfig.getAll()[b]};
j.accountchooser.util.browserconfig.set=function(b,c){var d=j.accountchooser.util.browserconfig.getAll();d[b]=c;j.accountchooser.util.browserconfig.setAll(d)};j.accountchooser.util.browserconfig.clear=function(b){var c=j.accountchooser.util.browserconfig.getAll();delete c[b];j.accountchooser.util.browserconfig.setAll(c)};j.accountchooser.util.browserconfig.isDisabled=function(){return!!j.accountchooser.util.browserconfig.get(Va)};
j.accountchooser.util.browserconfig.setDisabled=function(b){j.accountchooser.util.browserconfig.set(Va,!!b)};j.accountchooser.rpc=j.accountchooser.rpc||{};j.accountchooser.rpc.RpcObject=function(){};j.accountchooser.rpc.RpcObject[N].setTimestamp=function(b){this.timestamp_=b||(new Date)[v]()};o(j.accountchooser.rpc.RpcObject[N],function(){var b={jsonrpc:fa};this.timestamp_&&(b.timestamp=this.timestamp_);return b});j.accountchooser.rpc.RpcObject[N].toString=function(){return n[I](this[y]())};
j.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.AbstractRequest.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.AbstractRequest[N];Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};
o(Z,function(){var b=j.accountchooser.rpc.RpcObject[N][y][R](this);this.method_&&(b.method=this.method_);this.params_&&(b.params=this.params_);return b});j.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.Notification.inheritsFrom(j.accountchooser.rpc.AbstractRequest);j.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};j.accountchooser.rpc[H].inheritsFrom(j.accountchooser.rpc.AbstractRequest);
j.accountchooser.rpc[H][N].setId=function(b){this.id_=b};j.accountchooser.rpc[H][N].getId=function(){return this.id_};o(j.accountchooser.rpc[H][N],function(){var b=j.accountchooser.rpc.AbstractRequest[N][y][R](this);this.id_&&(b.id=this.id_);return b});j.accountchooser.rpc.Response=function(b,c,d){j.accountchooser[K].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};j.accountchooser.rpc.Response.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.Response[N];Z.getResult=function(){return this.result_};
Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};o(Z,function(){var b=j.accountchooser.rpc.RpcObject[N][y][R](this);b.id=this.id_;this.result_?b.result=this.result_:this.error_&&(b.error=this.error_);return b});
j.accountchooser.rpc.RequestAckNotification=function(b){j.accountchooser[K].notEmpty(b,kb);this.method_=j.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};j.accountchooser.rpc.RequestAckNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";j.accountchooser.rpc.RequestAckNotification[N].setRequestId=function(b){this.params_.requestId=b};
j.accountchooser.rpc.RequestAckNotification[N].getRequestId=function(){return this.params_.requestId};j.accountchooser.rpc.CdsReadyNotification=function(){this.method_=j.accountchooser.rpc.CdsReadyNotification.METHOD};j.accountchooser.rpc.CdsReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";j.accountchooser.rpc.ClientReadyNotification=function(){this.method_=j.accountchooser.rpc.ClientReadyNotification.METHOD};
j.accountchooser.rpc.ClientReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";j.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=j.accountchooser.rpc.EmptyResponseNotification.METHOD};j.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";
j.accountchooser.rpc.StoreRequest=function(b,c,d,e){j.accountchooser[K].notEmpty(b,Y);j.accountchooser[K].notEmpty(c,Sa);this.method_=j.accountchooser.rpc.StoreRequest.METHOD;this.params_={account:c,localAccounts:d,clientConfig:e};this.id_=b};j.accountchooser.rpc.StoreRequest.inheritsFrom(j.accountchooser.rpc[H]);j.accountchooser.rpc.StoreRequest.METHOD="store";
j.accountchooser.rpc.SelectRequest=function(b,c,d){j.accountchooser[K].notEmpty(b,Y);this.method_=j.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.SelectRequest.inheritsFrom(j.accountchooser.rpc[H]);j.accountchooser.rpc.SelectRequest.METHOD="select";
j.accountchooser.rpc.UpdateRequest=function(b,c,d){j.accountchooser[K].notEmpty(b,Y);j.accountchooser[K].notEmpty(c,Sa);this.method_=j.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.UpdateRequest.inheritsFrom(j.accountchooser.rpc[H]);j.accountchooser.rpc.UpdateRequest.METHOD="update";
j.accountchooser.rpc.ManageRequest=function(b,c){j.accountchooser[K].notEmpty(b,Y);this.method_=j.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};j.accountchooser.rpc.ManageRequest.inheritsFrom(j.accountchooser.rpc[H]);j.accountchooser.rpc.ManageRequest.METHOD="manage";
j.accountchooser.rpc.QueryRequest=function(b,c,d,e){j.accountchooser[K].notEmpty(b,Y);j.accountchooser[K].notEmpty(c,jb);this.method_=j.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};j.accountchooser.rpc.QueryRequest.inheritsFrom(j.accountchooser.rpc[H]);j.accountchooser.rpc.QueryRequest.METHOD=jb;j.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};
j.accountchooser.rpc.parseRpcObject=function(b){var c=h;if(b){try{var d=n[L](b)}catch(e){return j.accountchooser.util.log(wa),c}if(!d||d.jsonrpc!=fa)j.accountchooser.util.log(xa);else if(d.method){var f=d.method[T]();f==j.accountchooser.rpc.StoreRequest.METHOD[T]()?d.id&&(d.params&&d.params.account)&&(c=new j.accountchooser.rpc.StoreRequest(d.id,d.params.account,d.params.localAccounts,d.params.clientConfig)):f==j.accountchooser.rpc.SelectRequest.METHOD[T]()?d.id&&(c=new j.accountchooser.rpc.SelectRequest(d.id,
d.params.localAccounts,d.params.clientConfig)):f==j.accountchooser.rpc.UpdateRequest.METHOD[T]()?d.id&&(d.params&&d.params.account)&&(c=new j.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==j.accountchooser.rpc.QueryRequest.METHOD[T]()?c=new j.accountchooser.rpc.QueryRequest(d.id,d.params.query,d.params.account,d.params.clientConfig):f==j.accountchooser.rpc.ClientReadyNotification.METHOD[T]()&&(c=new j.accountchooser.rpc.ClientReadyNotification)}}c?j.accountchooser.util.log(Ma+
b):j.accountchooser.util.log(oa+b);return c};j.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";j.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";j.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";j.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";j.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;j.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;j.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";j.accountchooser.rpc.IDP_TIMEOUT=3E3;
j.accountchooser.rpc.RPC_TIMEOUT=3E5;j.accountchooser.rpc.services_={};j.accountchooser.rpc.register=function(b,c){j.accountchooser[K].notEmpty(b,lb);j.accountchooser[K].notNull(c,Xa);j.accountchooser.rpc.services_[b]=c};j.accountchooser.rpc.call=function(b,c,d){j.accountchooser[K].notEmpty(b,mb);c=c[x]();j.accountchooser.util.log(Ja+c);b[F](c,d||ea)};j.accountchooser.rpc.init_=function(b){j.addEventListener?j.addEventListener(bb,b,i):j[u]?j[u](eb,b):j[P][u]?j[P][u](eb,b):j.accountchooser.util.log(Ha)};
j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
j.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[q](/^https?:\/\//,U);var e=[],f=j[A].getItem(d);if(f){j[A][C](d);var k=j.JSON[L](f)||[],f=(new Date)[v]();if(k[M]){k=k[k[M]-1];try{var m=n[L](k);m&&m.timestamp&&f-m.timestamp<j.accountchooser.rpc.RPC_TIMEOUT?(e[G](k),c&&j[A].setItem(d,j.JSON[I](e))):j.accountchooser.util.log(ua+k+Ra)}catch(pb){j.accountchooser.util.log(va+k+Ra)}}}return e};
j.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[q](/^https?:\/\//,U);j[A][C](j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);j[A][C](j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[G](c[x]());c=j.JSON[I](b);j[A].setItem(d,c)};
j.accountchooser.rpc.triggerSavedRpcs_=function(b){if(j[B]){var c=j.accountchooser.rpc.readSavedRpcObjects(b,i);if(c&&c[M])for(var d=0;d<c[M];d++)j[B][F](c[d],b);else j.accountchooser.rpc[R](j[B],new j.accountchooser.rpc.EmptyResponseNotification)}};j.accountchooser.rpc.saveAndAckRequest_=function(b,c){j.accountchooser.rpc.saveRpcObject(c,b,g);var d=new j.accountchooser.rpc.RequestAckNotification(b.id_);j[B][F](d[x](),c)};
j.accountchooser.rpc.handleQuery_=function(b,c){var d=i;switch(b.params_.query){case j.accountchooser.rpc.Queries.CDS_DISABLED:d=j.accountchooser.rpc.checkCdsDisabled_();break;case j.accountchooser.rpc.Queries.CDS_EMPTY:d=j.accountchooser.rpc.checkCdsEmpty_(b.params_.clientConfig);break;case j.accountchooser.rpc.Queries.ACCOUNT_EXIST:d=j.accountchooser.rpc.checkAccountExist_(b.params_.account,b.params_.clientConfig);break;default:j.accountchooser.rpc.sendInvalidQueryResponse_(b,c);return}d=new j.accountchooser.rpc.Response(b.id_,
d);j[B][F](d[x](),c)};j.accountchooser.rpc.checkCdsDisabled_=function(){return j.accountchooser.util.browserconfig.isDisabled()};j.accountchooser.rpc.checkCdsEmpty_=function(b){return!j.accountchooser.rpc.getAllAccountsByClientConfig_(b)[M]};j.accountchooser.rpc.checkAccountExist_=function(b,c){for(var d=j.accountchooser.rpc.getAllAccountsByClientConfig_(c),e=0;e<d[M];++e){var f=d[e];if(j.accountchooser.util.accountstorage.matchAccount_(b,f.email,f.providerId))return g}return i};
j.accountchooser.rpc.getAllAccountsByClientConfig_=function(b){return j.accountchooser.util.accountstorage.readAccounts({withEmail:b&&!b.showAll,idpList:b&&b.idpFilter})};j.accountchooser.rpc.sendErrorResponse_=function(b,c,d){b=new j.accountchooser.rpc.Response(c.id_,a,b);j[B][F](b[x](),d)};j.accountchooser.rpc.sendDisableResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32601,message:Aa,data:Ka},b,c)};
j.accountchooser.rpc.sendInvalidQueryResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32602,message:ya,data:Na+b.params_.query+ba},b,c)};
j.accountchooser.rpc.process_=function(b){j.accountchooser.util.log(Ga+b[r]+aa+b[p]);var c=j.accountchooser.rpc.parseRpcObject(b[r]);c?c instanceof j.accountchooser.rpc.ClientReadyNotification?j.accountchooser.rpc.triggerSavedRpcs_(b[p]):c instanceof j.accountchooser.rpc[H]?c instanceof j.accountchooser.rpc.QueryRequest?j.accountchooser.rpc.handleQuery_(c,b[p]):j.accountchooser.rpc.saveAndAckRequest_(c,b[p]):j.accountchooser.util.log(Oa+b[r]):j.accountchooser.util.log(la+b[r])};j.accountchooser.rpc.init_(j.accountchooser.rpc.process_);})()
