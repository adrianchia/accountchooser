/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var b=null,g=!1,h=window,i=document,k=JSON,l="sessionStorage",n="trim",p="setAttribute",q="documentElement",r="localStorage",s="displayName",t="isArray",u="push",v="stringify",w="indexOf",x="param",y="length",z="prototype",A="clientWidth",B="document",C="body",D="call",E="clientHeight",F="",G="&",H="(^|;) ?",I="; expires=",J="; path=/",K="=",L="=([^;]*)(;|$)",M="=; expires=",N="?",O="Clear CDS browser config.",P="Failed to clear from DOM storage: ",Q="Failed to clear from cookie: ",aa="Failed to read from DOM storage: ",
ba="Failed to read from cookie: ",ca="Failed to write to DOM storage: ",da="Failed to write to cookie: ",ea="Get CDS browser config: ",R="MSIE",fa="Parameter %%param%% cannot be an empty array.",S="Parameter %%param%% cannot be empty.",ga="Parameter %%param%% cannot be null.",ha="Parameter %%param%% is not a function.",ia="Parameter %%param%% is not an array.",ja="Read saved accounts from storage: ",ka="Save accounts to storage: ",la="Set CDS browser config: ",ma="[object Array]",na="[object Function]",
T="chooserAccounts",U="cookieName",V="disabled",W="domStorageKey",oa="form",pa="hidden",qa="input",ra="localStorage",sa="name",X="object",ta="opt_cookieName",ua="opt_domStorageKey || opt_cookieName",va="parentClass",wa="post",xa="sessionStorage",ya="type",Y="value",Z;h.accountchooser=h.accountchooser||{};h.cds=h.accountchooser;h.accountchooser.util=h.accountchooser.util||{};h.accountchooser.util.log=function(a){try{h.console&&h.console.log&&h.console.log(a)}catch(c){}};
h.accountchooser.util.uuidCounter_=(new Date).getTime();h.accountchooser.util.generateUuid=function(a){return a&&a.uuid?a.uuid:++h.accountchooser.util.uuidCounter_};h.accountchooser.util.createForm_=function(a,c,e){if(!a)throw"The targetUrl cannot be null.";var d=h[B].createElement(oa);d.method=wa;d.action=a;if(c)for(var f in c)a=h[B].createElement(qa),a[p](ya,pa),a[p](sa,f),c[f]===b||void 0===c[f]?a[p](Y,F):a[p](Y,c[f]),d.appendChild(a);e&&(d.target=e);h[B][C].appendChild(d);return d};
h.accountchooser.util.postTo=function(a,c,e){a=h.accountchooser.util.createForm_(a,c,e);a.submit();h[B][C].removeChild(a)};h.accountchooser.util.parseUrlParams=function(a){var c={};a=a.slice(a[w](N)+1).split(G);for(var e=0;e<a[y];e++){var d=a[e].split(K);c[d[0]]=2==d[y]?decodeURIComponent(d[1]):void 0}return c};h.accountchooser.util.formRedirect=function(a,c){var e=a.substring(0,a[w](N)),d=h.accountchooser.util.parseUrlParams(a);h.accountchooser.util.postTo(e,d,c)};
h.accountchooser.util.isBrowserSupported=function(){var a=999;-1!=navigator.appVersion[w](R)&&(a=parseFloat(navigator.appVersion.split(R)[1]));return 7<a};h.accountchooser.util.makeUrl=function(a,c){var e=[],d;for(d in c)e[u](c[d]?d+K+c[d]:d);return a+N+e.join(G)};h.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};
h.accountchooser.util.sanitizeAccount=function(a,c){var e={},d=h.accountchooser.util.AccountPropertyKey,f;for(f in a)switch(f){case d.EMAIL:case d.DISPLAY_NAME:case d.PHOTO_URL:case d.PROVIDER_ID:e[f]=a[f];break;default:if(!c)throw'Unrecognized key "'+f+'" for account';}return e};h.accountchooser.util.sanitizeAccounts=function(a){for(var c=[],e=0,d=a[y];e<d;e++){var f=h.accountchooser.util.sanitizeAccount(a[e]);c[u](f)}return c};
h.accountchooser.util.isArray=function(a){return"undefined"!==typeof jQuery?jQuery[t](a):Object[z].toString[D](a)===ma};h.accountchooser.util.isFunction=function(a){return"undefined"!==typeof jQuery?jQuery.isFunction(a):Object[z].toString[D](a)===na};h.accountchooser.util.indexOf=function(a,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(a,c);if(c[w])return c[w](a);for(var e=c[y],d=0;d<e;d++)if(d in c&&c[d]===a)return d}return-1};
h.accountchooser.util.windowWidth=function(a){if("undefined"!==typeof jQuery)return jQuery(a).width();var c=0;a.innerWidth?c=a.innerWidth:a[B]&&a[B][q]&&a[B][q][A]?c=a[B][q][A]:a[B]&&(a[B][C]&&a[B][C][A])&&(c=a[B][C][A]);return c};h.accountchooser.util.windowHeight=function(a){if("undefined"!==typeof jQuery)return jQuery(a).height();var c=0;a.innerHeight?c=a.innerHeight:a[B]&&a[B][q]&&a[B][q][E]?c=a[B][q][E]:a[B]&&(a[B][C]&&a[B][C][E])&&(c=a[B][C][E]);return c};
h.accountchooser.util.trim=function(a){return"undefined"!==typeof jQuery?jQuery[n](a):a==b?F:String[z][n]?String[z][n][D](a):a.replace(/^[\s\xa0]+/,F).replace(/[\s\xa0]+$/,F)};
h.accountchooser.util.extend=function(a,c,e){if(3>arguments[y])return c||{};if("undefined"!==typeof jQuery){var d=Array[z].slice[D](arguments,a?0:1);return jQuery.extend.apply(jQuery,d)}if(typeof c!==X||c==b)c={};for(var d=2,f=arguments[y];d<f;d++){var m=arguments[d];if(m!=b)for(var j in m)void 0===m[j]||c===m[j]||(a&&typeof m[j]==X?(h.accountchooser.util[t](m[j])&&!h.accountchooser.util[t](c[j])&&(c[j]=[]),c[j]=h.accountchooser.util.extend(!0,c[j],m[j])):c[j]=m[j])}return c};
h.accountchooser.param={};h.accountchooser[x].notNull=function(a,c){(void 0===a||a===b)&&h.accountchooser[x].throwError_(ga,c)};h.accountchooser[x].notEmpty=function(a,c){a||h.accountchooser[x].throwError_(S,c)};h.accountchooser[x].notEmptyArray=function(a,c){a||h.accountchooser[x].throwError_(S,c);h.accountchooser.util[t](a)||h.accountchooser[x].throwError_(ia,c);a[y]||h.accountchooser[x].throwError_(fa,c)};
h.accountchooser[x].notEmptyFunction=function(a,c){a||h.accountchooser[x].throwError_(S,c);h.accountchooser.util.isFunction(a)||h.accountchooser[x].throwError_(ha,c)};h.accountchooser[x].throwError_=function(a,c){try{console&&console.trace&&console.trace()}catch(e){}throw a.replace(/\%\%param\%\%/g,c?" '"+c+"'":F);};Function[z].inheritsFrom=function(a){h.accountchooser[x].notEmptyFunction(a,va);this.prototype=new a;this[z].constructor=this;this[z].parentClass=a[z]};
h.accountchooser.util.Storage=function(a,c,e){h.accountchooser[x].notEmpty(a||c,ua);h.accountchooser.util.Storage.isDomStorageSupported(e)||h.accountchooser[x].notEmpty(c,ta);this.domStorageKey_=a;this.cookieName_=c;this.perSession_=e};h.accountchooser.util.Storage.isDomStorageSupported=function(a){try{return a?xa in h&&h[l]!=b:ra in h&&h[r]!=b}catch(c){return g}};Z=h.accountchooser.util.Storage[z];
Z.read=function(){if(h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(a){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(a):this.isCookieStorageAllowed_()&&this.writeToCookie_(a)};
Z.clear=function(){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){h.accountchooser[x].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[l]:h[r];try{var c=a.getItem(this.domStorageKey_);if(c)return k.parse(c)}catch(e){h.accountchooser.util.log(aa+e)}};Z.writeToDomStorage_=function(a){h.accountchooser[x].notEmpty(this.domStorageKey_,W);var c=this.perSession_?h[l]:h[r];try{var e=k[v](a);c.setItem(this.domStorageKey_,e)}catch(d){h.accountchooser.util.log(ca+d)}};
Z.clearFromDomStorage_=function(){h.accountchooser[x].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[l]:h[r];try{a.removeItem(this.domStorageKey_)}catch(c){h.accountchooser.util.log(P+c)}};Z.readFromCookie_=function(){h.accountchooser[x].notEmpty(this.cookieName_,U);var a=i.cookie.match(H+this.cookieName_+L);if(a&&(a=h.accountchooser.util[n](a[2])))try{return k.parse(unescape(a))}catch(c){h.accountchooser.util.log(ba+c)}};
Z.writeToCookie_=function(a){h.accountchooser[x].notEmpty(this.cookieName_,U);try{var c=new Date,e=c.getFullYear()+10,d=c.getMonth(),f=c.getDate(),m=new Date(e,d,f),j=this.perSession_?0:m.toGMTString();i.cookie=this.cookieName_+K+escape(k[v](a))+I+j+J}catch(za){h.accountchooser.util.log(da+za)}};
Z.clearFromCookie_=function(){h.accountchooser[x].notEmpty(this.cookieName_,U);try{var a=new Date;a.setTime(a.getTime()-1);i.cookie=this.cookieName_+M+a.toGMTString()+J}catch(c){h.accountchooser.util.log(Q+c)}};h.accountchooser.util.accountstorage={};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_,h.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
h.accountchooser.util.accountstorage.read_=function(){var a=h.accountchooser.util.accountstorage.storage_.read();h.accountchooser.util.log(ja+k[v](a));return a};h.accountchooser.util.accountstorage.write_=function(a){h.accountchooser.util.log(ka+k[v](a));h.accountchooser.util.accountstorage.storage_.write(a)};h.accountchooser.util.accountstorage.readAccounts=function(){var a=h.accountchooser.util.accountstorage.read_();if(!a||!h.accountchooser.util[t](a))a=[];return a};
h.accountchooser.util.accountstorage.addAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d,f=0;f<e[y];f++)if(h.accountchooser.util.accountstorage.matchAccount_(e[f],a.email,a.providerId)){d=e[f];e.splice(f,1);c=!0;break}d&&(!a[s]&&d[s]&&(a.displayName=d[s]),!a.photoUrl&&d.photoUrl&&(a.photoUrl=d.photoUrl));e.unshift(a);h.accountchooser.util.accountstorage.write_(e);return!c};
h.accountchooser.util.accountstorage.removeAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[y];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a.email,a.providerId)){e.splice(d,1);c=!0;break}h.accountchooser.util.accountstorage.write_(e);return c};h.accountchooser.util.accountstorage.clearAccounts=function(){h.accountchooser.util.accountstorage.storage_.clear()};
h.accountchooser.util.accountstorage.updateAccount=function(a,c,e){if(a)for(var d=h.accountchooser.util.accountstorage.readAccounts(),f=0;f<d[y];f++)if(h.accountchooser.util.accountstorage.matchAccount_(d[f],a,e)){c(d[f]);h.accountchooser.util.accountstorage.write_(d);break}};
h.accountchooser.util.accountstorage.refreshAccount=function(a){a&&a.email&&h.accountchooser.util.accountstorage.updateAccount(a.email,function(c){a[s]&&(c.displayName=a[s]);a.photoUrl&&(c.photoUrl=a.photoUrl);void 0!=a.legacy&&(c.legacy=a.legacy)},a.providerId)};
h.accountchooser.util.accountstorage.fetchAccount=function(a,c){if(a)for(var e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[y];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a,c)){var f=e[d];e.splice(d,1);e.unshift(f);h.accountchooser.util.accountstorage.write_(e);return f}};h.accountchooser.util.accountstorage.matchAccount_=function(a,c,e){return a.email!=c?g:a.providerId&&e&&a.providerId==e||!a.providerId&&!e?!0:g};h.accountchooser.updateSavedAccount=function(a){h.accountchooser.util.accountstorage.addAccount(a)};
h.accountchooser.removeSavedAccount=function(a){return h.accountchooser.util.accountstorage.removeAccount(a)};h.accountchooser.clearSavedAccounts=function(){h.accountchooser.util.accountstorage.clearAccounts()};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_);h.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
h.accountchooser.util.accountstorage.readAccounts=function(a){var c=h.accountchooser.util.accountstorage.read_();if(!c||!h.accountchooser.util[t](c))c=[];if(!a)return c;var e=[];if(a.withEmail){var d=function(a){return h.accountchooser.util.isValidEmail(a.email)};e[u](d)}a.idpList&&0!=a.idpList[y]&&(d=function(c){return 0<=h.accountchooser.util[w](c.providerId||h.accountchooser.util.accountstorage.NO_IDP_,a.idpList)},e[u](d));a.emailDomainList&&0!=a.emailDomainList[y]&&(d=function(c){return(c=h.accountchooser.util.getEmailDomain(c.email))?
0<=h.accountchooser.util[w](c,a.emailDomainList):!0},e[u](d));for(d=0;d<e[y];d++)c=h.accountchooser.util.accountstorage.filter_(c,e[d]);return c};h.accountchooser.util.accountstorage.filter_=function(a,c){for(var e=[],d=0;d<a[y];d++)c(a[d])&&e[u](a[d]);return e};h.accountchooser.util.browserconfig={};h.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";h.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
h.accountchooser.util.browserconfig.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.browserconfig.SETTINGS_KEY_,h.accountchooser.util.browserconfig.COOKIE_NAME_);h.accountchooser.util.browserconfig.getAll=function(){var a=h.accountchooser.util.browserconfig.storage_.read()||{};h.accountchooser.util.log(ea+k[v](a));return a};h.accountchooser.util.browserconfig.setAll=function(a){h.accountchooser.util.log(la+k[v](a));h.accountchooser.util.browserconfig.storage_.write(a)};
h.accountchooser.util.browserconfig.clearAll=function(){h.accountchooser.util.log(O);h.accountchooser.util.browserconfig.storage_.clear()};h.accountchooser.util.browserconfig.get=function(a){return h.accountchooser.util.browserconfig.getAll()[a]};h.accountchooser.util.browserconfig.set=function(a,c){var e=h.accountchooser.util.browserconfig.getAll();e[a]=c;h.accountchooser.util.browserconfig.setAll(e)};
h.accountchooser.util.browserconfig.clear=function(a){var c=h.accountchooser.util.browserconfig.getAll();delete c[a];h.accountchooser.util.browserconfig.setAll(c)};h.accountchooser.util.browserconfig.isDisabled=function(){return!!h.accountchooser.util.browserconfig.get(V)};h.accountchooser.util.browserconfig.setDisabled=function(a){h.accountchooser.util.browserconfig.set(V,!!a)};})()
