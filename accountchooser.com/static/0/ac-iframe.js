/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var a=void 0,g=!0,h=null,i=!1,j=window,k=document,n=JSON;function o(b,c){return b.toJSON=c}
var p="origin",q="replace",r="data",s="sessionStorage",t="trim",u="setAttribute",v="attachEvent",w="getTime",x="documentElement",y="toString",z="toJSON",A="split",B="localStorage",C="parent",D="removeItem",E="displayName",F="isArray",G="postMessage",H="push",I="Request",J="stringify",K="indexOf",L="param",M="parse",N="length",O="prototype",P="clientWidth",Q="document",R="body",S="call",T="clientHeight",U="toLowerCase",V="",aa=" from ",ba='" is invalid.',ca="&",da="(^|;) ?",ea="*",fa="2.0",ga="; expires=",
ha="; path=/",W="=",ia="=([^;]*)(;|$)",ja="=; expires=",X="?",ka="@",la="Clear CDS browser config.",ma="Error request format: ",na="Failed to clear from DOM storage: ",oa="Failed to clear from cookie: ",pa="Failed to parse request: ",ra="Failed to read from DOM storage: ",sa="Failed to read from cookie: ",ta="Failed to write to DOM storage: ",ua="Failed to write to cookie: ",va="Get CDS browser config: ",wa="Ignore expired JSON-RPC object: [",xa="Ignore invalid JSON-RPC object: [",ya="Invalid JSON-RPC object: not a JSON object.",
za="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Aa="Invalid parameter",Ba="MSIE",Ca="Method not found",Da="Parameter %%param%% cannot be an empty array.",Ea="Parameter %%param%% cannot be empty.",Fa="Parameter %%param%% cannot be null.",Ga="Parameter %%param%% is not a function.",Ha="Parameter %%param%% is not an array.",Ia="Read saved accounts from storage: ",Ja="Received message: ",Ka="Register handler for postMessage failed.",La="Save accounts to storage: ",Ma="Send message: ",
Na="Service is disabled. Method is not available.",Oa="Set CDS browser config: ",Pa="Successfully parsing request: ",Qa='The query "',Ra="Unrecognized rpcObject: ",Sa="[object Array]",Ta="[object Function]",Ua="]",Va="account",Wa="chooserAccounts",Xa="cookieName",Ya="disabled",Za="domStorageKey",$a="form",ab="handler",bb="hidden",Y="id",cb="input",db="localStorage",eb="message",fb="name",gb="object",hb="onmessage",ib="opt_cookieName",jb="opt_domStorageKey || opt_cookieName",kb="parentClass",lb="post",
mb="query",nb="requestId",ob="serviceName",pb="sessionStorage",qb="targetWindow",rb="type",sb="value",Z;j.accountchooser=j.accountchooser||{};j.cds=j.accountchooser;j.accountchooser.util=j.accountchooser.util||{};j.accountchooser.util.log=function(b){try{j.console&&j.console.log&&j.console.log(b)}catch(c){}};j.accountchooser.util.uuidCounter_=(new Date)[w]();j.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++j.accountchooser.util.uuidCounter_};
j.accountchooser.util.createForm_=function(b,c,d){if(!b)throw"The targetUrl cannot be null.";var e=j[Q].createElement($a);e.method=lb;e.action=b;if(c)for(var f in c)b=j[Q].createElement(cb),b[u](rb,bb),b[u](fb,f),c[f]===h||c[f]===a?b[u](sb,V):b[u](sb,c[f]),e.appendChild(b);d&&(e.target=d);j[Q][R].appendChild(e);return e};j.accountchooser.util.postTo=function(b,c,d){b=j.accountchooser.util.createForm_(b,c,d);b.submit();j[Q][R].removeChild(b)};
j.accountchooser.util.parseUrlParams=function(b){for(var c={},b=b.slice(b[K](X)+1)[A](ca),d=0;d<b[N];d++){var e=b[d][A](W);c[e[0]]=2==e[N]?decodeURIComponent(e[1]):a}return c};j.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[K](X)),e=j.accountchooser.util.parseUrlParams(b);j.accountchooser.util.postTo(d,e,c)};j.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=navigator.appVersion[K](Ba)&&(b=parseFloat(navigator.appVersion[A](Ba)[1]));return 7<b};
j.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[H](c[e]?e+W+c[e]:e);return b+X+d.join(ca)};j.accountchooser.util.isArray=function(b){return"undefined"!==typeof jQuery?jQuery[F](b):Object[O][y][S](b)===Sa};j.accountchooser.util.isFunction=function(b){return"undefined"!==typeof jQuery?jQuery.isFunction(b):Object[O][y][S](b)===Ta};
j.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(b,c);if(c[K])return c[K](b);for(var d=c[N],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};j.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof jQuery)return jQuery(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[Q]&&b[Q][x]&&b[Q][x][P]?c=b[Q][x][P]:b[Q]&&(b[Q][R]&&b[Q][R][P])&&(c=b[Q][R][P]);return c};
j.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof jQuery)return jQuery(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[Q]&&b[Q][x]&&b[Q][x][T]?c=b[Q][x][T]:b[Q]&&(b[Q][R]&&b[Q][R][T])&&(c=b[Q][R][T]);return c};j.accountchooser.util.trim=function(b){return"undefined"!==typeof jQuery?jQuery[t](b):b==h?V:String[O][t]?String[O][t][S](b):b[q](/^[\s\xa0]+/,V)[q](/[\s\xa0]+$/,V)};
j.accountchooser.util.extend=function(b,c,d){if(3>arguments[N])return c||{};if("undefined"!==typeof jQuery){var e=Array[O].slice[S](arguments,b?0:1);return jQuery.extend.apply(jQuery,e)}if(typeof c!==gb||c==h)c={};for(var e=2,f=arguments[N];e<f;e++){var l=arguments[e];if(l!=h)for(var m in l)l[m]===a||c===l[m]||(b&&typeof l[m]==gb?(j.accountchooser.util[F](l[m])&&!j.accountchooser.util[F](c[m])&&(c[m]=[]),c[m]=j.accountchooser.util.extend(g,c[m],l[m])):c[m]=l[m])}return c};j.accountchooser.param={};
j.accountchooser[L].notNull=function(b,c){(b===a||b===h)&&j.accountchooser[L].throwError_(Fa,c)};j.accountchooser[L].notEmpty=function(b,c){b||j.accountchooser[L].throwError_(Ea,c)};j.accountchooser[L].notEmptyArray=function(b,c){b||j.accountchooser[L].throwError_(Ea,c);j.accountchooser.util[F](b)||j.accountchooser[L].throwError_(Ha,c);b[N]||j.accountchooser[L].throwError_(Da,c)};
j.accountchooser[L].notEmptyFunction=function(b,c){b||j.accountchooser[L].throwError_(Ea,c);j.accountchooser.util.isFunction(b)||j.accountchooser[L].throwError_(Ga,c)};j.accountchooser[L].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}throw b[q](/\%\%param\%\%/g,c?" '"+c+"'":V);};Function[O].inheritsFrom=function(b){j.accountchooser[L].notEmptyFunction(b,kb);this.prototype=new b;this[O].constructor=this;this[O].parentClass=b[O]};
j.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.isValidEmail=function(b){return b&&h!=j.accountchooser.util.VALID_EMAIL_REGEX_.exec(b)};j.accountchooser.util.isValidDomain=function(b){return b&&h!=j.accountchooser.util.VALID_DOMAIN_REGEX_.exec(b)};
j.accountchooser.util.getEmailDomain=function(b){if((b=j.accountchooser.util[t](b))&&j.accountchooser.util.isValidEmail(b))return b[A](ka)[1][U]()};j.accountchooser.util.getEmailUsername=function(b){if((b=j.accountchooser.util[t](b))&&j.accountchooser.util.isValidEmail(b))return b[A](ka)[0][U]()};j.accountchooser.util.isDomainInNascar=function(b){if(b){var c=j.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};
j.accountchooser.util.Storage=function(b,c,d){j.accountchooser[L].notEmpty(b||c,jb);j.accountchooser.util.Storage.isDomStorageSupported(d)||j.accountchooser[L].notEmpty(c,ib);this.domStorageKey_=b;this.cookieName_=c;this.perSession_=d};j.accountchooser.util.Storage.isDomStorageSupported=function(b){try{return b?pb in j&&j[s]!=h:db in j&&j[B]!=h}catch(c){return i}};Z=j.accountchooser.util.Storage[O];
Z.read=function(){if(j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(b){j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};
Z.clear=function(){j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){j.accountchooser[L].notEmpty(this.domStorageKey_,Za);var b=this.perSession_?j[s]:j[B];try{var c=b.getItem(this.domStorageKey_);if(c)return n[M](c)}catch(d){j.accountchooser.util.log(ra+d)}};Z.writeToDomStorage_=function(b){j.accountchooser[L].notEmpty(this.domStorageKey_,Za);var c=this.perSession_?j[s]:j[B];try{var d=n[J](b);c.setItem(this.domStorageKey_,d)}catch(e){j.accountchooser.util.log(ta+e)}};
Z.clearFromDomStorage_=function(){j.accountchooser[L].notEmpty(this.domStorageKey_,Za);var b=this.perSession_?j[s]:j[B];try{b[D](this.domStorageKey_)}catch(c){j.accountchooser.util.log(na+c)}};Z.readFromCookie_=function(){j.accountchooser[L].notEmpty(this.cookieName_,Xa);var b=k.cookie.match(da+this.cookieName_+ia);if(b&&(b=j.accountchooser.util[t](b[2])))try{return n[M](unescape(b))}catch(c){j.accountchooser.util.log(sa+c)}};
Z.writeToCookie_=function(b){j.accountchooser[L].notEmpty(this.cookieName_,Xa);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),l=new Date(d,e,f),m=this.perSession_?0:l.toGMTString();k.cookie=this.cookieName_+W+escape(n[J](b))+ga+m+ha}catch(qa){j.accountchooser.util.log(ua+qa)}};
Z.clearFromCookie_=function(){j.accountchooser[L].notEmpty(this.cookieName_,Xa);try{var b=new Date;b.setTime(b[w]()-1);k.cookie=this.cookieName_+ja+b.toGMTString()+ha}catch(c){j.accountchooser.util.log(oa+c)}};j.accountchooser.util.accountstorage={};j.accountchooser.util.accountstorage.ACCOUNTS_=Wa;j.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_,j.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
j.accountchooser.util.accountstorage.read_=function(){var b=j.accountchooser.util.accountstorage.storage_.read();j.accountchooser.util.log(Ia+n[J](b));return b};j.accountchooser.util.accountstorage.write_=function(b){j.accountchooser.util.log(La+n[J](b));j.accountchooser.util.accountstorage.storage_.write(b)};j.accountchooser.util.accountstorage.readAccounts=function(){var b=j.accountchooser.util.accountstorage.read_();if(!b||!j.accountchooser.util[F](b))b=[];return b};
j.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[N];f++)if(j.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=g;break}if(e&&(!b[E]&&e[E]&&(b.displayName=e[E]),!b.photoUrl&&e.photoUrl))b.photoUrl=e.photoUrl;d.unshift(b);j.accountchooser.util.accountstorage.write_(d);return!c};
j.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=g;break}j.accountchooser.util.accountstorage.write_(d);return c};j.accountchooser.util.accountstorage.clearAccounts=function(){j.accountchooser.util.accountstorage.storage_.clear()};
j.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=j.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[N];f++)if(j.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);j.accountchooser.util.accountstorage.write_(e);break}};
j.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&j.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[E]&&(c.displayName=b[E]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=a&&(c.legacy=b.legacy)})};
j.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);j.accountchooser.util.accountstorage.write_(d);return f}};j.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?i:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?g:i};j.accountchooser.updateSavedAccount=function(b){j.accountchooser.util.accountstorage.addAccount(b)};
j.accountchooser.removeSavedAccount=function(b){return j.accountchooser.util.accountstorage.removeAccount(b)};j.accountchooser.clearSavedAccounts=function(){j.accountchooser.util.accountstorage.clearAccounts()};j.accountchooser.util.accountstorage.ACCOUNTS_=Wa;j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_);j.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
j.accountchooser.util.accountstorage.readAccounts=function(b){var c=j.accountchooser.util.accountstorage.read_();if(!c||!j.accountchooser.util[F](c))c=[];if(!b)return c;var d=[];if(b.withEmail){var e=function(b){return j.accountchooser.util.isValidEmail(b.email)};d[H](e)}b.idpList&&0!=b.idpList[N]&&(e=function(c){return 0<=j.accountchooser.util[K](c.providerId||j.accountchooser.util.accountstorage.NO_IDP_,b.idpList)},d[H](e));b.emailDomainList&&0!=b.emailDomainList[N]&&(e=function(c){return(c=j.accountchooser.util.getEmailDomain(c.email))?
j.accountchooser.util[K](c,b.emailDomainList)>=0:g},d[H](e));for(e=0;e<d[N];e++)c=j.accountchooser.util.accountstorage.filter_(c,d[e]);return c};j.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[N];e++)c(b[e])&&d[H](b[e]);return d};j.accountchooser.util.browserconfig={};j.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";j.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
j.accountchooser.util.browserconfig.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.browserconfig.SETTINGS_KEY_,j.accountchooser.util.browserconfig.COOKIE_NAME_);j.accountchooser.util.browserconfig.getAll=function(){var b=j.accountchooser.util.browserconfig.storage_.read()||{};j.accountchooser.util.log(va+n[J](b));return b};j.accountchooser.util.browserconfig.setAll=function(b){j.accountchooser.util.log(Oa+n[J](b));j.accountchooser.util.browserconfig.storage_.write(b)};
j.accountchooser.util.browserconfig.clearAll=function(){j.accountchooser.util.log(la);j.accountchooser.util.browserconfig.storage_.clear()};j.accountchooser.util.browserconfig.get=function(b){return j.accountchooser.util.browserconfig.getAll()[b]};j.accountchooser.util.browserconfig.set=function(b,c){var d=j.accountchooser.util.browserconfig.getAll();d[b]=c;j.accountchooser.util.browserconfig.setAll(d)};
j.accountchooser.util.browserconfig.clear=function(b){var c=j.accountchooser.util.browserconfig.getAll();delete c[b];j.accountchooser.util.browserconfig.setAll(c)};j.accountchooser.util.browserconfig.isDisabled=function(){return!!j.accountchooser.util.browserconfig.get(Ya)};j.accountchooser.util.browserconfig.setDisabled=function(b){j.accountchooser.util.browserconfig.set(Ya,!!b)};j.accountchooser.rpc=j.accountchooser.rpc||{};j.accountchooser.rpc.RpcObject=function(){};
j.accountchooser.rpc.RpcObject[O].setTimestamp=function(b){this.timestamp_=b||(new Date)[w]()};o(j.accountchooser.rpc.RpcObject[O],function(){var b={jsonrpc:fa};this.timestamp_!=h&&(b.timestamp=this.timestamp_);return b});j.accountchooser.rpc.RpcObject[O].toString=function(){return n[J](this[z]())};j.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.AbstractRequest.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.AbstractRequest[O];
Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};o(Z,function(){var b=j.accountchooser.rpc.RpcObject[O][z][S](this);this.method_!=h&&(b.method=this.method_);this.params_!=h&&(b.params=this.params_);return b});j.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.Notification.inheritsFrom(j.accountchooser.rpc.AbstractRequest);
j.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};j.accountchooser.rpc[I].inheritsFrom(j.accountchooser.rpc.AbstractRequest);j.accountchooser.rpc[I][O].setId=function(b){this.id_=b};j.accountchooser.rpc[I][O].getId=function(){return this.id_};o(j.accountchooser.rpc[I][O],function(){var b=j.accountchooser.rpc.AbstractRequest[O][z][S](this);this.id_!=h&&(b.id=this.id_);return b});
j.accountchooser.rpc.Response=function(b,c,d){j.accountchooser[L].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};j.accountchooser.rpc.Response.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.Response[O];Z.getResult=function(){return this.result_};Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};
o(Z,function(){var b=j.accountchooser.rpc.RpcObject[O][z][S](this);b.id=this.id_;this.result_!=h?b.result=this.result_:this.error_!=h&&(b.error=this.error_);return b});j.accountchooser.rpc.RequestAckNotification=function(b){j.accountchooser[L].notEmpty(b,nb);this.method_=j.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};j.accountchooser.rpc.RequestAckNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
j.accountchooser.rpc.RequestAckNotification[O].setRequestId=function(b){this.params_.requestId=b};j.accountchooser.rpc.RequestAckNotification[O].getRequestId=function(){return this.params_.requestId};j.accountchooser.rpc.CdsReadyNotification=function(){this.method_=j.accountchooser.rpc.CdsReadyNotification.METHOD};j.accountchooser.rpc.CdsReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
j.accountchooser.rpc.ClientReadyNotification=function(){this.method_=j.accountchooser.rpc.ClientReadyNotification.METHOD};j.accountchooser.rpc.ClientReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";j.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=j.accountchooser.rpc.EmptyResponseNotification.METHOD};j.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(j.accountchooser.rpc.Notification);
j.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";j.accountchooser.rpc.StoreRequest=function(b,c,d,e){j.accountchooser[L].notEmpty(b,Y);j.accountchooser[L].notEmpty(c,Va);this.method_=j.accountchooser.rpc.StoreRequest.METHOD;this.params_={account:c,localAccounts:d,clientConfig:e};this.id_=b};j.accountchooser.rpc.StoreRequest.inheritsFrom(j.accountchooser.rpc[I]);j.accountchooser.rpc.StoreRequest.METHOD="store";
j.accountchooser.rpc.SelectRequest=function(b,c,d){j.accountchooser[L].notEmpty(b,Y);this.method_=j.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.SelectRequest.inheritsFrom(j.accountchooser.rpc[I]);j.accountchooser.rpc.SelectRequest.METHOD="select";
j.accountchooser.rpc.UpdateRequest=function(b,c,d){j.accountchooser[L].notEmpty(b,Y);j.accountchooser[L].notEmpty(c,Va);this.method_=j.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.UpdateRequest.inheritsFrom(j.accountchooser.rpc[I]);j.accountchooser.rpc.UpdateRequest.METHOD="update";
j.accountchooser.rpc.ManageRequest=function(b,c){j.accountchooser[L].notEmpty(b,Y);this.method_=j.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};j.accountchooser.rpc.ManageRequest.inheritsFrom(j.accountchooser.rpc[I]);j.accountchooser.rpc.ManageRequest.METHOD="manage";
j.accountchooser.rpc.QueryRequest=function(b,c,d,e){j.accountchooser[L].notEmpty(b,Y);j.accountchooser[L].notEmpty(c,mb);this.method_=j.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};j.accountchooser.rpc.QueryRequest.inheritsFrom(j.accountchooser.rpc[I]);j.accountchooser.rpc.QueryRequest.METHOD=mb;j.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};
j.accountchooser.rpc.parseRpcObject=function(b){var c=h;if(b){try{var d=n[M](b)}catch(e){return j.accountchooser.util.log(ya),c}if(!d||d.jsonrpc!=fa)j.accountchooser.util.log(za);else if(d.method){var f=d.method[U]();f==j.accountchooser.rpc.StoreRequest.METHOD[U]()?d.id&&(d.params&&d.params.account)&&(c=new j.accountchooser.rpc.StoreRequest(d.id,d.params.account,d.params.localAccounts,d.params.clientConfig)):f==j.accountchooser.rpc.SelectRequest.METHOD[U]()?d.id&&(c=new j.accountchooser.rpc.SelectRequest(d.id,
d.params.localAccounts,d.params.clientConfig)):f==j.accountchooser.rpc.UpdateRequest.METHOD[U]()?d.id&&(d.params&&d.params.account)&&(c=new j.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==j.accountchooser.rpc.QueryRequest.METHOD[U]()?c=new j.accountchooser.rpc.QueryRequest(d.id,d.params.query,d.params.account,d.params.clientConfig):f==j.accountchooser.rpc.ClientReadyNotification.METHOD[U]()&&(c=new j.accountchooser.rpc.ClientReadyNotification)}}c?j.accountchooser.util.log(Pa+
b):j.accountchooser.util.log(pa+b);return c};j.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";j.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";j.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";j.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";j.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;j.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;j.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";j.accountchooser.rpc.IDP_TIMEOUT=3E3;
j.accountchooser.rpc.RPC_TIMEOUT=3E5;j.accountchooser.rpc.services_={};j.accountchooser.rpc.register=function(b,c){j.accountchooser[L].notEmpty(b,ob);j.accountchooser[L].notNull(c,ab);j.accountchooser.rpc.services_[b]=c};j.accountchooser.rpc.call=function(b,c,d){j.accountchooser[L].notEmpty(b,qb);c=c[y]();j.accountchooser.util.log(Ma+c);b[G](c,d||ea)};j.accountchooser.rpc.init_=function(b){j.addEventListener?j.addEventListener(eb,b,i):j[v]?j[v](hb,b):j[Q][v]?j[Q][v](hb,b):j.accountchooser.util.log(Ka)};
j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
j.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[q](/^https?:\/\//,V);var e=[],f=j[s].getItem(d);if(f){j[s][D](d);var l=j.JSON[M](f)||[],f=(new Date)[w]();if(l[N]){l=l[l[N]-1];try{var m=n[M](l);m&&m.timestamp&&f-m.timestamp<j.accountchooser.rpc.RPC_TIMEOUT?(e[H](l),c&&j[s].setItem(d,j.JSON[J](e))):j.accountchooser.util.log(wa+l+Ua)}catch(qa){j.accountchooser.util.log(xa+l+Ua)}}}return e};
j.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[q](/^https?:\/\//,V);j[s][D](j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);j[s][D](j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[H](c[y]());c=j.JSON[J](b);j[s].setItem(d,c)};
j.accountchooser.rpc.triggerSavedRpcs_=function(b){if(j[C]){var c=j.accountchooser.rpc.readSavedRpcObjects(b,i);if(c&&c[N])for(var d=0;d<c[N];d++)j[C][G](c[d],b);else j.accountchooser.rpc[S](j[C],new j.accountchooser.rpc.EmptyResponseNotification)}};j.accountchooser.rpc.saveAndAckRequest_=function(b,c){j.accountchooser.rpc.saveRpcObject(c,b,g);var d=new j.accountchooser.rpc.RequestAckNotification(b.id_);j[C][G](d[y](),c)};
j.accountchooser.rpc.handleQuery_=function(b,c){var d=i;switch(b.params_.query){case j.accountchooser.rpc.Queries.CDS_DISABLED:d=j.accountchooser.rpc.checkCdsDisabled_();break;case j.accountchooser.rpc.Queries.CDS_EMPTY:d=j.accountchooser.rpc.checkCdsEmpty_(b.params_.clientConfig);break;case j.accountchooser.rpc.Queries.ACCOUNT_EXIST:d=j.accountchooser.rpc.checkAccountExist_(b.params_.account,b.params_.clientConfig);break;default:j.accountchooser.rpc.sendInvalidQueryResponse_(b,c);return}d=new j.accountchooser.rpc.Response(b.id_,
d);j[C][G](d[y](),c)};j.accountchooser.rpc.checkCdsDisabled_=function(){return j.accountchooser.util.browserconfig.isDisabled()};j.accountchooser.rpc.checkCdsEmpty_=function(b){return!j.accountchooser.rpc.getAllAccountsByClientConfig_(b)[N]};j.accountchooser.rpc.checkAccountExist_=function(b,c){for(var d=j.accountchooser.rpc.getAllAccountsByClientConfig_(c),e=0;e<d[N];++e){var f=d[e];if(j.accountchooser.util.accountstorage.matchAccount_(b,f.email,f.providerId))return g}return i};
j.accountchooser.rpc.getAllAccountsByClientConfig_=function(b){return j.accountchooser.util.accountstorage.readAccounts({withEmail:b&&!b.showAll,idpList:b&&b.idpFilter})};j.accountchooser.rpc.sendErrorResponse_=function(b,c,d){b=new j.accountchooser.rpc.Response(c.id_,a,b);j[C][G](b[y](),d)};j.accountchooser.rpc.sendDisableResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32601,message:Ca,data:Na},b,c)};
j.accountchooser.rpc.sendInvalidQueryResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32602,message:Aa,data:Qa+b.params_.query+ba},b,c)};
j.accountchooser.rpc.process_=function(b){j.accountchooser.util.log(Ja+b[r]+aa+b[p]);var c=j.accountchooser.rpc.parseRpcObject(b[r]);c?c instanceof j.accountchooser.rpc.ClientReadyNotification?j.accountchooser.rpc.triggerSavedRpcs_(b[p]):c instanceof j.accountchooser.rpc[I]?c instanceof j.accountchooser.rpc.QueryRequest?j.accountchooser.rpc.handleQuery_(c,b[p]):j.accountchooser.rpc.saveAndAckRequest_(c,b[p]):j.accountchooser.util.log(Ra+b[r]):j.accountchooser.util.log(ma+b[r])};j.accountchooser.rpc.init_(j.accountchooser.rpc.process_);})()
