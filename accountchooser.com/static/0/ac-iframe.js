/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var a=void 0,g=!0,h=null,i=!1,j=window,k=document,n=JSON;function p(b,c){return b.toJSON=c}
var q="origin",r="replace",s="data",t="sessionStorage",u="trim",v="setAttribute",w="attachEvent",x="getTime",y="documentElement",z="toString",A="toJSON",B="split",C="localStorage",D="parent",E="removeItem",F="displayName",G="isArray",H="postMessage",I="push",J="Request",K="stringify",L="indexOf",M="param",N="parse",O="length",P="prototype",Q="clientWidth",R="document",S="body",T="call",U="clientHeight",V="toLowerCase",W="",aa=" from ",ba='" is invalid.',ca="&",da="(^|;) ?",ea="*",fa="2.0",ga="; expires=",
ha="; path=/",X="=",ia="=([^;]*)(;|$)",ja="=; expires=",ka="?",la="@",ma="Clear CDS browser config.",na="Error request format: ",oa="Failed to clear from DOM storage: ",pa="Failed to clear from cookie: ",ra="Failed to parse request: ",sa="Failed to read from DOM storage: ",ta="Failed to read from cookie: ",ua="Failed to write to DOM storage: ",va="Failed to write to cookie: ",wa="Get CDS browser config: ",xa="Ignore expired JSON-RPC object: [",ya="Ignore invalid JSON-RPC object: [",za="Invalid JSON-RPC object: not a JSON object.",
Aa="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Ba="Invalid parameter",Ca="MSIE",Da="Method not found",Ea="Parameter %%param%% cannot be an empty array.",Fa="Parameter %%param%% cannot be empty.",Ga="Parameter %%param%% cannot be null.",Ha="Parameter %%param%% is not a function.",Ia="Parameter %%param%% is not an array.",Ja="Read saved accounts from storage: ",Ka="Received message: ",La="Register handler for postMessage failed.",Ma="Save accounts to storage: ",Na="Send message: ",
Oa="Service is disabled. Method is not available.",Pa="Set CDS browser config: ",Qa="Successfully parsing request: ",Ra='The query "',Sa="Unrecognized rpcObject: ",Ta="[object Array]",Ua="[object Function]",Va="]",Wa="account",Xa="accounts",Ya="chooserAccounts",Za="cookieName",$a="disabled",ab="domStorageKey",bb="form",cb="handler",db="hidden",Y="id",eb="input",fb="localStorage",gb="message",hb="name",ib="object",jb="onmessage",kb="opt_cookieName",lb="opt_domStorageKey || opt_cookieName",mb="parentClass",
nb="post",ob="query",pb="requestId",qb="serviceName",rb="sessionStorage",sb="targetWindow",tb="type",ub="value",Z;j.accountchooser=j.accountchooser||{};j.cds=j.accountchooser;j.accountchooser.util=j.accountchooser.util||{};j.accountchooser.util.log=function(b){try{j.console&&j.console.log&&j.console.log(b)}catch(c){}};j.accountchooser.util.uuidCounter_=(new Date)[x]();j.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++j.accountchooser.util.uuidCounter_};
j.accountchooser.util.createForm_=function(b,c,d){if(!b)throw"The targetUrl cannot be null.";var e=j[R].createElement(bb);e.method=nb;e.action=b;if(c)for(var f in c)b=j[R].createElement(eb),b[v](tb,db),b[v](hb,f),c[f]===h||c[f]===a?b[v](ub,W):b[v](ub,c[f]),e.appendChild(b);d&&(e.target=d);j[R][S].appendChild(e);return e};j.accountchooser.util.postTo=function(b,c,d){b=j.accountchooser.util.createForm_(b,c,d);b.submit();j[R][S].removeChild(b)};
j.accountchooser.util.parseUrlParams=function(b){var c={};b=b.slice(b[L](ka)+1)[B](ca);for(var d=0;d<b[O];d++){var e=b[d][B](X);c[e[0]]=2==e[O]?decodeURIComponent(e[1]):a}return c};j.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[L](ka)),e=j.accountchooser.util.parseUrlParams(b);j.accountchooser.util.postTo(d,e,c)};j.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=navigator.appVersion[L](Ca)&&(b=parseFloat(navigator.appVersion[B](Ca)[1]));return 7<b};
j.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[I](c[e]?e+X+c[e]:e);return b+ka+d.join(ca)};j.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};
j.accountchooser.util.sanitizeAccount=function(b,c){var d={},e=j.accountchooser.util.AccountPropertyKey,f;for(f in b)switch(f){case e.EMAIL:case e.DISPLAY_NAME:case e.PHOTO_URL:case e.PROVIDER_ID:d[f]=b[f];break;default:if(!c)throw'Unrecognized key "'+f+'" for account';}return d};j.accountchooser.util.sanitizeAccounts=function(b){for(var c=[],d=0,e=b[O];d<e;d++){var f=j.accountchooser.util.sanitizeAccount(b[d]);c[I](f)}return c};
j.accountchooser.util.isArray=function(b){return"undefined"!==typeof jQuery?jQuery[G](b):Object[P][z][T](b)===Ta};j.accountchooser.util.isFunction=function(b){return"undefined"!==typeof jQuery?jQuery.isFunction(b):Object[P][z][T](b)===Ua};j.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(b,c);if(c[L])return c[L](b);for(var d=c[O],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};
j.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof jQuery)return jQuery(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[R]&&b[R][y]&&b[R][y][Q]?c=b[R][y][Q]:b[R]&&(b[R][S]&&b[R][S][Q])&&(c=b[R][S][Q]);return c};j.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof jQuery)return jQuery(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[R]&&b[R][y]&&b[R][y][U]?c=b[R][y][U]:b[R]&&(b[R][S]&&b[R][S][U])&&(c=b[R][S][U]);return c};
j.accountchooser.util.trim=function(b){return"undefined"!==typeof jQuery?jQuery[u](b):b==h?W:String[P][u]?String[P][u][T](b):b[r](/^[\s\xa0]+/,W)[r](/[\s\xa0]+$/,W)};
j.accountchooser.util.extend=function(b,c,d){if(3>arguments[O])return c||{};if("undefined"!==typeof jQuery){var e=Array[P].slice[T](arguments,b?0:1);return jQuery.extend.apply(jQuery,e)}if(typeof c!==ib||c==h)c={};for(var e=2,f=arguments[O];e<f;e++){var l=arguments[e];if(l!=h)for(var m in l)l[m]===a||c===l[m]||(b&&typeof l[m]==ib?(j.accountchooser.util[G](l[m])&&!j.accountchooser.util[G](c[m])&&(c[m]=[]),c[m]=j.accountchooser.util.extend(g,c[m],l[m])):c[m]=l[m])}return c};j.accountchooser.param={};
j.accountchooser[M].notNull=function(b,c){(b===a||b===h)&&j.accountchooser[M].throwError_(Ga,c)};j.accountchooser[M].notEmpty=function(b,c){b||j.accountchooser[M].throwError_(Fa,c)};j.accountchooser[M].notEmptyArray=function(b,c){b||j.accountchooser[M].throwError_(Fa,c);j.accountchooser.util[G](b)||j.accountchooser[M].throwError_(Ia,c);b[O]||j.accountchooser[M].throwError_(Ea,c)};
j.accountchooser[M].notEmptyFunction=function(b,c){b||j.accountchooser[M].throwError_(Fa,c);j.accountchooser.util.isFunction(b)||j.accountchooser[M].throwError_(Ha,c)};j.accountchooser[M].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}throw b[r](/\%\%param\%\%/g,c?" '"+c+"'":W);};Function[P].inheritsFrom=function(b){j.accountchooser[M].notEmptyFunction(b,mb);this.prototype=new b;this[P].constructor=this;this[P].parentClass=b[P]};
j.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;j.accountchooser.util.isValidEmail=function(b){return b&&h!=j.accountchooser.util.VALID_EMAIL_REGEX_.exec(b)};j.accountchooser.util.isValidDomain=function(b){return b&&h!=j.accountchooser.util.VALID_DOMAIN_REGEX_.exec(b)};
j.accountchooser.util.getEmailDomain=function(b){if((b=j.accountchooser.util[u](b))&&j.accountchooser.util.isValidEmail(b))return b[B](la)[1][V]()};j.accountchooser.util.getEmailUsername=function(b){if((b=j.accountchooser.util[u](b))&&j.accountchooser.util.isValidEmail(b))return b[B](la)[0][V]()};j.accountchooser.util.isDomainInNascar=function(b){if(b){var c=j.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};
j.accountchooser.util.Storage=function(b,c,d){j.accountchooser[M].notEmpty(b||c,lb);j.accountchooser.util.Storage.isDomStorageSupported(d)||j.accountchooser[M].notEmpty(c,kb);this.domStorageKey_=b;this.cookieName_=c;this.perSession_=d};j.accountchooser.util.Storage.isDomStorageSupported=function(b){try{return b?rb in j&&j[t]!=h:fb in j&&j[C]!=h}catch(c){return i}};Z=j.accountchooser.util.Storage[P];
Z.read=function(){if(j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(b){j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};
Z.clear=function(){j.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){j.accountchooser[M].notEmpty(this.domStorageKey_,ab);var b=this.perSession_?j[t]:j[C];try{var c=b.getItem(this.domStorageKey_);if(c)return n[N](c)}catch(d){j.accountchooser.util.log(sa+d)}};Z.writeToDomStorage_=function(b){j.accountchooser[M].notEmpty(this.domStorageKey_,ab);var c=this.perSession_?j[t]:j[C];try{var d=n[K](b);c.setItem(this.domStorageKey_,d)}catch(e){j.accountchooser.util.log(ua+e)}};
Z.clearFromDomStorage_=function(){j.accountchooser[M].notEmpty(this.domStorageKey_,ab);var b=this.perSession_?j[t]:j[C];try{b[E](this.domStorageKey_)}catch(c){j.accountchooser.util.log(oa+c)}};Z.readFromCookie_=function(){j.accountchooser[M].notEmpty(this.cookieName_,Za);var b=k.cookie.match(da+this.cookieName_+ia);if(b&&(b=j.accountchooser.util[u](b[2])))try{return n[N](unescape(b))}catch(c){j.accountchooser.util.log(ta+c)}};
Z.writeToCookie_=function(b){j.accountchooser[M].notEmpty(this.cookieName_,Za);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),l=new Date(d,e,f),m=this.perSession_?0:l.toGMTString();k.cookie=this.cookieName_+X+escape(n[K](b))+ga+m+ha}catch(qa){j.accountchooser.util.log(va+qa)}};
Z.clearFromCookie_=function(){j.accountchooser[M].notEmpty(this.cookieName_,Za);try{var b=new Date;b.setTime(b[x]()-1);k.cookie=this.cookieName_+ja+b.toGMTString()+ha}catch(c){j.accountchooser.util.log(pa+c)}};j.accountchooser.util.accountstorage={};j.accountchooser.util.accountstorage.ACCOUNTS_=Ya;j.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_,j.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
j.accountchooser.util.accountstorage.read_=function(){var b=j.accountchooser.util.accountstorage.storage_.read();j.accountchooser.util.log(Ja+n[K](b));return b};j.accountchooser.util.accountstorage.write_=function(b){j.accountchooser.util.log(Ma+n[K](b));j.accountchooser.util.accountstorage.storage_.write(b)};j.accountchooser.util.accountstorage.readAccounts=function(){var b=j.accountchooser.util.accountstorage.read_();if(!b||!j.accountchooser.util[G](b))b=[];return b};
j.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[O];f++)if(j.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=g;break}e&&(!b[F]&&e[F]&&(b.displayName=e[F]),!b.photoUrl&&e.photoUrl&&(b.photoUrl=e.photoUrl));d.unshift(b);j.accountchooser.util.accountstorage.write_(d);return!c};
j.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return i;for(var c=i,d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[O];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=g;break}j.accountchooser.util.accountstorage.write_(d);return c};j.accountchooser.util.accountstorage.clearAccounts=function(){j.accountchooser.util.accountstorage.storage_.clear()};
j.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=j.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[O];f++)if(j.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);j.accountchooser.util.accountstorage.write_(e);break}};
j.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&j.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[F]&&(c.displayName=b[F]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=a&&(c.legacy=b.legacy)},b.providerId)};
j.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=j.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[O];e++)if(j.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);j.accountchooser.util.accountstorage.write_(d);return f}};j.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?i:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?g:i};j.accountchooser.updateSavedAccount=function(b){j.accountchooser.util.accountstorage.addAccount(b)};
j.accountchooser.removeSavedAccount=function(b){return j.accountchooser.util.accountstorage.removeAccount(b)};j.accountchooser.clearSavedAccounts=function(){j.accountchooser.util.accountstorage.clearAccounts()};j.accountchooser.util.accountstorage.ACCOUNTS_=Ya;j.accountchooser.util.accountstorage.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.accountstorage.ACCOUNTS_);j.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
j.accountchooser.util.accountstorage.readAccounts=function(b){var c=j.accountchooser.util.accountstorage.read_();if(!c||!j.accountchooser.util[G](c))c=[];if(!b)return c;var d=[];if(b.withEmail){var e=function(b){return j.accountchooser.util.isValidEmail(b.email)};d[I](e)}b.idpList&&0!=b.idpList[O]&&(e=function(c){return 0<=j.accountchooser.util[L](c.providerId||j.accountchooser.util.accountstorage.NO_IDP_,b.idpList)},d[I](e));b.emailDomainList&&0!=b.emailDomainList[O]&&(e=function(c){return(c=j.accountchooser.util.getEmailDomain(c.email))?
0<=j.accountchooser.util[L](c,b.emailDomainList):g},d[I](e));for(e=0;e<d[O];e++)c=j.accountchooser.util.accountstorage.filter_(c,d[e]);return c};j.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[O];e++)c(b[e])&&d[I](b[e]);return d};j.accountchooser.util.browserconfig={};j.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";j.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
j.accountchooser.util.browserconfig.storage_=new j.accountchooser.util.Storage(j.accountchooser.util.browserconfig.SETTINGS_KEY_,j.accountchooser.util.browserconfig.COOKIE_NAME_);j.accountchooser.util.browserconfig.getAll=function(){var b=j.accountchooser.util.browserconfig.storage_.read()||{};j.accountchooser.util.log(wa+n[K](b));return b};j.accountchooser.util.browserconfig.setAll=function(b){j.accountchooser.util.log(Pa+n[K](b));j.accountchooser.util.browserconfig.storage_.write(b)};
j.accountchooser.util.browserconfig.clearAll=function(){j.accountchooser.util.log(ma);j.accountchooser.util.browserconfig.storage_.clear()};j.accountchooser.util.browserconfig.get=function(b){return j.accountchooser.util.browserconfig.getAll()[b]};j.accountchooser.util.browserconfig.set=function(b,c){var d=j.accountchooser.util.browserconfig.getAll();d[b]=c;j.accountchooser.util.browserconfig.setAll(d)};
j.accountchooser.util.browserconfig.clear=function(b){var c=j.accountchooser.util.browserconfig.getAll();delete c[b];j.accountchooser.util.browserconfig.setAll(c)};j.accountchooser.util.browserconfig.isDisabled=function(){return!!j.accountchooser.util.browserconfig.get($a)};j.accountchooser.util.browserconfig.setDisabled=function(b){j.accountchooser.util.browserconfig.set($a,!!b)};j.accountchooser.rpc=j.accountchooser.rpc||{};j.accountchooser.rpc.RpcObject=function(){};
j.accountchooser.rpc.RpcObject[P].setTimestamp=function(b){this.timestamp_=b||(new Date)[x]()};p(j.accountchooser.rpc.RpcObject[P],function(){var b={jsonrpc:fa};this.timestamp_!=h&&(b.timestamp=this.timestamp_);return b});j.accountchooser.rpc.RpcObject[P].toString=function(){return n[K](this[A]())};j.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.AbstractRequest.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.AbstractRequest[P];
Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};p(Z,function(){var b=j.accountchooser.rpc.RpcObject[P][A][T](this);this.method_!=h&&(b.method=this.method_);this.params_!=h&&(b.params=this.params_);return b});j.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};j.accountchooser.rpc.Notification.inheritsFrom(j.accountchooser.rpc.AbstractRequest);
j.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};j.accountchooser.rpc[J].inheritsFrom(j.accountchooser.rpc.AbstractRequest);j.accountchooser.rpc[J][P].setId=function(b){this.id_=b};j.accountchooser.rpc[J][P].getId=function(){return this.id_};p(j.accountchooser.rpc[J][P],function(){var b=j.accountchooser.rpc.AbstractRequest[P][A][T](this);this.id_!=h&&(b.id=this.id_);return b});
j.accountchooser.rpc.Response=function(b,c,d){j.accountchooser[M].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};j.accountchooser.rpc.Response.inheritsFrom(j.accountchooser.rpc.RpcObject);Z=j.accountchooser.rpc.Response[P];Z.getResult=function(){return this.result_};Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};
p(Z,function(){var b=j.accountchooser.rpc.RpcObject[P][A][T](this);b.id=this.id_;this.result_!=h?b.result=this.result_:this.error_!=h&&(b.error=this.error_);return b});j.accountchooser.rpc.RequestAckNotification=function(b){j.accountchooser[M].notEmpty(b,pb);this.method_=j.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};j.accountchooser.rpc.RequestAckNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
j.accountchooser.rpc.RequestAckNotification[P].setRequestId=function(b){this.params_.requestId=b};j.accountchooser.rpc.RequestAckNotification[P].getRequestId=function(){return this.params_.requestId};j.accountchooser.rpc.CdsReadyNotification=function(){this.method_=j.accountchooser.rpc.CdsReadyNotification.METHOD};j.accountchooser.rpc.CdsReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
j.accountchooser.rpc.ClientReadyNotification=function(){this.method_=j.accountchooser.rpc.ClientReadyNotification.METHOD};j.accountchooser.rpc.ClientReadyNotification.inheritsFrom(j.accountchooser.rpc.Notification);j.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";j.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=j.accountchooser.rpc.EmptyResponseNotification.METHOD};j.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(j.accountchooser.rpc.Notification);
j.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";j.accountchooser.rpc.StoreRequest=function(b,c,d){j.accountchooser[M].notEmpty(b,Y);j.accountchooser[M].notEmptyArray(c,Xa);c&&(c=j.accountchooser.util.sanitizeAccounts(c));this.method_=j.accountchooser.rpc.StoreRequest.METHOD;this.params_={accounts:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.StoreRequest.inheritsFrom(j.accountchooser.rpc[J]);j.accountchooser.rpc.StoreRequest.METHOD="store";
j.accountchooser.rpc.SelectRequest=function(b,c,d){j.accountchooser[M].notEmpty(b,Y);c&&(c=j.accountchooser.util.sanitizeAccounts(c));this.method_=j.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.SelectRequest.inheritsFrom(j.accountchooser.rpc[J]);j.accountchooser.rpc.SelectRequest.METHOD="select";
j.accountchooser.rpc.UpdateRequest=function(b,c,d){j.accountchooser[M].notEmpty(b,Y);j.accountchooser[M].notEmpty(c,Wa);c&&(c=j.accountchooser.util.sanitizeAccount(c));this.method_=j.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};j.accountchooser.rpc.UpdateRequest.inheritsFrom(j.accountchooser.rpc[J]);j.accountchooser.rpc.UpdateRequest.METHOD="update";
j.accountchooser.rpc.ManageRequest=function(b,c){j.accountchooser[M].notEmpty(b,Y);this.method_=j.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};j.accountchooser.rpc.ManageRequest.inheritsFrom(j.accountchooser.rpc[J]);j.accountchooser.rpc.ManageRequest.METHOD="manage";j.accountchooser.rpc.AboutRequest=function(b,c){j.accountchooser[M].notEmpty(b,Y);this.method_=j.accountchooser.rpc.AboutRequest.METHOD;this.params_={clientConfig:c};this.id_=b};j.accountchooser.rpc.AboutRequest.inheritsFrom(j.accountchooser.rpc[J]);
j.accountchooser.rpc.AboutRequest.METHOD="about";j.accountchooser.rpc.QueryRequest=function(b,c,d,e){j.accountchooser[M].notEmpty(b,Y);j.accountchooser[M].notEmpty(c,ob);d&&(d=j.accountchooser.util.sanitizeAccount(d));this.method_=j.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};j.accountchooser.rpc.QueryRequest.inheritsFrom(j.accountchooser.rpc[J]);j.accountchooser.rpc.QueryRequest.METHOD=ob;
j.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};
j.accountchooser.rpc.parseRpcObject=function(b){var c=h;if(b){try{var d=n[N](b)}catch(e){return j.accountchooser.util.log(za),c}if(!d||d.jsonrpc!=fa)j.accountchooser.util.log(Aa);else if(d.method){var f=d.method[V]();f==j.accountchooser.rpc.StoreRequest.METHOD[V]()?d.id&&(d.params&&d.params.accounts)&&(c=new j.accountchooser.rpc.StoreRequest(d.id,d.params.accounts,d.params.clientConfig)):f==j.accountchooser.rpc.SelectRequest.METHOD[V]()?d.id&&(c=new j.accountchooser.rpc.SelectRequest(d.id,d.params.localAccounts,
d.params.clientConfig)):f==j.accountchooser.rpc.UpdateRequest.METHOD[V]()?d.id&&(d.params&&d.params.account)&&(c=new j.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==j.accountchooser.rpc.QueryRequest.METHOD[V]()?c=new j.accountchooser.rpc.QueryRequest(d.id,d.params.query,d.params.account,d.params.clientConfig):f==j.accountchooser.rpc.ClientReadyNotification.METHOD[V]()&&(c=new j.accountchooser.rpc.ClientReadyNotification)}}c?j.accountchooser.util.log(Qa+b):j.accountchooser.util.log(ra+
b);return c};j.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";j.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";j.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";j.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";j.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;j.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;j.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";j.accountchooser.rpc.IDP_TIMEOUT=3E3;j.accountchooser.rpc.RPC_TIMEOUT=3E5;
j.accountchooser.rpc.services_={};j.accountchooser.rpc.register=function(b,c){j.accountchooser[M].notEmpty(b,qb);j.accountchooser[M].notNull(c,cb);j.accountchooser.rpc.services_[b]=c};j.accountchooser.rpc.call=function(b,c,d){j.accountchooser[M].notEmpty(b,sb);c=c[z]();j.accountchooser.util.log(Na+c);b[H](c,d||ea)};j.accountchooser.rpc.init_=function(b){j.addEventListener?j.addEventListener(gb,b,i):j[w]?j[w](jb,b):j[R][w]?j[R][w](jb,b):j.accountchooser.util.log(La)};
j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
j.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[r](/^https?:\/\//,W);var e=[],f=j[t].getItem(d);if(f){j[t][E](d);var l=j.JSON[N](f)||[],f=(new Date)[x]();if(l[O]){l=l[l[O]-1];try{var m=n[N](l);m&&m.timestamp&&f-m.timestamp<j.accountchooser.rpc.RPC_TIMEOUT?(e[I](l),c&&j[t].setItem(d,j.JSON[K](e))):j.accountchooser.util.log(xa+l+Va)}catch(qa){j.accountchooser.util.log(ya+l+Va)}}}return e};
j.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[r](/^https?:\/\//,W);j[t][E](j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);j[t][E](j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?j.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:j.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[I](c[z]());c=j.JSON[K](b);j[t].setItem(d,c)};
j.accountchooser.rpc.triggerSavedRpcs_=function(b){if(j[D]){var c=j.accountchooser.rpc.readSavedRpcObjects(b,i);if(c&&c[O])for(var d=0;d<c[O];d++)j[D][H](c[d],b);else j.accountchooser.rpc[T](j[D],new j.accountchooser.rpc.EmptyResponseNotification)}};j.accountchooser.rpc.saveAndAckRequest_=function(b,c){j.accountchooser.rpc.saveRpcObject(c,b,g);var d=new j.accountchooser.rpc.RequestAckNotification(b.id_);j[D][H](d[z](),c)};
j.accountchooser.rpc.handleQuery_=function(b,c){var d=i;switch(b.params_.query){case j.accountchooser.rpc.Queries.CDS_DISABLED:d=j.accountchooser.rpc.checkCdsDisabled_();break;case j.accountchooser.rpc.Queries.CDS_EMPTY:d=j.accountchooser.rpc.checkCdsEmpty_(b.params_.clientConfig);break;case j.accountchooser.rpc.Queries.ACCOUNT_EXIST:d=j.accountchooser.rpc.checkAccountExist_(b.params_.account,b.params_.clientConfig);break;default:j.accountchooser.rpc.sendInvalidQueryResponse_(b,c);return}d=new j.accountchooser.rpc.Response(b.id_,
d);j[D][H](d[z](),c)};j.accountchooser.rpc.checkCdsDisabled_=function(){return j.accountchooser.util.browserconfig.isDisabled()};j.accountchooser.rpc.checkCdsEmpty_=function(){return!j.accountchooser.util.accountstorage.readAccounts()[O]};j.accountchooser.rpc.checkAccountExist_=function(b){for(var c=j.accountchooser.util.accountstorage.readAccounts(),d=0;d<c[O];++d){var e=c[d];if(j.accountchooser.util.accountstorage.matchAccount_(b,e.email,e.providerId))return g}return i};
j.accountchooser.rpc.getAllAccountsByClientConfig_=function(b){return j.accountchooser.util.accountstorage.readAccounts({withEmail:b&&!b.showAll,idpList:b&&b.idpFilter})};j.accountchooser.rpc.sendErrorResponse_=function(b,c,d){b=new j.accountchooser.rpc.Response(c.id_,a,b);j[D][H](b[z](),d)};j.accountchooser.rpc.sendDisableResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32601,message:Da,data:Oa},b,c)};
j.accountchooser.rpc.sendInvalidQueryResponse_=function(b,c){j.accountchooser.rpc.sendErrorResponse_({code:-32602,message:Ba,data:Ra+b.params_.query+ba},b,c)};
j.accountchooser.rpc.process_=function(b){j.accountchooser.util.log(Ka+b[s]+aa+b[q]);var c=j.accountchooser.rpc.parseRpcObject(b[s]);c?c instanceof j.accountchooser.rpc.ClientReadyNotification?j.accountchooser.rpc.triggerSavedRpcs_(b[q]):c instanceof j.accountchooser.rpc[J]?c instanceof j.accountchooser.rpc.QueryRequest?j.accountchooser.rpc.handleQuery_(c,b[q]):j.accountchooser.rpc.saveAndAckRequest_(c,b[q]):j.accountchooser.util.log(Sa+b[s]):j.accountchooser.util.log(na+b[s])};j.accountchooser.rpc.init_(j.accountchooser.rpc.process_);})()
