/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var b=null,g=!1,h=window,i=document,k=JSON,l="sessionStorage",n="trim",o="setAttribute",p="documentElement",q="localStorage",r="displayName",s="isArray",t="push",u="stringify",v="indexOf",w="param",x="length",y="prototype",z="clientWidth",A="document",B="body",C="call",D="clientHeight",E="",F="&",G="(^|;) ?",H="; expires=",I="; path=/",J="=",K="=([^;]*)(;|$)",L="=; expires=",M="?",N="Clear CDS browser config.",O="Failed to clear from DOM storage: ",P="Failed to clear from cookie: ",Q="Failed to read from DOM storage: ",
aa="Failed to read from cookie: ",ba="Failed to write to DOM storage: ",ca="Failed to write to cookie: ",da="Get CDS browser config: ",R="MSIE",ea="Parameter %%param%% cannot be an empty array.",S="Parameter %%param%% cannot be empty.",fa="Parameter %%param%% cannot be null.",ga="Parameter %%param%% is not a function.",ha="Parameter %%param%% is not an array.",ia="Read saved accounts from storage: ",ja="Save accounts to storage: ",ka="Set CDS browser config: ",la="[object Array]",ma="[object Function]",
T="chooserAccounts",U="cookieName",V="disabled",W="domStorageKey",na="form",oa="hidden",pa="input",qa="localStorage",ra="name",X="object",sa="opt_cookieName",ta="opt_domStorageKey || opt_cookieName",ua="parentClass",va="post",wa="sessionStorage",xa="type",Y="value",Z;h.accountchooser=h.accountchooser||{};h.cds=h.accountchooser;h.accountchooser.util=h.accountchooser.util||{};h.accountchooser.util.log=function(a){try{h.console&&h.console.log&&h.console.log(a)}catch(c){}};
h.accountchooser.util.uuidCounter_=(new Date).getTime();h.accountchooser.util.generateUuid=function(a){return a&&a.uuid?a.uuid:++h.accountchooser.util.uuidCounter_};h.accountchooser.util.createForm_=function(a,c,e){if(!a)throw"The targetUrl cannot be null.";var d=h[A].createElement(na);d.method=va;d.action=a;if(c)for(var f in c)a=h[A].createElement(pa),a[o](xa,oa),a[o](ra,f),c[f]===b||void 0===c[f]?a[o](Y,E):a[o](Y,c[f]),d.appendChild(a);e&&(d.target=e);h[A][B].appendChild(d);return d};
h.accountchooser.util.postTo=function(a,c,e){a=h.accountchooser.util.createForm_(a,c,e);a.submit();h[A][B].removeChild(a)};h.accountchooser.util.parseUrlParams=function(a){for(var c={},a=a.slice(a[v](M)+1).split(F),e=0;e<a[x];e++){var d=a[e].split(J);c[d[0]]=2==d[x]?decodeURIComponent(d[1]):void 0}return c};h.accountchooser.util.formRedirect=function(a,c){var e=a.substring(0,a[v](M)),d=h.accountchooser.util.parseUrlParams(a);h.accountchooser.util.postTo(e,d,c)};
h.accountchooser.util.isBrowserSupported=function(){var a=999;-1!=navigator.appVersion[v](R)&&(a=parseFloat(navigator.appVersion.split(R)[1]));return 7<a};h.accountchooser.util.makeUrl=function(a,c){var e=[],d;for(d in c)e[t](c[d]?d+J+c[d]:d);return a+M+e.join(F)};h.accountchooser.util.isArray=function(a){return"undefined"!==typeof jQuery?jQuery[s](a):Object[y].toString[C](a)===la};
h.accountchooser.util.isFunction=function(a){return"undefined"!==typeof jQuery?jQuery.isFunction(a):Object[y].toString[C](a)===ma};h.accountchooser.util.indexOf=function(a,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(a,c);if(c[v])return c[v](a);for(var e=c[x],d=0;d<e;d++)if(d in c&&c[d]===a)return d}return-1};
h.accountchooser.util.windowWidth=function(a){if("undefined"!==typeof jQuery)return jQuery(a).width();var c=0;a.innerWidth?c=a.innerWidth:a[A]&&a[A][p]&&a[A][p][z]?c=a[A][p][z]:a[A]&&(a[A][B]&&a[A][B][z])&&(c=a[A][B][z]);return c};h.accountchooser.util.windowHeight=function(a){if("undefined"!==typeof jQuery)return jQuery(a).height();var c=0;a.innerHeight?c=a.innerHeight:a[A]&&a[A][p]&&a[A][p][D]?c=a[A][p][D]:a[A]&&(a[A][B]&&a[A][B][D])&&(c=a[A][B][D]);return c};
h.accountchooser.util.trim=function(a){return"undefined"!==typeof jQuery?jQuery[n](a):a==b?E:String[y][n]?String[y][n][C](a):a.replace(/^[\s\xa0]+/,E).replace(/[\s\xa0]+$/,E)};
h.accountchooser.util.extend=function(a,c,e){if(3>arguments[x])return c||{};if("undefined"!==typeof jQuery){var d=Array[y].slice[C](arguments,a?0:1);return jQuery.extend.apply(jQuery,d)}if(typeof c!==X||c==b)c={};for(var d=2,f=arguments[x];d<f;d++){var m=arguments[d];if(m!=b)for(var j in m)void 0===m[j]||c===m[j]||(a&&typeof m[j]==X?(h.accountchooser.util[s](m[j])&&!h.accountchooser.util[s](c[j])&&(c[j]=[]),c[j]=h.accountchooser.util.extend(!0,c[j],m[j])):c[j]=m[j])}return c};
h.accountchooser.param={};h.accountchooser[w].notNull=function(a,c){(void 0===a||a===b)&&h.accountchooser[w].throwError_(fa,c)};h.accountchooser[w].notEmpty=function(a,c){a||h.accountchooser[w].throwError_(S,c)};h.accountchooser[w].notEmptyArray=function(a,c){a||h.accountchooser[w].throwError_(S,c);h.accountchooser.util[s](a)||h.accountchooser[w].throwError_(ha,c);a[x]||h.accountchooser[w].throwError_(ea,c)};
h.accountchooser[w].notEmptyFunction=function(a,c){a||h.accountchooser[w].throwError_(S,c);h.accountchooser.util.isFunction(a)||h.accountchooser[w].throwError_(ga,c)};h.accountchooser[w].throwError_=function(a,c){try{console&&console.trace&&console.trace()}catch(e){}throw a.replace(/\%\%param\%\%/g,c?" '"+c+"'":E);};Function[y].inheritsFrom=function(a){h.accountchooser[w].notEmptyFunction(a,ua);this.prototype=new a;this[y].constructor=this;this[y].parentClass=a[y]};
h.accountchooser.util.Storage=function(a,c,e){h.accountchooser[w].notEmpty(a||c,ta);h.accountchooser.util.Storage.isDomStorageSupported(e)||h.accountchooser[w].notEmpty(c,sa);this.domStorageKey_=a;this.cookieName_=c;this.perSession_=e};h.accountchooser.util.Storage.isDomStorageSupported=function(a){try{return a?wa in h&&h[l]!=b:qa in h&&h[q]!=b}catch(c){return g}};Z=h.accountchooser.util.Storage[y];
Z.read=function(){if(h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(a){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(a):this.isCookieStorageAllowed_()&&this.writeToCookie_(a)};
Z.clear=function(){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){h.accountchooser[w].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[l]:h[q];try{var c=a.getItem(this.domStorageKey_);if(c)return k.parse(c)}catch(e){h.accountchooser.util.log(Q+e)}};Z.writeToDomStorage_=function(a){h.accountchooser[w].notEmpty(this.domStorageKey_,W);var c=this.perSession_?h[l]:h[q];try{var e=k[u](a);c.setItem(this.domStorageKey_,e)}catch(d){h.accountchooser.util.log(ba+d)}};
Z.clearFromDomStorage_=function(){h.accountchooser[w].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[l]:h[q];try{a.removeItem(this.domStorageKey_)}catch(c){h.accountchooser.util.log(O+c)}};Z.readFromCookie_=function(){h.accountchooser[w].notEmpty(this.cookieName_,U);var a=i.cookie.match(G+this.cookieName_+K);if(a&&(a=h.accountchooser.util[n](a[2])))try{return k.parse(unescape(a))}catch(c){h.accountchooser.util.log(aa+c)}};
Z.writeToCookie_=function(a){h.accountchooser[w].notEmpty(this.cookieName_,U);try{var c=new Date,e=c.getFullYear()+10,d=c.getMonth(),f=c.getDate(),m=new Date(e,d,f),j=this.perSession_?0:m.toGMTString();i.cookie=this.cookieName_+J+escape(k[u](a))+H+j+I}catch(ya){h.accountchooser.util.log(ca+ya)}};
Z.clearFromCookie_=function(){h.accountchooser[w].notEmpty(this.cookieName_,U);try{var a=new Date;a.setTime(a.getTime()-1);i.cookie=this.cookieName_+L+a.toGMTString()+I}catch(c){h.accountchooser.util.log(P+c)}};h.accountchooser.util.accountstorage={};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_,h.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
h.accountchooser.util.accountstorage.read_=function(){var a=h.accountchooser.util.accountstorage.storage_.read();h.accountchooser.util.log(ia+k[u](a));return a};h.accountchooser.util.accountstorage.write_=function(a){h.accountchooser.util.log(ja+k[u](a));h.accountchooser.util.accountstorage.storage_.write(a)};h.accountchooser.util.accountstorage.readAccounts=function(){var a=h.accountchooser.util.accountstorage.read_();if(!a||!h.accountchooser.util[s](a))a=[];return a};
h.accountchooser.util.accountstorage.addAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d,f=0;f<e[x];f++)if(h.accountchooser.util.accountstorage.matchAccount_(e[f],a.email,a.providerId)){d=e[f];e.splice(f,1);c=!0;break}if(d&&(!a[r]&&d[r]&&(a.displayName=d[r]),!a.photoUrl&&d.photoUrl))a.photoUrl=d.photoUrl;e.unshift(a);h.accountchooser.util.accountstorage.write_(e);return!c};
h.accountchooser.util.accountstorage.removeAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[x];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a.email,a.providerId)){e.splice(d,1);c=!0;break}h.accountchooser.util.accountstorage.write_(e);return c};h.accountchooser.util.accountstorage.clearAccounts=function(){h.accountchooser.util.accountstorage.storage_.clear()};
h.accountchooser.util.accountstorage.updateAccount=function(a,c,e){if(a)for(var d=h.accountchooser.util.accountstorage.readAccounts(),f=0;f<d[x];f++)if(h.accountchooser.util.accountstorage.matchAccount_(d[f],a,e)){c(d[f]);h.accountchooser.util.accountstorage.write_(d);break}};
h.accountchooser.util.accountstorage.refreshAccount=function(a){a&&a.email&&h.accountchooser.util.accountstorage.updateAccount(a.email,function(c){a[r]&&(c.displayName=a[r]);a.photoUrl&&(c.photoUrl=a.photoUrl);void 0!=a.legacy&&(c.legacy=a.legacy)})};
h.accountchooser.util.accountstorage.fetchAccount=function(a,c){if(a)for(var e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[x];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a,c)){var f=e[d];e.splice(d,1);e.unshift(f);h.accountchooser.util.accountstorage.write_(e);return f}};h.accountchooser.util.accountstorage.matchAccount_=function(a,c,e){return a.email!=c?g:a.providerId&&e&&a.providerId==e||!a.providerId&&!e?!0:g};h.accountchooser.updateSavedAccount=function(a){h.accountchooser.util.accountstorage.addAccount(a)};
h.accountchooser.removeSavedAccount=function(a){return h.accountchooser.util.accountstorage.removeAccount(a)};h.accountchooser.clearSavedAccounts=function(){h.accountchooser.util.accountstorage.clearAccounts()};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_);h.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
h.accountchooser.util.accountstorage.readAccounts=function(a){var c=h.accountchooser.util.accountstorage.read_();if(!c||!h.accountchooser.util[s](c))c=[];if(!a)return c;var e=[];if(a.withEmail){var d=function(a){return h.accountchooser.util.isValidEmail(a.email)};e[t](d)}a.idpList&&0!=a.idpList[x]&&(d=function(c){return 0<=h.accountchooser.util[v](c.providerId||h.accountchooser.util.accountstorage.NO_IDP_,a.idpList)},e[t](d));a.emailDomainList&&0!=a.emailDomainList[x]&&(d=function(c){return(c=h.accountchooser.util.getEmailDomain(c.email))?
h.accountchooser.util[v](c,a.emailDomainList)>=0:true},e[t](d));for(d=0;d<e[x];d++)c=h.accountchooser.util.accountstorage.filter_(c,e[d]);return c};h.accountchooser.util.accountstorage.filter_=function(a,c){for(var e=[],d=0;d<a[x];d++)c(a[d])&&e[t](a[d]);return e};h.accountchooser.util.browserconfig={};h.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";h.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
h.accountchooser.util.browserconfig.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.browserconfig.SETTINGS_KEY_,h.accountchooser.util.browserconfig.COOKIE_NAME_);h.accountchooser.util.browserconfig.getAll=function(){var a=h.accountchooser.util.browserconfig.storage_.read()||{};h.accountchooser.util.log(da+k[u](a));return a};h.accountchooser.util.browserconfig.setAll=function(a){h.accountchooser.util.log(ka+k[u](a));h.accountchooser.util.browserconfig.storage_.write(a)};
h.accountchooser.util.browserconfig.clearAll=function(){h.accountchooser.util.log(N);h.accountchooser.util.browserconfig.storage_.clear()};h.accountchooser.util.browserconfig.get=function(a){return h.accountchooser.util.browserconfig.getAll()[a]};h.accountchooser.util.browserconfig.set=function(a,c){var e=h.accountchooser.util.browserconfig.getAll();e[a]=c;h.accountchooser.util.browserconfig.setAll(e)};
h.accountchooser.util.browserconfig.clear=function(a){var c=h.accountchooser.util.browserconfig.getAll();delete c[a];h.accountchooser.util.browserconfig.setAll(c)};h.accountchooser.util.browserconfig.isDisabled=function(){return!!h.accountchooser.util.browserconfig.get(V)};h.accountchooser.util.browserconfig.setDisabled=function(a){h.accountchooser.util.browserconfig.set(V,!!a)};})()
