/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){function b(a){throw a;}var g=void 0,j=!0,k=null,l=!1,n=window,p=document,q=JSON,r=jQuery,aa=navigator;function ba(a,c){return a.toJSON=c}
var ca="origin",s="exec",t="replace",u="data",da="extend",v="sessionStorage",w="trim",x="createElement",y="setAttribute",ea="attachEvent",z="getTime",fa="getElementsByTagName",A="documentElement",B="toString",C="html",ga="toJSON",D="queue",ha="setTimeout",E="split",ia="inArray",F="location",ja="localStorage",ka="removeItem",G="options",H="displayName",la="isArray",ma="postMessage",I="push",na="show",J="Request",K="stringify",oa="load",L="indexOf",M="param",pa="name",qa="parse",N="length",O="language",
P="prototype",Q="labels",ra="clientWidth",R="document",T="body",sa="removeChild",U="call",ta="clientHeight",V="toLowerCase",W="",ua=" <span>",va=" from ",wa=" rtl",xa='", must be under domain "',ya='".',za='"]',Aa="\"]', not exist.",Ba="\"]'.",Ca="#",Da="#ac-language",Ea="#ac-market",Fa="#copyright",Ga="#learnmore",Ha="#manage_marketing_box > h1",Ia="#manage_marketing_box > p",Ja="#sample-accountchooser",Ka="#select_marketing_box",La="#select_marketing_box > h1",Ma="#store_marketing_box",Na="#store_marketing_box > h1",
Oa="#store_marketing_box > p",Pa="#update_marketing_box",Qa="#update_marketing_box > h1",Ra="#update_marketing_box > p",Sa="&",Ta="&lang=",Ua="'",Va="' found!",Wa="' has't initialized yet.",Xa="', uuid='",Ya="'.",Za="': no valid iframeUrl.",$a="(^|;) ?",ab="*",bb="-9999px",cb=".",db="//",eb="/learnmore.html",fb="1px",gb="2.0",hb=":",ib="; expires=",jb="; path=/",kb="</span>",lb="<iframe />",mb="=",nb="=([^;]*)(;|$)",ob="=; expires=",X="?",pb="?lang=",qb="@",sb="Caja process stoped due to timeout.",
tb="CallClient failed: cannot find client window.",ub="Clear CDS browser config.",vb="Error request format: ",wb="Failed to clear from DOM storage: ",xb="Failed to clear from cookie: ",yb="Failed to find callback for response: ",zb="Failed to find widget with uuid '",Ab="Failed to get client domain in URL hash.",Bb="Failed to init IDP iframe for '",Cb="Failed to parse request: ",Db="Failed to read from DOM storage: ",Eb="Failed to read from cookie: ",Fb="Failed to write to DOM storage: ",Gb="Failed to write to cookie: ",
Hb="GET",Ib="Get CDS browser config: ",Jb="Guest code rendered successfully.",Kb="Ignore expired JSON-RPC object: [",Lb="Ignore invalid JSON-RPC object: [",Mb='Illegal clientCallbackUrl "',Nb='Illegal negativeCallbackUrl "',Ob='Illegal positiveCallbackUrl "',Pb="Illegal request: ",Qb="Illegal state error: IDP domain '",Rb="Invalid JSON-RPC object: not a JSON object.",Sb="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Tb="Invalid value for 'options.emailMapIdp.[\"",Ub="Invalid value for 'options.emailMapIdp[\"",
Vb="MSIE",Wb="No RPC handler for '",Xb="No content returned in the HTML file.",Yb="Parameter %%param%% cannot be an empty array.",Zb="Parameter %%param%% cannot be empty.",$b="Parameter %%param%% cannot be null.",ac="Parameter %%param%% is not a function.",bc="Parameter %%param%% is not an array.",cc="Read saved accounts from storage: ",dc="Received message: ",ec="Register handler for postMessage failed.",fc="Save accounts to storage: ",gc="Send message: ",hc="Set CDS browser config: ",ic="Successfully parsing request: ",
jc="Timeout when initializing Caja.",kc="Timeout when loading caja.js.",lc="Timeout when loading raw HTML.",mc="Unimplementated! Child object must provide an impelementation.",nc="Unimplementated! Child object must provide an implementation.",oc="Unrecognized request: ",pc="Unsupported IDP '",qc="Unsupported IDP domain '",rc='[id^="',sc="[object Array]",tc="[object Function]",uc="]",vc="_",wc="about",xc="absolute",yc="ac-market",zc="account",Ac="accounts",Bc="ar",Cc="body",Dc="cajole",Ec="callback",
Fc="change",Gc="chooserAccounts",Hc="class",Ic="complete",Jc="cookieName",Kc="disabled",Lc="domStorageKey",Mc="domain",Nc="en",Oc="form",Pc="handler",Qc="head",Rc="height",Sc="hidden",Tc="href",Uc="html",Vc="http://",Wc="https://ssl.gstatic.com/caja/",Y="id",Xc="idpConfig",Yc="iframeUrl",Zc="image/x-icon",$c="img",ad="input",bd="iw",cd="jsUrl",dd="lang=",ed="left",fd="link",gd="loaded",hd="localStorage",id="ltr",jd="manage",kd="message",ld="msg_",md="name",nd="object",od="ol.benefit-list > li > p",
pd="onmessage",qd="opt_cookieName",rd="opt_domStorageKey || opt_cookieName",sd="parentClass",td="position",ud="post",vd="query",wd="rel",xd="request",yd="requestId",zd="rpcObject",Ad="rtl",Bd="sanitize",Cd="script",Dd="semaphore value decrease to ",Ed="serviceMeta",Fd="serviceMeta.name",Gd="serviceName",Hd="sessionStorage",Id="shortcut icon",Jd="src",Kd="string",Ld="stylesheet",Md="targetWindow",Nd="text/css",Od="text/html",Pd="text/javascript",Qd="timeout",Rd="timeoutCallback",Sd="type",Td="value",
Ud="width",Vd="window",Wd="window.notifyWidget: type='",Z;n.accountchooser=n.accountchooser||{};n.cds=n.accountchooser;n.accountchooser.util=n.accountchooser.util||{};n.accountchooser.util.log=function(a){try{n.console&&n.console.log&&n.console.log(a)}catch(c){}};n.accountchooser.util.uuidCounter_=(new Date)[z]();n.accountchooser.util.generateUuid=function(a){return a&&a.uuid?a.uuid:++n.accountchooser.util.uuidCounter_};
n.accountchooser.util.createForm_=function(a,c,d){a||b("The targetUrl cannot be null.");var e=n[R][x](Oc);e.method=ud;e.action=a;if(c)for(var f in c)a=n[R][x](ad),a[y](Sd,Sc),a[y](md,f),c[f]===k||c[f]===g?a[y](Td,W):a[y](Td,c[f]),e.appendChild(a);d&&(e.target=d);n[R][T].appendChild(e);return e};n.accountchooser.util.postTo=function(a,c,d){a=n.accountchooser.util.createForm_(a,c,d);a.submit();n[R][T][sa](a)};
n.accountchooser.util.parseUrlParams=function(a){var c={};a=a.slice(a[L](X)+1)[E](Sa);for(var d=0;d<a[N];d++){var e=a[d][E](mb);c[e[0]]=2==e[N]?decodeURIComponent(e[1]):g}return c};n.accountchooser.util.formRedirect=function(a,c){var d=a.substring(0,a[L](X)),e=n.accountchooser.util.parseUrlParams(a);n.accountchooser.util.postTo(d,e,c)};n.accountchooser.util.isBrowserSupported=function(){var a=999;-1!=aa.appVersion[L](Vb)&&(a=parseFloat(aa.appVersion[E](Vb)[1]));return 7<a};
n.accountchooser.util.makeUrl=function(a,c){var d=[],e;for(e in c)d[I](c[e]?e+mb+c[e]:e);return a+X+d.join(Sa)};n.accountchooser.util.isArray=function(a){return"undefined"!==typeof r?r[la](a):Object[P][B][U](a)===sc};n.accountchooser.util.isFunction=function(a){return"undefined"!==typeof r?r.isFunction(a):Object[P][B][U](a)===tc};n.accountchooser.util.indexOf=function(a,c){if(c){if("undefined"!==typeof r)return r[ia](a,c);if(c[L])return c[L](a);for(var d=c[N],e=0;e<d;e++)if(e in c&&c[e]===a)return e}return-1};
n.accountchooser.util.windowWidth=function(a){if("undefined"!==typeof r)return r(a).width();var c=0;a.innerWidth?c=a.innerWidth:a[R]&&a[R][A]&&a[R][A][ra]?c=a[R][A][ra]:a[R]&&(a[R][T]&&a[R][T][ra])&&(c=a[R][T][ra]);return c};n.accountchooser.util.windowHeight=function(a){if("undefined"!==typeof r)return r(a).height();var c=0;a.innerHeight?c=a.innerHeight:a[R]&&a[R][A]&&a[R][A][ta]?c=a[R][A][ta]:a[R]&&(a[R][T]&&a[R][T][ta])&&(c=a[R][T][ta]);return c};
n.accountchooser.util.trim=function(a){return"undefined"!==typeof r?r[w](a):a==k?W:String[P][w]?String[P][w][U](a):a[t](/^[\s\xa0]+/,W)[t](/[\s\xa0]+$/,W)};
n.accountchooser.util.extend=function(a,c,d){if(3>arguments[N])return c||{};if("undefined"!==typeof r){var e=Array[P].slice[U](arguments,a?0:1);return r[da].apply(r,e)}if(typeof c!==nd||c==k)c={};for(var e=2,f=arguments[N];e<f;e++){var h=arguments[e];if(h!=k)for(var m in h)h[m]===g||c===h[m]||(a&&typeof h[m]==nd?(n.accountchooser.util[la](h[m])&&!n.accountchooser.util[la](c[m])&&(c[m]=[]),c[m]=n.accountchooser.util[da](j,c[m],h[m])):c[m]=h[m])}return c};n.accountchooser.param={};
n.accountchooser[M].notNull=function(a,c){(a===g||a===k)&&n.accountchooser[M].throwError_($b,c)};n.accountchooser[M].notEmpty=function(a,c){a||n.accountchooser[M].throwError_(Zb,c)};n.accountchooser[M].notEmptyArray=function(a,c){a||n.accountchooser[M].throwError_(Zb,c);n.accountchooser.util[la](a)||n.accountchooser[M].throwError_(bc,c);a[N]||n.accountchooser[M].throwError_(Yb,c)};
n.accountchooser[M].notEmptyFunction=function(a,c){a||n.accountchooser[M].throwError_(Zb,c);n.accountchooser.util.isFunction(a)||n.accountchooser[M].throwError_(ac,c)};n.accountchooser[M].throwError_=function(a,c){try{console&&console.trace&&console.trace()}catch(d){}b(a[t](/\%\%param\%\%/g,c?" '"+c+Ua:W))};Function[P].inheritsFrom=function(a){n.accountchooser[M].notEmptyFunction(a,sd);this.prototype=new a;this[P].constructor=this;this[P].parentClass=a[P]};
n.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;n.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;n.accountchooser.util.isValidEmail=function(a){return a&&k!=n.accountchooser.util.VALID_EMAIL_REGEX_[s](a)};n.accountchooser.util.isValidDomain=function(a){return a&&k!=n.accountchooser.util.VALID_DOMAIN_REGEX_[s](a)};
n.accountchooser.util.getEmailDomain=function(a){if((a=n.accountchooser.util[w](a))&&n.accountchooser.util.isValidEmail(a))return a[E](qb)[1][V]()};n.accountchooser.util.getEmailUsername=function(a){if((a=n.accountchooser.util[w](a))&&n.accountchooser.util.isValidEmail(a))return a[E](qb)[0][V]()};n.accountchooser.util.isDomainInNascar=function(a){if(a){var c=n.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==a)return d}}};n.accountchooser.util.USERNAME_REGEX=/^\w+(\.\w+)*$/;
n.accountchooser.util.isValidUsername=function(a){return n.accountchooser.config?n.accountchooser.config.disableUsernameFormatCheck?!!a:n.accountchooser.config.usernameRegex?!!a&&k!=n.accountchooser.config.usernameRegex[s](a):!!a&&k!=n.accountchooser.util.USERNAME_REGEX[s](a):!!a&&k!=n.accountchooser.util.USERNAME_REGEX[s](a)};n.accountchooser.util.DOMAIN_REGEX_=/:\/\/(.[^\/?]+)/;n.accountchooser.util.VALID_URL_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+(\:\d+)?$/i;
n.accountchooser.util.getDomainFromUrl=function(a){try{return a.match(n.accountchooser.util.DOMAIN_REGEX_)[1]}catch(c){}};n.accountchooser.util.isValidUrlDomain=function(a){return a?n.accountchooser.util.VALID_URL_DOMAIN_REGEX_.test(a):l};n.accountchooser.util.MOBILE_REGEX_=/iphone|ipad|ipod|android|blackberry|mini|iemobile|windows\sce|palm/i;n.accountchooser.util.isMobileAgent=function(a){return a&&n.accountchooser.util.MOBILE_REGEX_.test(a[V]())};
n.accountchooser.util.SUPPORTED_LANGUAGE_=[Nc,"en_gb","fr","it","de","es","zh_cn","zh_tw","ja","ko","nl","pl","pt","ru","th","tr","bg","ca","hr","cs","da","fil","fi","el","hi","hu",Y,"lv","lt","no","pt_pt","ro","sr","sk","sl","sv","uk","vi",Bc,bd];
n.accountchooser.util.ALTERNATIVE_CODES_MAP_={en_us:Nc,zh:"zh_cn",zh_hans:"zh_cn",zh_hans_cn:"zh_cn",zh_hant:"zh_tw",zh_hant_tw:"zh_tw",nl_nl:"nl",fr_fr:"fr",de_de:"de",it_it:"it",ja_jp:"ja",ko_kr:"ko",pl_pl:"pl",pt_br:"pt",ru_ru:"ru",es_es:"es",th_th:"th",tr_tr:"tr",bg_bg:"bg",ca_es:"ca",hr_hr:"hr",cs_cz:"cs",da_dk:"da",fil_ph:"fil",tl:"fil",fi_fi:"fi",el_gr:"el",hi_in:"hi",hu_hu:"hu",id_id:Y,lv_lv:"lv",lt_lt:"lt",no_no:"no",nb:"no",nb_no:"no",ro_ro:"ro",sr_cyrl_rs:"sr",sk_sk:"sk",sl_si:"sl",sv_se:"sv",
uk_ua:"uk",vi_vn:"vi"};n.accountchooser.util.findLanguageCode=function(a){a=a&&a[t](/-/g,vc)[V]();for(var c;a;){if(-1<r[ia](a,n.accountchooser.util.SUPPORTED_LANGUAGE_)){c=a;break}else if(n.accountchooser.util.ALTERNATIVE_CODES_MAP_[a]){c=n.accountchooser.util.ALTERNATIVE_CODES_MAP_[a];break}a=a[E](vc);a.pop();a=a.join(vc)}return c};n.accountchooser.util.isRightToLeft=function(a){a=n.accountchooser.util.findLanguageCode(a);return a==Bc||a==bd};
n.accountchooser.util.getNamespacedObjectByString=function(a){for(var c=a[E](cb),d=0,e=c[N],f=n;d<e;++d)f=0==d&&c[0]==Vd?n:f[c[d]],n.accountchooser[M].notNull(f,a);return f};n.accountchooser.util.REGISTRY_KEY_PREFIX_="widget_";n.accountchooser.util.widgets_={};n.accountchooser.util.registerWidget=function(a,c){n.accountchooser.util.widgets_[n.accountchooser.util.REGISTRY_KEY_PREFIX_+a]=c};
n.accountchooser.util.unregisterWidget=function(a){delete n.accountchooser.util.widgets_[n.accountchooser.util.REGISTRY_KEY_PREFIX_+a]};n.accountchooser.util.getWidget_=function(a){var c;if(a){var d=n.accountchooser.util.REGISTRY_KEY_PREFIX_+a;c=n.accountchooser.util.widgets_[d]}else for(d in n.accountchooser.util.widgets_){c=n.accountchooser.util.widgets_[d];break}return c};
n.accountchooser.util.notifyWidget=function(a,c,d){n.accountchooser.util.log(Wd+a+Xa+d+Ua);var e=n.accountchooser.util.getWidget_(d);if(e){var f=r[da]({},c);n[ha](function(){e.handleNotification(a,f)},200)}else n.accountchooser.util.log(zb+d+Ya)};n.accountchooser.util.Storage=function(a,c,d){n.accountchooser[M].notEmpty(a||c,rd);n.accountchooser.util.Storage.isDomStorageSupported(d)||n.accountchooser[M].notEmpty(c,qd);this.domStorageKey_=a;this.cookieName_=c;this.perSession_=d};
n.accountchooser.util.Storage.isDomStorageSupported=function(a){try{return a?Hd in n&&n[v]!=k:hd in n&&n[ja]!=k}catch(c){return l}};Z=n.accountchooser.util.Storage[P];Z.read=function(){if(n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};
Z.write=function(a){n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(a):this.isCookieStorageAllowed_()&&this.writeToCookie_(a)};Z.clear=function(){n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var a=this.perSession_?n[v]:n[ja];try{var c=a.getItem(this.domStorageKey_);if(c)return q[qa](c)}catch(d){n.accountchooser.util.log(Db+d)}};Z.writeToDomStorage_=function(a){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var c=this.perSession_?n[v]:n[ja];try{var d=q[K](a);c.setItem(this.domStorageKey_,d)}catch(e){n.accountchooser.util.log(Fb+e)}};
Z.clearFromDomStorage_=function(){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var a=this.perSession_?n[v]:n[ja];try{a[ka](this.domStorageKey_)}catch(c){n.accountchooser.util.log(wb+c)}};Z.readFromCookie_=function(){n.accountchooser[M].notEmpty(this.cookieName_,Jc);var a=p.cookie.match($a+this.cookieName_+nb);if(a&&(a=n.accountchooser.util[w](a[2])))try{return q[qa](unescape(a))}catch(c){n.accountchooser.util.log(Eb+c)}};
Z.writeToCookie_=function(a){n.accountchooser[M].notEmpty(this.cookieName_,Jc);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),h=new Date(d,e,f),m=this.perSession_?0:h.toGMTString();p.cookie=this.cookieName_+mb+escape(q[K](a))+ib+m+jb}catch(S){n.accountchooser.util.log(Gb+S)}};
Z.clearFromCookie_=function(){n.accountchooser[M].notEmpty(this.cookieName_,Jc);try{var a=new Date;a.setTime(a[z]()-1);p.cookie=this.cookieName_+ob+a.toGMTString()+jb}catch(c){n.accountchooser.util.log(xb+c)}};n.accountchooser.util.accountstorage={};n.accountchooser.util.accountstorage.ACCOUNTS_=Gc;n.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";n.accountchooser.util.accountstorage.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.accountstorage.ACCOUNTS_,n.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
n.accountchooser.util.accountstorage.read_=function(){var a=n.accountchooser.util.accountstorage.storage_.read();n.accountchooser.util.log(cc+q[K](a));return a};n.accountchooser.util.accountstorage.write_=function(a){n.accountchooser.util.log(fc+q[K](a));n.accountchooser.util.accountstorage.storage_.write(a)};n.accountchooser.util.accountstorage.readAccounts=function(){var a=n.accountchooser.util.accountstorage.read_();if(!a||!n.accountchooser.util[la](a))a=[];return a};
n.accountchooser.util.accountstorage.addAccount=function(a){if(!a||!a.email)return l;for(var c=l,d=n.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[N];f++)if(n.accountchooser.util.accountstorage.matchAccount_(d[f],a.email,a.providerId)){e=d[f];d.splice(f,1);c=j;break}e&&(!a[H]&&e[H]&&(a.displayName=e[H]),!a.photoUrl&&e.photoUrl&&(a.photoUrl=e.photoUrl));d.unshift(a);n.accountchooser.util.accountstorage.write_(d);return!c};
n.accountchooser.util.accountstorage.removeAccount=function(a){if(!a||!a.email)return l;for(var c=l,d=n.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(n.accountchooser.util.accountstorage.matchAccount_(d[e],a.email,a.providerId)){d.splice(e,1);c=j;break}n.accountchooser.util.accountstorage.write_(d);return c};n.accountchooser.util.accountstorage.clearAccounts=function(){n.accountchooser.util.accountstorage.storage_.clear()};
n.accountchooser.util.accountstorage.updateAccount=function(a,c,d){if(a)for(var e=n.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[N];f++)if(n.accountchooser.util.accountstorage.matchAccount_(e[f],a,d)){c(e[f]);n.accountchooser.util.accountstorage.write_(e);break}};
n.accountchooser.util.accountstorage.refreshAccount=function(a){a&&a.email&&n.accountchooser.util.accountstorage.updateAccount(a.email,function(c){a[H]&&(c.displayName=a[H]);a.photoUrl&&(c.photoUrl=a.photoUrl);a.legacy!=g&&(c.legacy=a.legacy)},a.providerId)};
n.accountchooser.util.accountstorage.fetchAccount=function(a,c){if(a)for(var d=n.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(n.accountchooser.util.accountstorage.matchAccount_(d[e],a,c)){var f=d[e];d.splice(e,1);d.unshift(f);n.accountchooser.util.accountstorage.write_(d);return f}};n.accountchooser.util.accountstorage.matchAccount_=function(a,c,d){return a.email!=c?l:a.providerId&&d&&a.providerId==d||!a.providerId&&!d?j:l};
n.accountchooser.util.accountstorage.matchAccount=function(a,c){return n.accountchooser.util.accountstorage.matchAccount_(a,c.email,c.providerId)};n.accountchooser.util.accountstorage.checkCompatible=function(a,c){if(!n.accountchooser.util.accountstorage.matchAccount(a,c))return l;var d=a[H]||c[H],e=a.photoUrl||c.photoUrl;return(!a[H]||a[H]==d)&&(!a.photoUrl||a.photoUrl==e)&&(!c[H]||c[H]==d)&&(!c.photoUrl||c.photoUrl==e)};n.accountchooser.updateSavedAccount=function(a){n.accountchooser.util.accountstorage.addAccount(a)};
n.accountchooser.removeSavedAccount=function(a){return n.accountchooser.util.accountstorage.removeAccount(a)};n.accountchooser.clearSavedAccounts=function(){n.accountchooser.util.accountstorage.clearAccounts()};n.accountchooser.util.accountstorage.ACCOUNTS_=Gc;n.accountchooser.util.accountstorage.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.accountstorage.ACCOUNTS_);n.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
n.accountchooser.util.accountstorage.readAccounts=function(a){var c=n.accountchooser.util.accountstorage.read_();if(!c||!n.accountchooser.util[la](c))c=[];if(!a)return c;var d=[];if(a.withEmail){var e=function(a){return n.accountchooser.util.isValidEmail(a.email)};d[I](e)}a.idpList&&0!=a.idpList[N]&&(e=function(c){return 0<=n.accountchooser.util[L](c.providerId||n.accountchooser.util.accountstorage.NO_IDP_,a.idpList)},d[I](e));a.emailDomainList&&0!=a.emailDomainList[N]&&(e=function(c){return(c=n.accountchooser.util.getEmailDomain(c.email))?
0<=n.accountchooser.util[L](c,a.emailDomainList):j},d[I](e));for(e=0;e<d[N];e++)c=n.accountchooser.util.accountstorage.filter_(c,d[e]);return c};n.accountchooser.util.accountstorage.filter_=function(a,c){for(var d=[],e=0;e<a[N];e++)c(a[e])&&d[I](a[e]);return d};n.accountchooser.util.browserconfig={};n.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";n.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
n.accountchooser.util.browserconfig.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.browserconfig.SETTINGS_KEY_,n.accountchooser.util.browserconfig.COOKIE_NAME_);n.accountchooser.util.browserconfig.getAll=function(){var a=n.accountchooser.util.browserconfig.storage_.read()||{};n.accountchooser.util.log(Ib+q[K](a));return a};n.accountchooser.util.browserconfig.setAll=function(a){n.accountchooser.util.log(hc+q[K](a));n.accountchooser.util.browserconfig.storage_.write(a)};
n.accountchooser.util.browserconfig.clearAll=function(){n.accountchooser.util.log(ub);n.accountchooser.util.browserconfig.storage_.clear()};n.accountchooser.util.browserconfig.get=function(a){return n.accountchooser.util.browserconfig.getAll()[a]};n.accountchooser.util.browserconfig.set=function(a,c){var d=n.accountchooser.util.browserconfig.getAll();d[a]=c;n.accountchooser.util.browserconfig.setAll(d)};
n.accountchooser.util.browserconfig.clear=function(a){var c=n.accountchooser.util.browserconfig.getAll();delete c[a];n.accountchooser.util.browserconfig.setAll(c)};n.accountchooser.util.browserconfig.isDisabled=function(){return!!n.accountchooser.util.browserconfig.get(Kc)};n.accountchooser.util.browserconfig.setDisabled=function(a){n.accountchooser.util.browserconfig.set(Kc,!!a)};n.accountchooser.loader=n.accountchooser.loader||{};n.accountchooser.loader.Loader=function(){};
n.accountchooser.loader.Loader[P].load=function(a,c,d,e){var f=this;this.load_(a,d,function(){c?f.load_(c,d,e):e&&e()})};
n.accountchooser.loader.Loader[P].load_=function(a,c,d){var e=p[fa](Qc)[0]||p[A],f=this.createResourceElement(a);this.finished_=l;var h=this;f.onload=f.onreadystatechange=function(){if(!h.finished_&&(!this.readyState||this.readyState===gd||this.readyState===Ic))h.finished_=j,f.onload=f.onreadystatechange=k,c&&c()};f.onerror=function(){h.finished_=j;e[sa](f);d&&d()};e.insertBefore(f,e.firstChild)};n.accountchooser.loader.Loader[P].createResourceElement=function(){b("Unimplemented! Child object must provide an implementation.")};
n.accountchooser.loader.JsLoader=function(){};n.accountchooser.loader.JsLoader.inheritsFrom(n.accountchooser.loader.Loader);n.accountchooser.loader.JsLoader[P].createResourceElement=function(a){var c=p[x](Cd);c[y](Sd,Pd);c[y](Jd,a);return c};n.accountchooser.loader.CssLoader=function(){};n.accountchooser.loader.CssLoader.inheritsFrom(n.accountchooser.loader.Loader);
n.accountchooser.loader.CssLoader[P].createResourceElement=function(a){var c=p[x](fd);c[y](Sd,Nd);c[y](wd,Ld);c[y](Tc,a);var d=p[x]($c);d[y](Jd,a);var e=this;d.onerror=function(){if(!e.finished_)c.onload()};return c};n.accountchooser.util.Semaphore=function(a,c){n.accountchooser[M].notEmptyFunction(a,Pc);0>c&&b("Semaphore value cannot be negative.");this.handler_=a;this.value_=c||0;this.started_=l};Z=n.accountchooser.util.Semaphore[P];Z.getValue=function(){return this.value_};
Z.increase=function(){this.started_&&b("Cannot increase Semaphore value after calling start().");this.value_++};Z.start=function(){0>=this.value_&&b("Semaphore value must bigger than 0.");this.started_=j};Z.isStarted=function(){return this.started_};Z.decrease=function(){this.started_||b("Cannot decrease Semaphore value before calling start().");0<this.value_&&(this.value_--,n.accountchooser.util.log(Dd+this.value_),0==this.value_&&this.handler_())};
n.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};n.accountchooser.util.sanitizeAccount=function(a,c,d){var e={},f=n.accountchooser.util.AccountPropertyKey,h;for(h in a){var m=a[h];switch(h){case f.EMAIL:case f.DISPLAY_NAME:case f.PHOTO_URL:case f.PROVIDER_ID:(m=c?c(h,m):m)&&(e[h]=m);break;default:d||b('Unrecognized key "'+h+'" for account')}}e[f.EMAIL]||b("No valid email field for the account");return e};
n.accountchooser.util.sanitizeAccounts=function(a,c,d){for(var e=[],f=0,h=a[N];f<h;f++){var m=n.accountchooser.util.sanitizeAccount(a[f],c,d);e[I](m)}return e};n.accountchooser.util.accountSanitizer=function(a,c){if(a==n.accountchooser.util.AccountPropertyKey.PHOTO_URL){if(/^https?:\/\//i.test(c))return c}else return html.sanitizeWithPolicy(c,function(){})};n.accountchooser.caja=n.accountchooser.caja||{};
n.accountchooser.caja.loadHtml=function(a,c,d,e){r.ajax({type:Hb,url:a,dataType:Uc,success:d,timeout:c,error:function(a,c,d){e&&e(c,d)}})};n.accountchooser.caja.loadJs_=function(a,c,d){(new n.accountchooser.loader.JsLoader)[oa](a,g,c,d)};n.accountchooser.caja.loadedUrls_={};n.accountchooser.caja.loadedCallback_=function(a){if(a&&(a=n.accountchooser.caja.loadedUrls_[a])){a.loaded=j;for(var c=0;c<a.callbacks[N];c++){var d=a.callbacks[c];d&&d()}a.callbacks=[];a.error=l;a.errorCallbacks=[]}};
n.accountchooser.caja.errorCallback_=function(a,c,d){if(a&&(a=n.accountchooser.caja.loadedUrls_[a])){a.loaded=j;a.error=j;for(var e=0;e<a.errorCallbacks[N];e++){var f=a.errorCallbacks[e];f&&f(c,d)}a.errorCallbacks=[];a.callbacks=[]}};
n.accountchooser.caja.loadJs=function(a,c,d){n.accountchooser[M].notEmpty(a,cd);var e=n.accountchooser.caja.loadedUrls_[a];e?e.loaded?e.error?d&&d():c():(e.callbacks[I](c),d&&e.errorCallbacks[I](d)):(n.accountchooser.caja.loadedUrls_[a]={loaded:l,callbacks:[c]},n.accountchooser.caja.loadJs_(a,function(){n.accountchooser.caja.loadedCallback_(a)},function(){n.accountchooser.caja.errorCallback_(a)}))};n.accountchooser.caja=n.accountchooser.caja||{};n.accountchooser.caja.cajaUrl="https://ssl.gstatic.com/caja/4891/caja.js";
n.accountchooser.caja.htmlSanitizerUrl="https://ssl.gstatic.com/caja/4891/html-css-sanitizer-minified.js";n.accountchooser.caja.CAJA_TIMEOUT=5E3;n.accountchooser.caja.WHITELIST_IDS=["AC_LANGUAGE_LIST"];n.accountchooser.caja=n.accountchooser.caja||{};
n.accountchooser.caja.sanitizeHtml=function(a,c,d){function e(a){0>m-(new Date)[z]()?d&&d(Qd):(a=html_sanitize(a,h,f),c(a))}function f(a){if(0<=r[ia](a,n.accountchooser.caja.WHITELIST_IDS))return a}function h(a){return a}var m=(new Date)[z]()+n.accountchooser.caja.CAJA_TIMEOUT;n.accountchooser.caja.loadJs(n.accountchooser.caja.htmlSanitizerUrl,function(){var c=m-(new Date)[z]();50>c?d&&d(Qd):n.accountchooser.caja.loadHtml(a,c,e,d)})};
n.accountchooser.caja.cajoleHtml=function(a,c,d,e){function f(){if(S)n.accountchooser.util.log(kc);else{var a=Yd-(new Date)[z]();50>a?n.accountchooser.util.log(kc):n.accountchooser.caja.loadHtml(c,a,function(a){n[ha](function(){S?n.accountchooser.util.log(lc):a?(n.accountchooser.caja.cajaInitialized||(n.accountchooser.caja.cajaInitialized=j,caja.initialize({cajaServer:Wc,forceES5Mode:j})),n[ha](function(){S?n.accountchooser.util.log(jc):caja[oa](m,h,function(c){c.code(g,Od,a).run(function(){S||n.clearTimeout(Zd);
rb=j;d&&d();n.accountchooser.util.log(Jb)})})},10)):n.accountchooser.util.log(Xb)},10)})}}var h={rewrite:function(a){return a}},m=p.getElementById(a),S=l,rb=l,Zd=n[ha](function(){n.accountchooser.util.log(sb);S=j;!rb&&e&&e()},n.accountchooser.caja.CAJA_TIMEOUT),Yd=(new Date)[z]()+n.accountchooser.caja.CAJA_TIMEOUT;n.accountchooser.caja.loadJs(n.accountchooser.caja.cajaUrl,function(){n[ha](f,10)})};n.accountchooser.rpc=n.accountchooser.rpc||{};n.accountchooser.rpc.RpcObject=function(){};
n.accountchooser.rpc.RpcObject[P].setTimestamp=function(a){this.timestamp_=a||(new Date)[z]()};ba(n.accountchooser.rpc.RpcObject[P],function(){var a={jsonrpc:gb};this.timestamp_!=k&&(a.timestamp=this.timestamp_);return a});n.accountchooser.rpc.RpcObject[P].toString=function(){return q[K](this[ga]())};n.accountchooser.rpc.AbstractRequest=function(a,c){this.method_=a;this.params_=c};n.accountchooser.rpc.AbstractRequest.inheritsFrom(n.accountchooser.rpc.RpcObject);Z=n.accountchooser.rpc.AbstractRequest[P];
Z.setMethod=function(a){this.method_=a};Z.getMethod=function(){return this.method_};Z.setParameters=function(a){this.params_=a};Z.getParameters=function(){return this.params_};ba(Z,function(){var a=n.accountchooser.rpc.RpcObject[P][ga][U](this);this.method_!=k&&(a.method=this.method_);this.params_!=k&&(a.params=this.params_);return a});n.accountchooser.rpc.Notification=function(a,c){this.method_=a;this.params_=c};n.accountchooser.rpc.Notification.inheritsFrom(n.accountchooser.rpc.AbstractRequest);
n.accountchooser.rpc.Request=function(a,c,d){this.method_=a;this.params_=c;this.id_=d};n.accountchooser.rpc[J].inheritsFrom(n.accountchooser.rpc.AbstractRequest);n.accountchooser.rpc[J][P].setId=function(a){this.id_=a};n.accountchooser.rpc[J][P].getId=function(){return this.id_};ba(n.accountchooser.rpc[J][P],function(){var a=n.accountchooser.rpc.AbstractRequest[P][ga][U](this);this.id_!=k&&(a.id=this.id_);return a});
n.accountchooser.rpc.Response=function(a,c,d){n.accountchooser[M].notEmpty(a,Y);this.id_=a;this.result_=c;this.error_=d};n.accountchooser.rpc.Response.inheritsFrom(n.accountchooser.rpc.RpcObject);Z=n.accountchooser.rpc.Response[P];Z.getResult=function(){return this.result_};Z.setResult=function(a){this.result_=a};Z.getError=function(){return this.error_};Z.setError=function(a){this.error_=a};Z.setId=function(a){this.id_=a};Z.getId=function(){return this.id_};
ba(Z,function(){var a=n.accountchooser.rpc.RpcObject[P][ga][U](this);a.id=this.id_;this.result_!=k?a.result=this.result_:this.error_!=k&&(a.error=this.error_);return a});n.accountchooser.rpc.RequestAckNotification=function(a){n.accountchooser[M].notEmpty(a,yd);this.method_=n.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:a}};n.accountchooser.rpc.RequestAckNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
n.accountchooser.rpc.RequestAckNotification[P].setRequestId=function(a){this.params_.requestId=a};n.accountchooser.rpc.RequestAckNotification[P].getRequestId=function(){return this.params_.requestId};n.accountchooser.rpc.CdsReadyNotification=function(){this.method_=n.accountchooser.rpc.CdsReadyNotification.METHOD};n.accountchooser.rpc.CdsReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
n.accountchooser.rpc.ClientReadyNotification=function(){this.method_=n.accountchooser.rpc.ClientReadyNotification.METHOD};n.accountchooser.rpc.ClientReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";n.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=n.accountchooser.rpc.EmptyResponseNotification.METHOD};n.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(n.accountchooser.rpc.Notification);
n.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";n.accountchooser.rpc.StoreRequest=function(a,c,d){n.accountchooser[M].notEmpty(a,Y);n.accountchooser[M].notEmptyArray(c,Ac);c&&(c=n.accountchooser.util.sanitizeAccounts(c));this.method_=n.accountchooser.rpc.StoreRequest.METHOD;this.params_={accounts:c,clientConfig:d};this.id_=a};n.accountchooser.rpc.StoreRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.StoreRequest.METHOD="store";
n.accountchooser.rpc.SelectRequest=function(a,c,d){n.accountchooser[M].notEmpty(a,Y);c&&(c=n.accountchooser.util.sanitizeAccounts(c));this.method_=n.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=a};n.accountchooser.rpc.SelectRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.SelectRequest.METHOD="select";
n.accountchooser.rpc.UpdateRequest=function(a,c,d){n.accountchooser[M].notEmpty(a,Y);n.accountchooser[M].notEmpty(c,zc);c&&(c=n.accountchooser.util.sanitizeAccount(c));this.method_=n.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=a};n.accountchooser.rpc.UpdateRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.UpdateRequest.METHOD="update";
n.accountchooser.rpc.ManageRequest=function(a,c){n.accountchooser[M].notEmpty(a,Y);this.method_=n.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=a};n.accountchooser.rpc.ManageRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.ManageRequest.METHOD=jd;n.accountchooser.rpc.AboutRequest=function(a,c){n.accountchooser[M].notEmpty(a,Y);this.method_=n.accountchooser.rpc.AboutRequest.METHOD;this.params_={clientConfig:c};this.id_=a};n.accountchooser.rpc.AboutRequest.inheritsFrom(n.accountchooser.rpc[J]);
n.accountchooser.rpc.AboutRequest.METHOD=wc;n.accountchooser.rpc.QueryRequest=function(a,c,d,e){n.accountchooser[M].notEmpty(a,Y);n.accountchooser[M].notEmpty(c,vd);d&&(d=n.accountchooser.util.sanitizeAccount(d));this.method_=n.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=a};n.accountchooser.rpc.QueryRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.QueryRequest.METHOD=vd;
n.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist",SHOULD_UPDATE:"shouldUpdate"};n.accountchooser.rpc.IdpReadyNotification=function(){this.method_=n.accountchooser.rpc.IdpReadyNotification.METHOD};n.accountchooser.rpc.IdpReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.IdpReadyNotification.METHOD="idpReadyNotification";
n.accountchooser.rpc.IdpAuthRequest=function(a,c){n.accountchooser[M].notEmpty(a,zc);this.method_=n.accountchooser.rpc.IdpAuthRequest.METHOD;this.params_={account:a,clientConfig:c};this.id_=n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID+hb+a.email};n.accountchooser.rpc.IdpAuthRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.IdpAuthRequest.METHOD="idpAuth";n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID="idpAuth";
n.accountchooser.rpc.parseRpcObject=function(a){var c=k;if(a){try{var d=q[qa](a)}catch(e){return n.accountchooser.util.log(Rb),c}if(!d||d.jsonrpc!=gb)n.accountchooser.util.log(Sb);else if(d.method){var f=d.method[V]();f==n.accountchooser.rpc.StoreRequest.METHOD[V]()?d.id&&(d.params&&d.params.accounts)&&(c=new n.accountchooser.rpc.StoreRequest(d.id,d.params.accounts,d.params.clientConfig)):f==n.accountchooser.rpc.SelectRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.SelectRequest(d.id,d.params.localAccounts,
d.params.clientConfig)):f==n.accountchooser.rpc.UpdateRequest.METHOD[V]()?d.id&&(d.params&&d.params.account)&&(c=new n.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==n.accountchooser.rpc.ManageRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.ManageRequest(d.id,d.params.clientConfig)):f==n.accountchooser.rpc.AboutRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.AboutRequest(d.id,d.params.clientConfig)):f==n.accountchooser.rpc.IdpReadyNotification.METHOD[V]()&&
(c=new n.accountchooser.rpc.IdpReadyNotification)}else typeof d.id===Kd&&0<=d.id[L](n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID)&&(c=new n.accountchooser.rpc.Response(d.id,d.result,d.error))}c?n.accountchooser.util.log(ic+a):n.accountchooser.util.log(Cb+a);return c};n.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";n.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";n.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";
n.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";n.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;n.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;n.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";n.accountchooser.rpc.IDP_TIMEOUT=3E3;n.accountchooser.rpc.RPC_TIMEOUT=3E5;n.accountchooser.rpc.services_={};n.accountchooser.rpc.register=function(a,c){n.accountchooser[M].notEmpty(a,Gd);n.accountchooser[M].notNull(c,Pc);n.accountchooser.rpc.services_[a]=c};
n.accountchooser.rpc.call=function(a,c,d){n.accountchooser[M].notEmpty(a,Md);c=c[B]();n.accountchooser.util.log(gc+c);a[ma](c,d||ab)};n.accountchooser.rpc.init_=function(a){n.addEventListener?n.addEventListener(kd,a,l):n[ea]?n[ea](pd,a):n[R][ea]?n[R][ea](pd,a):n.accountchooser.util.log(ec)};n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
n.accountchooser.rpc.readSavedRpcObjects=function(a,c){var d;d=c?n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=a[t](/^https?:\/\//,W);var e=[],f=n[v].getItem(d);if(f){n[v][ka](d);var h=n.JSON[qa](f)||[],f=(new Date)[z]();if(h[N]){h=h[h[N]-1];try{var m=q[qa](h);m&&m.timestamp&&f-m.timestamp<n.accountchooser.rpc.RPC_TIMEOUT?(e[I](h),c&&n[v].setItem(d,n.JSON[K](e))):n.accountchooser.util.log(Kb+h+uc)}catch(S){n.accountchooser.util.log(Lb+h+uc)}}}return e};
n.accountchooser.rpc.saveRpcObject=function(a,c,d){a=a[t](/^https?:\/\//,W);n[v][ka](n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+a);n[v][ka](n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+a);d=d?n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=a;a=[];c.setTimestamp();a[I](c[B]());c=n.JSON[K](a);n[v].setItem(d,c)};n.accountchooser.rpc.idps={};n.accountchooser.rpc.idpsIndexedByDomain={};n.accountchooser.rpc.emailMapIdp={};
n.accountchooser.rpc.timer_={running:l,id:0,callback:k};n.accountchooser.rpc.clearTimeoutCallback_=function(){if(n.accountchooser.rpc.timer_.running){try{n.clearTimeout(n.accountchooser.rpc.timer_.id)}catch(a){}n.accountchooser.rpc.timer_.running=l;n.accountchooser.rpc.timer_.id=0;n.accountchooser.rpc.timer_.callback=k}};
n.accountchooser.rpc.setTimeoutCallback_=function(a){n.accountchooser[M].notEmptyFunction(a,Rd);n.accountchooser.rpc.clearTimeoutCallback_();n.accountchooser.rpc.timer_.callback=a;n.accountchooser.rpc.timer_.id=n[ha](function(){n.accountchooser.rpc.timer_.callback&&n.accountchooser.rpc.timer_.callback[U](n);n.accountchooser.rpc.timer_.running=l;n.accountchooser.rpc.timer_.id=0;n.accountchooser.rpc.timer_.callback=k},n.accountchooser.rpc.IDP_TIMEOUT);n.accountchooser.rpc.timer_.running=j};
n.accountchooser.rpc.initIdpIFrame_=function(a){!a||!n.accountchooser.rpc.idps[a]?n.accountchooser.util.log(pc+a+Ya):n.accountchooser.rpc.idps[a].iframeUrl?n.accountchooser.rpc.initIdpIFrameByConfig_(n.accountchooser.rpc.idps[a]):n.accountchooser.util.log(Bb+a+Za)};n.accountchooser.rpc.initIdpIFrameByConfig_=function(a){if(a&&!a.iframe){var c=r(lb).css(td,xc).css(Ud,fb).css(Rc,fb).css(ed,bb).appendTo(Cc);a.iframe=c;c.attr(Jd,a.iframeUrl)}};
n.accountchooser.rpc.onIdpReady_=function(a){if(!a||!n.accountchooser.rpc.idpsIndexedByDomain[a])n.accountchooser.util.log(qc+a+Ya);else{var c=n.accountchooser.rpc.idpsIndexedByDomain[a];if(c.iframe){a=c.iframe[0].contentWindow;if(c[D]&&c[D][N]){for(var d=0;d<c[D][N];d++)n.accountchooser.rpc[U](a,c[D][d]);c.queue=[]}c.idpReady=j}else n.accountchooser.util.log(Qb+a+Wa)}};
n.accountchooser.rpc.callIdp=function(a,c,d,e){a&&n.accountchooser.rpc.idps[a]&&n.accountchooser.rpc.callIdpByConfig(n.accountchooser.rpc.idps[a],c,d,e)};n.accountchooser.rpc.callIdpByDomain=function(a,c,d,e){a&&n.accountchooser.rpc.idpsIndexedByDomain[a]&&n.accountchooser.rpc.callIdpByConfig(n.accountchooser.rpc.idpsIndexedByDomain[a],c,d,e)};
n.accountchooser.rpc.callIdpByConfig=function(a,c,d,e){n.accountchooser[M].notEmpty(a,Xc);n.accountchooser[M].notEmpty(c,xd);n.accountchooser[M].notEmptyFunction(d,Ec);n.accountchooser[M].notEmptyFunction(e,Qd);n.accountchooser.rpc.setTimeoutCallback_(e);n.accountchooser.rpc.addIdpCallback_(a,c,d);if(a.idpReady)n.accountchooser.rpc[U](a.iframe[0].contentWindow,c);else a[D]||(a.queue=[]),a[D][I](c),a.iframe||n.accountchooser.rpc.initIdpIFrameByConfig_(a)};
n.accountchooser.rpc.callIdpByConfig.callbacks_={};n.accountchooser.rpc.addIdpCallback_=function(a,c,d){n.accountchooser.rpc.callIdpByConfig.callbacks_[a.domain+hb+c.id_]={callback:d,idpConfig:a}};n.accountchooser.rpc.getIdpCallback_=function(a,c){var d=a+hb+c.id_,e=n.accountchooser.rpc.callIdpByConfig.callbacks_[d];if(e)return delete n.accountchooser.rpc.callIdpByConfig.callbacks_[d],e.callback};
n.accountchooser.rpc.isSupportedIdp=function(a){if(a&&(a=a.providerId||n.accountchooser.util.getEmailDomain(a.email)))if((a=n.accountchooser.rpc.emailMapIdp[a])&&n.accountchooser.rpc.idps[a])return a;return l};n.accountchooser.rpc.EMPTY_SAVED_RPC="EMPTY_SAVED_RPC";n.accountchooser.rpc.INVALID_CLIENT_DOMAIN="INVALID_CLIENT_DOMAIN";n.accountchooser.rpc.popupMode=l;n.accountchooser.rpc.clientWindow=k;
n.accountchooser.rpc.getDomainInHash_=function(){if(n[F].hash){var a=n[F].hash;a&&a[0]==Ca&&(a=a.substring(1));return a}};n.accountchooser.rpc.triggerSavedRpcs_=function(){if(!n.accountchooser.rpc.popupMode){var a=n.accountchooser.rpc.readSavedRpcObjects(n.accountchooser.rpc.clientDomain_,j);if(a&&a[N])for(var c=0;c<a[N];c++)n.accountchooser.rpc.process_({data:a[c],origin:n.accountchooser.rpc.clientDomain_},j);else b(n.accountchooser.rpc.EMPTY_SAVED_RPC)}};
n.accountchooser.rpc.sendCdsReadyNotification_=function(){if(n.accountchooser.rpc.popupMode){var a=new n.accountchooser.rpc.CdsReadyNotification;n.accountchooser.rpc.clientWindow[ma](a[B](),ab)}};
n.accountchooser.rpc.process_=function(a,c){n.accountchooser.util.log(dc+a[u]+va+a[ca]);var d=a[ca][t](/^https?:\/\//,W),e=n.accountchooser.rpc.parseRpcObject(a[u]);if(e)if(e instanceof n.accountchooser.rpc.ManageRequest&&!c)n.accountchooser.util.log(Pb+a[u]);else if(e instanceof n.accountchooser.rpc.IdpReadyNotification)n.accountchooser.rpc.onIdpReady_(d);else if(e instanceof n.accountchooser.rpc.Response)n.accountchooser.rpc.clearTimeoutCallback_(),(d=n.accountchooser.rpc.getIdpCallback_(d,e))?
d[U](n,e,a[ca],d.context):n.accountchooser.util.log(yb+a[u]);else if(e instanceof n.accountchooser.rpc[J]){if(n.accountchooser.rpc.checkCallbackDomain_(e,d))if(d=n.accountchooser.rpc.services_.serviceLoader){if(e instanceof n.accountchooser.rpc[J]&&!c){var f=new n.accountchooser.rpc.RequestAckNotification(e.id_);n.parent[ma](f[B](),a[ca])}d(e,a[ca])}else n.accountchooser.util.log(Wb+e.method_+Va)}else n.accountchooser.util.log(oc+a[u]);else n.accountchooser.util.log(vb+a[u])};
n.accountchooser.rpc.checkCallbackDomain_=function(a,c){var d=a.params_.clientConfig.clientCallbackUrl&&n.accountchooser.util.getDomainFromUrl(a.params_.clientConfig.clientCallbackUrl);return d&&d!==c?(n.accountchooser.util.log(Mb+a.params_.clientConfig.clientCallbackUrl+xa+c+ya),l):(d=a.params_.clientConfig.positiveCallbackUrl&&n.accountchooser.util.getDomainFromUrl(a.params_.clientConfig.positiveCallbackUrl))&&d!==c?(n.accountchooser.util.log(Ob+a.params_.clientConfig.positiveCallbackUrl+xa+c+ya),
l):(d=a.params_.clientConfig.negativeCallbackUrl&&n.accountchooser.util.getDomainFromUrl(a.params_.clientConfig.negativeCallbackUrl))&&d!==c?(n.accountchooser.util.log(Nb+a.params_.clientConfig.negativeCallbackUrl+xa+c+ya),l):j};
n.accountchooser.rpc.initIdp_=function(a,c){var d=[];if(a)for(var e in a){n.accountchooser[M].notEmpty(a[e].iframeUrl,Yc);var f=a[e].iframeUrl,h=n.accountchooser.util.getDomainFromUrl(f);n.accountchooser[M].notEmpty(h,Mc);f={id:e,domain:h,iframe:k,iframeUrl:f,queue:[],idpReady:l};n.accountchooser.rpc.idps[e]=f;n.accountchooser.rpc.idpsIndexedByDomain[h]=f;a[e].preload&&d[I](e)}if(c)for(var m in c)(e=c[m])?n.accountchooser.rpc.idps[e]?n.accountchooser.rpc.emailMapIdp[m]=e:n.accountchooser.util.log(Tb+
m+Aa):n.accountchooser.util.log(Ub+m+Ba);return d};
n.accountchooser.rpc.initCds=function(a){var c;if(a){if(a.rpcs)for(var d in a.rpcs)n.accountchooser.rpc.register(d,a.rpcs[d]);c=n.accountchooser.rpc.initIdp_(a.idps,a.emailMapIdp)}a&&a.popupMode?(n.accountchooser.rpc.popupMode=j,n.accountchooser.rpc.clientWindow=n.opener):(n.accountchooser.rpc.popupMode=l,d=n.accountchooser.rpc.getDomainInHash_(),d||(n.accountchooser.util.log(Ab),b(n.accountchooser.rpc.INVALID_CLIENT_DOMAIN)),n.accountchooser.rpc.clientDomain_=d);n.accountchooser.rpc.init_(n.accountchooser.rpc.process_);
n.accountchooser.rpc.popupMode&&n.accountchooser.rpc.sendCdsReadyNotification_();if(c&&c[N])for(d=0;d<c[N];d++)n.accountchooser.rpc.initIdpIFrame_(c[d]);a&&!a.popupMode&&n.accountchooser.rpc.triggerSavedRpcs_()};
n.accountchooser.rpc.callClient=function(a){n.accountchooser[M].notEmpty(a,zd);n.accountchooser.util.log(gc+a[B]());n.accountchooser.rpc.popupMode?n.accountchooser.rpc.clientWindow[ma](a[B](),ab):n.accountchooser.rpc.clientDomain_?n.accountchooser.rpc.saveRpcObject(n.accountchooser.rpc.clientDomain_,a,l):n.accountchooser.util.log(tb)};n.accountchooser.UiLoader=function(){};Z=n.accountchooser.UiLoader[P];Z.findServiceByLanguage_=function(a,c,d){return!a?k:d&&a[d]&&a[d][c]?a[d][c]:a[c]};
Z.findService_=function(a,c,d,e){var f=k;c&&(a=a.method_,d&&c.mobile&&(f=this.findServiceByLanguage_(c.mobile,a,e)),f||(f=this.findServiceByLanguage_(c.web,a,e)));return f};Z.loadServiceFromWeb=function(){b(nc)};Z.isServiceLoaded=function(){return l};Z.setServiceLoaded=function(){};
Z.loadService=function(a,c,d){var e=n.accountchooser.util.isMobileAgent(aa.userAgent),f=a&&a.params_&&a.params_.clientConfig&&a.params_.clientConfig[O];a=this.findService_(a,c,e,f);n.accountchooser[M].notEmpty(a,Ed);n.accountchooser[M].notEmpty(a[pa],Fd);var h=r[da]({},a,{mobile:!!e,language:f});if(this.isServiceLoaded(h))e=n.accountchooser.util.getNamespacedObjectByString(h[pa]),n.accountchooser[M].notEmpty(e,h[pa]),d(e);else{var m=this;this.loadServiceFromWeb(h,function(){m.setServiceLoaded(h);
var a=n.accountchooser.util.getNamespacedObjectByString(h[pa]);n.accountchooser[M].notEmpty(a,h[pa]);d(a)})}};n.accountchooser.UrlUiLoader=function(){};n.accountchooser.UrlUiLoader.inheritsFrom(n.accountchooser.UiLoader);Z=n.accountchooser.UrlUiLoader[P];Z.getJsFileUrl=function(){b(nc)};Z.getCssFileUrl=function(){b(mc)};Z.isFileLoaded=function(){b(mc)};Z.removeOldCss=function(){b(mc)};Z.removeOldJs=function(){b(mc)};
Z.loadServiceFromWeb=function(a,c){function d(){var d=e.getJsFileUrl(a);e.isFileLoaded(d)?c():(new n.accountchooser.loader.JsLoader)[oa](d,k,function(){e.removeOldJs();c()})}var e=this,f=this.getCssFileUrl(a);this.isFileLoaded(f)?d():(new n.accountchooser.loader.CssLoader)[oa](f,k,function(){e.removeOldCss();d()})};
n.accountchooser.UrlTemplateUiLoader=function(a,c,d){this.jsUrlTemplate_=a;this.cssUrlTemplate_=c;this.defaultLanguage_=n.accountchooser.util.findLanguageCode(d)||Nc;this.cssUrl_=this.jsUrl_=k};n.accountchooser.UrlTemplateUiLoader.inheritsFrom(n.accountchooser.UrlUiLoader);Z=n.accountchooser.UrlTemplateUiLoader[P];Z.getJsFileUrl=function(a){var c=this.getLanguage_(a[O]);return this.jsUrlTemplate_[t](/\{baseFilename\}/,a.baseFilename)[t](/\{language\}/,c)};
Z.getCssFileUrl=function(a){return this.cssUrlTemplate_[t](/\{baseFilename\}/,a.cssBaseFilename)};Z.isFileLoaded=function(a){return!!this.findTag_(a)};Z.isServiceLoaded=function(a){return this.isFileLoaded(this.getJsFileUrl(a))&&this.isFileLoaded(this.getCssFileUrl(a))};Z.setServiceLoaded=function(a){this.jsUrl_=this.getJsFileUrl(a);this.cssUrl_=this.getCssFileUrl(a)};
Z.loadServiceFromWeb=function(a,c){var d=this;n.accountchooser.UrlUiLoader[P].loadServiceFromWeb[U](d,a,function(){c();var e=p[fa](Cc)[0]||p[T],f=e.getAttribute(Hc)||W;d.isRightToLeft_(a)?(e.dir=Ad,f+=wa):(e.dir=id,f=f[t](/rtl/g,W));e[y](Hc,f)})};Z.removeOldTag_=function(a){(a=this.findTag_(a))&&a.parentNode[sa](a)};Z.removeOldCss=function(){this.removeOldTag_(this.cssUrl_)};Z.removeOldJs=function(){this.removeOldTag_(this.jsUrl_)};
Z.findTag_=function(a){if(a)for(var c=(p[fa](Qc)[0]||p[A]).childNodes,d=0,e=c[N];d<e;d++){var f=c.item(d),h=f.nodeName[V]();if(h==Cd&&f.getAttribute(Jd)==a||h==fd&&f.getAttribute(Tc)==a)return f}};Z.getLanguage_=function(a){a=a||n.navigator[O];return a=n.accountchooser.util.findLanguageCode(a)||this.defaultLanguage_};Z.isRightToLeft_=function(a){a=this.getLanguage_(a[O]);return n.accountchooser.util.isRightToLeft(a)};n.accountchooser.AjaxUiLoader=function(){this.loadedPackages_=[]};n.accountchooser.AjaxUiLoader.inheritsFrom(n.accountchooser.UiLoader);
n.accountchooser.AjaxUiLoader[P].stringify=function(a){return a.module+hb+a.version+hb+a.packageName+hb+a[O]};n.accountchooser.AjaxUiLoader[P].loadServiceFromWeb=function(a,c){google[oa](a.module,a.version,{packages:[a.packageName],language:a[O]||n.navigator[O],callback:c})};n.accountchooser.AjaxUiLoader[P].isServiceLoaded=function(a){a=this[K](a);return-1<r[ia](a,this.loadedPackages_)};n.accountchooser.AjaxUiLoader[P].setServiceLoaded=function(a){a=this[K](a);0>r[ia](a,this.loadedPackages_)&&this.loadedPackages_[I](a)};
n.accountchooser.UiHandler=function(){};n.accountchooser.UiHandler.VALID_URL_REGEX_=/^http(s)?:\/\/(localhost|([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+)(\:\d+)?(\/([^?#]*))?(\?([^#]*))?$/i;Z=n.accountchooser.UiHandler[P];
Z.show=function(a){this.setUp_(a);this.showTitle_();this.showFavIcon_();switch(this.serviceType_){case n.accountchooser.ServiceType.MANAGE:this.showManageContent_();break;case n.accountchooser.ServiceType.SELECT:this.showSelectContent_();break;case n.accountchooser.ServiceType.STORE:this.showStoreContent_();break;case n.accountchooser.ServiceType.UPDATE:this.showUpdateContent_();break;case n.accountchooser.ServiceType.ABOUT:this.showAboutContent_()}this.showFooterContent_();this.initLanguageSelector_();
r(Cc).hide()[na]()};Z.setUp_=function(a){a=a||{};this.title_=a.title;this.favicon_=a.favicon;this.branding_=a.branding;this.cajaMethod_=a.cajaMethod;this.language_=a[O]||Nc;this.accounts_=a.accounts||[];this.domain_=a.domain;this.serviceType_=a.serviceType;this.onLanguageChanged_=a.onLanguageChanged};Z.showTitle_=function(){this.title_&&(p.title=this.title_)};
Z.showFavIcon_=function(){if(this.favicon_&&n.accountchooser.UiHandler.VALID_URL_REGEX_[s](this.favicon_)){for(var a=p[fa](Qc)[0],c=a[fa](fd),d=0;d<c[N];d++){var e=c[d];e.type==Zc&&e.rel==Id&&a[sa](e)}e=p[x](fd);e.type=Zc;e.rel=Id;e.href=this.favicon_;a.appendChild(e)}};
Z.showBrandingContent_=function(){function a(a){var c=r(Ea);a&&c[C](a);c[na]()}if(this.branding_&&n.accountchooser.UiHandler.VALID_URL_REGEX_[s](this.branding_)){var c=this.branding_,c=-1==c[L](X)?c+X:c+Sa,c=c+(dd+this.language_);this.cajaMethod_==Dc?n.accountchooser.caja.cajoleHtml(yc,c,a):n.accountchooser.caja.sanitizeHtml(c,a)}};Z.showSampleAccountChooser_=function(){var a=new n.accountchooser.page.SelectAccountPage,c=r(Ja).empty();a.render(c,g,this.accounts_,g,this.domain_)};
Z.showManageContent_=function(){r(Ha)[C](n.accountchooser[Q].manageContainer.header);r(Ia)[C](n.accountchooser[Q].manageContainer.description)};Z.showSelectContent_=function(){var a=n.accountchooser[Q].selectContainer.header+ua+this.domain_+kb;r(La)[C](a);this.showBrandingContent_();r(Ka)[na]()};
Z.showStoreContent_=function(){var a=this.accounts_&&1<this.accounts_[N],c=n.accountchooser[Q].storeContainer.header,d=n.accountchooser[Q].storeContainer.headerMultiple;r(Na)[C](a?d:c);c=n.accountchooser[Q].storeContainer.description;d=n.accountchooser[Q].storeContainer.descriptionMultiple;r(Oa)[C](a?d:c);var e=n.accountchooser[Q].storeContainer.benefits;r(od).each(function(a,c){a<e[N]&&r(c)[C](e[a])});this.showSampleAccountChooser_();r(Ma)[na]()};
Z.showUpdateContent_=function(){r(Qa)[C](n.accountchooser[Q].updateContainer.header);r(Ra)[C](n.accountchooser[Q].updateContainer.description);r(Pa)[na]()};Z.showAboutContent_=function(){this.title_=n.accountchooser[Q].aboutContainer.title;this.showTitle_();this.showAboutContainerMessages_(ld);this.accounts_=this.getAboutContainerSampleAccounts_();this.showSampleAccountChooser_()};
Z.showAboutContainerMessages_=function(a){var c=n.accountchooser[Q].aboutContainer,d=r(rc+a+za);if(d&&c)for(var e=0;e<d[N];e++){var f=r(d[e]),h=f.attr(Y)[t](a,W);c[h]&&f[C](c[h])}};n.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_=2;n.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_=2;
n.accountchooser.UiHandler[P].getAboutContainerSampleAccounts_=function(){var a=n.accountchooser.util.accountstorage.readAccounts(),c=n.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_,d=n.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_,e=n.accountchooser[Q].aboutContainer;return a[N]>c?a.slice(0,c):a[N]<d?[e.accountWomanHome,e.accountWomanWork]:a};
n.accountchooser.UiHandler[P].showFooterContent_=function(){r(Fa)[C](n.accountchooser[Q].footerContainer.copyright);var a=n.accountchooser[Q].footerContainer.learnMoreLink;this.language_&&this.language_!=Nc&&(a=0<=a[L](X)?a+(Ta+this.language_):a+(pb+this.language_));var c=n.accountchooser[Q].footerContainer.learnMore;r(Ga)[C](c).attr(Tc,a)};
n.accountchooser.UiHandler[P].initLanguageSelector_=function(){var a=r(Da);a.unbind(Fc);a.val(this.language_);var c=this;a.change(function(){var d=a.val();if(d!=c.language_&&c.onLanguageChanged_)c.onLanguageChanged_(d)})};
var Xd=r,$d={options:{popupMode:l,manageMode:l,aboutMode:l,uiLoader:k,idps:{},emailMapIdp:{},uiHandler:new n.accountchooser.UiHandler,enableCajole:l},loadService_:function(a,c){var d=this;this[G].uiLoader.loadService(a,this[G].services,function(e){d.executeService_(e,a,c)})},executeService_:function(a,c,d){a=new a;a.setContainer(this.element);a.setCdsConfig(this.cdsConfig);a.executeRequest[U](a,c);this.showCustomizedUI_(c,d)},showCustomizedUI_:function(a,c){if(this[G].uiHandler){var d={};if(a&&a.params_&&
a.params_.clientConfig){d=a.params_.clientConfig.ui||d;d.language=n.accountchooser.util.findLanguageCode(a.params_.clientConfig[O]);!this[G].enableCajole&&Dc==d.cajaMethod&&(d.cajaMethod=Bd);d.serviceType=a.method_;d.accounts=n.accountchooser.util.sanitizeAccounts(a.params_.accounts||[],n.accountchooser.util.accountSanitizer);var e=this;d.onLanguageChanged=function(d){a.params_.clientConfig.language=n.accountchooser.util.findLanguageCode(d);e.loadService_(a,c)}}d.language=d[O]||Nc;d.domain=c[t](/^https?:\/\//,
W);this[G].uiHandler[na](d)}},_create:function(){Xd(this.element).empty();this.cdsConfig={popupMode:this[G].popupMode,idps:this[G].idps,emailMapIdp:this[G].emailMapIdp};this.cdsConfig.rpcs={serviceLoader:Xd.proxy(this.loadService_,this)};try{n.accountchooser.rpc.initCds(this.cdsConfig)}catch(a){!this[G].manageMode&&!this[G].aboutMode&&(a==n.accountchooser.rpc.EMPTY_SAVED_RPC||a==n.accountchooser.rpc.INVALID_CLIENT_DOMAIN)?this.redirectEmptyRequest():!this[G].manageMode&&!this[G].aboutMode&&b(a)}this[G].manageMode?
this.showManagePage():this[G].aboutMode&&this.showAboutPage()},redirectEmptyRequest:function(){var a=n.accountchooser.rpc.getDomainInHash_();n[F].href=a&&n.accountchooser.util.isValidUrlDomain(a)?Vc+a:n[F].protocol+db+n[F].host},showManagePage:function(){var a=n.accountchooser.util.browserconfig.isDisabled(),c=n.accountchooser.util.accountstorage.readAccounts();a||!c[N]?this.showLearnMorePage_():this.sendFakeRequest_(n.accountchooser.rpc.ManageRequest,jd)},showAboutPage:function(){this.sendFakeRequest_(n.accountchooser.rpc.AboutRequest,
wc)},sendFakeRequest_:function(a,c){var d={language:n.accountchooser.util.parseUrlParams(n[F].href).lang,clientCallbackUrl:n[F].href},d={data:(new a(c,d))[B](),origin:n[F].host};n.accountchooser.rpc.process_(d,j)},showLearnMorePage_:function(){var a=n.accountchooser.util.parseUrlParams(n[F].href).lang,c=eb;a&&(c=0<=c[L](X)?c+(Ta+a):c+(pb+a));n[F][t](c)},destroy:function(){Xd(this.element).empty();Xd.Widget[P].destroy[U](this)}};Xd.widget("ui.cds",$d);})()
