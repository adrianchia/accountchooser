/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var b=null,g=!1,h=window,j=document,l=JSON,m="sessionStorage",p="trim",q="setAttribute",r="documentElement",s="localStorage",t="displayName",u="isArray",v="push",w="stringify",x="indexOf",y="param",z="length",A="prototype",B="clientWidth",C="document",D="body",E="call",F="clientHeight",G="",H="&",I="(^|;) ?",J="; expires=",K="; path=/",L="=",M="=([^;]*)(;|$)",N="=; expires=",O="?",P="Clear CDS browser config.",Q="Failed to clear from DOM storage: ",aa="Failed to clear from cookie: ",ba="Failed to read from DOM storage: ",
ca="Failed to read from cookie: ",da="Failed to write to DOM storage: ",ea="Failed to write to cookie: ",fa="Get CDS browser config: ",R="MSIE",ga="Parameter %%param%% cannot be an empty array.",S="Parameter %%param%% cannot be empty.",ha="Parameter %%param%% cannot be null.",ia="Parameter %%param%% is not a function.",ja="Parameter %%param%% is not an array.",ka="Read saved accounts from storage: ",la="Save accounts to storage: ",ma="Set CDS browser config: ",na="[object Array]",oa="[object Function]",
T="chooserAccounts",U="cookieName",V="disabled",W="domStorageKey",pa="form",qa="hidden",ra="input",sa="localStorage",ta="name",X="object",ua="opt_cookieName",va="opt_domStorageKey || opt_cookieName",wa="parentClass",xa="post",ya="sessionStorage",za="type",Y="value",Z;h.accountchooser=h.accountchooser||{};h.cds=h.accountchooser;h.accountchooser.util=h.accountchooser.util||{};h.accountchooser.util.log=function(a){try{h.console&&h.console.log&&h.console.log(a)}catch(c){}};
h.accountchooser.util.uuidCounter_=(new Date).getTime();h.accountchooser.util.generateUuid=function(a){return a&&a.uuid?a.uuid:++h.accountchooser.util.uuidCounter_};h.accountchooser.util.createForm_=function(a,c,e){if(!a)throw"The targetUrl cannot be null.";var d=h[C].createElement(pa);d.method=xa;d.action=a;if(c)for(var f in c)a=h[C].createElement(ra),a[q](za,qa),a[q](ta,f),c[f]===b||void 0===c[f]?a[q](Y,G):a[q](Y,c[f]),d.appendChild(a);e&&(d.target=e);h[C][D].appendChild(d);return d};
h.accountchooser.util.postTo=function(a,c,e){a=h.accountchooser.util.createForm_(a,c,e);a.submit();h[C][D].removeChild(a)};h.accountchooser.util.parseUrlParams=function(a){var c={};a=a.slice(a[x](O)+1).split(H);for(var e=0;e<a[z];e++){var d=a[e].split(L);c[d[0]]=2==d[z]?decodeURIComponent(d[1]):void 0}return c};h.accountchooser.util.formRedirect=function(a,c){var e=a.substring(0,a[x](O)),d=h.accountchooser.util.parseUrlParams(a);h.accountchooser.util.postTo(e,d,c)};
h.accountchooser.util.isBrowserSupported=function(){var a=999;-1!=navigator.appVersion[x](R)&&(a=parseFloat(navigator.appVersion.split(R)[1]));return 7<a};h.accountchooser.util.makeUrl=function(a,c){var e=[],d;for(d in c)e[v](c[d]?d+L+c[d]:d);return a+O+e.join(H)};h.accountchooser.util.isArray=function(a){return"undefined"!==typeof jQuery?jQuery[u](a):Object[A].toString[E](a)===na};
h.accountchooser.util.isFunction=function(a){return"undefined"!==typeof jQuery?jQuery.isFunction(a):Object[A].toString[E](a)===oa};h.accountchooser.util.indexOf=function(a,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(a,c);if(c[x])return c[x](a);for(var e=c[z],d=0;d<e;d++)if(d in c&&c[d]===a)return d}return-1};
h.accountchooser.util.windowWidth=function(a){if("undefined"!==typeof jQuery)return jQuery(a).width();var c=0;a.innerWidth?c=a.innerWidth:a[C]&&a[C][r]&&a[C][r][B]?c=a[C][r][B]:a[C]&&(a[C][D]&&a[C][D][B])&&(c=a[C][D][B]);return c};h.accountchooser.util.windowHeight=function(a){if("undefined"!==typeof jQuery)return jQuery(a).height();var c=0;a.innerHeight?c=a.innerHeight:a[C]&&a[C][r]&&a[C][r][F]?c=a[C][r][F]:a[C]&&(a[C][D]&&a[C][D][F])&&(c=a[C][D][F]);return c};
h.accountchooser.util.trim=function(a){return"undefined"!==typeof jQuery?jQuery[p](a):a==b?G:String[A][p]?String[A][p][E](a):a.replace(/^[\s\xa0]+/,G).replace(/[\s\xa0]+$/,G)};
h.accountchooser.util.extend=function(a,c,e){if(3>arguments[z])return c||{};if("undefined"!==typeof jQuery){var d=Array[A].slice[E](arguments,a?0:1);return jQuery.extend.apply(jQuery,d)}if(typeof c!==X||c==b)c={};for(var d=2,f=arguments[z];d<f;d++){var n=arguments[d];if(n!=b)for(var k in n)void 0===n[k]||c===n[k]||(a&&typeof n[k]==X?(h.accountchooser.util[u](n[k])&&!h.accountchooser.util[u](c[k])&&(c[k]=[]),c[k]=h.accountchooser.util.extend(!0,c[k],n[k])):c[k]=n[k])}return c};
h.accountchooser.param={};h.accountchooser[y].notNull=function(a,c){(void 0===a||a===b)&&h.accountchooser[y].throwError_(ha,c)};h.accountchooser[y].notEmpty=function(a,c){a||h.accountchooser[y].throwError_(S,c)};h.accountchooser[y].notEmptyArray=function(a,c){a||h.accountchooser[y].throwError_(S,c);h.accountchooser.util[u](a)||h.accountchooser[y].throwError_(ja,c);a[z]||h.accountchooser[y].throwError_(ga,c)};
h.accountchooser[y].notEmptyFunction=function(a,c){a||h.accountchooser[y].throwError_(S,c);h.accountchooser.util.isFunction(a)||h.accountchooser[y].throwError_(ia,c)};h.accountchooser[y].throwError_=function(a,c){try{console&&console.trace&&console.trace()}catch(e){}throw a.replace(/\%\%param\%\%/g,c?" '"+c+"'":G);};Function[A].inheritsFrom=function(a){h.accountchooser[y].notEmptyFunction(a,wa);this.prototype=new a;this[A].constructor=this;this[A].parentClass=a[A]};
h.accountchooser.util.Storage=function(a,c,e){h.accountchooser[y].notEmpty(a||c,va);h.accountchooser.util.Storage.isDomStorageSupported(e)||h.accountchooser[y].notEmpty(c,ua);this.domStorageKey_=a;this.cookieName_=c;this.perSession_=e};h.accountchooser.util.Storage.isDomStorageSupported=function(a){try{return a?ya in h&&h[m]!=b:sa in h&&h[s]!=b}catch(c){return g}};Z=h.accountchooser.util.Storage[A];
Z.read=function(){if(h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(a){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(a):this.isCookieStorageAllowed_()&&this.writeToCookie_(a)};
Z.clear=function(){h.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){h.accountchooser[y].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[m]:h[s];try{var c=a.getItem(this.domStorageKey_);if(c)return l.parse(c)}catch(e){h.accountchooser.util.log(ba+e)}};Z.writeToDomStorage_=function(a){h.accountchooser[y].notEmpty(this.domStorageKey_,W);var c=this.perSession_?h[m]:h[s];try{var e=l[w](a);c.setItem(this.domStorageKey_,e)}catch(d){h.accountchooser.util.log(da+d)}};
Z.clearFromDomStorage_=function(){h.accountchooser[y].notEmpty(this.domStorageKey_,W);var a=this.perSession_?h[m]:h[s];try{a.removeItem(this.domStorageKey_)}catch(c){h.accountchooser.util.log(Q+c)}};Z.readFromCookie_=function(){h.accountchooser[y].notEmpty(this.cookieName_,U);var a=j.cookie.match(I+this.cookieName_+M);if(a&&(a=h.accountchooser.util[p](a[2])))try{return l.parse(unescape(a))}catch(c){h.accountchooser.util.log(ca+c)}};
Z.writeToCookie_=function(a){h.accountchooser[y].notEmpty(this.cookieName_,U);try{var c=new Date,e=c.getFullYear()+10,d=c.getMonth(),f=c.getDate(),n=new Date(e,d,f),k=this.perSession_?0:n.toGMTString();j.cookie=this.cookieName_+L+escape(l[w](a))+J+k+K}catch(Aa){h.accountchooser.util.log(ea+Aa)}};
Z.clearFromCookie_=function(){h.accountchooser[y].notEmpty(this.cookieName_,U);try{var a=new Date;a.setTime(a.getTime()-1);j.cookie=this.cookieName_+N+a.toGMTString()+K}catch(c){h.accountchooser.util.log(aa+c)}};h.accountchooser.util.accountstorage={};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_,h.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
h.accountchooser.util.accountstorage.read_=function(){var a=h.accountchooser.util.accountstorage.storage_.read();h.accountchooser.util.log(ka+l[w](a));return a};h.accountchooser.util.accountstorage.write_=function(a){h.accountchooser.util.log(la+l[w](a));h.accountchooser.util.accountstorage.storage_.write(a)};h.accountchooser.util.accountstorage.readAccounts=function(){var a=h.accountchooser.util.accountstorage.read_();if(!a||!h.accountchooser.util[u](a))a=[];return a};
h.accountchooser.util.accountstorage.addAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d,f=0;f<e[z];f++)if(h.accountchooser.util.accountstorage.matchAccount_(e[f],a.email,a.providerId)){d=e[f];e.splice(f,1);c=!0;break}d&&(!a[t]&&d[t]&&(a.displayName=d[t]),!a.photoUrl&&d.photoUrl&&(a.photoUrl=d.photoUrl));e.unshift(a);h.accountchooser.util.accountstorage.write_(e);return!c};
h.accountchooser.util.accountstorage.removeAccount=function(a){if(!a||!a.email)return g;for(var c=g,e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[z];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a.email,a.providerId)){e.splice(d,1);c=!0;break}h.accountchooser.util.accountstorage.write_(e);return c};h.accountchooser.util.accountstorage.clearAccounts=function(){h.accountchooser.util.accountstorage.storage_.clear()};
h.accountchooser.util.accountstorage.updateAccount=function(a,c,e){if(a)for(var d=h.accountchooser.util.accountstorage.readAccounts(),f=0;f<d[z];f++)if(h.accountchooser.util.accountstorage.matchAccount_(d[f],a,e)){c(d[f]);h.accountchooser.util.accountstorage.write_(d);break}};
h.accountchooser.util.accountstorage.refreshAccount=function(a){a&&a.email&&h.accountchooser.util.accountstorage.updateAccount(a.email,function(c){a[t]&&(c.displayName=a[t]);a.photoUrl&&(c.photoUrl=a.photoUrl);void 0!=a.legacy&&(c.legacy=a.legacy)},a.providerId)};
h.accountchooser.util.accountstorage.fetchAccount=function(a,c){if(a)for(var e=h.accountchooser.util.accountstorage.readAccounts(),d=0;d<e[z];d++)if(h.accountchooser.util.accountstorage.matchAccount_(e[d],a,c)){var f=e[d];e.splice(d,1);e.unshift(f);h.accountchooser.util.accountstorage.write_(e);return f}};h.accountchooser.util.accountstorage.matchAccount_=function(a,c,e){return a.email!=c?g:a.providerId&&e&&a.providerId==e||!a.providerId&&!e?!0:g};h.accountchooser.updateSavedAccount=function(a){h.accountchooser.util.accountstorage.addAccount(a)};
h.accountchooser.removeSavedAccount=function(a){return h.accountchooser.util.accountstorage.removeAccount(a)};h.accountchooser.clearSavedAccounts=function(){h.accountchooser.util.accountstorage.clearAccounts()};h.accountchooser.util.accountstorage.ACCOUNTS_=T;h.accountchooser.util.accountstorage.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.accountstorage.ACCOUNTS_);h.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
h.accountchooser.util.accountstorage.readAccounts=function(a){var c=h.accountchooser.util.accountstorage.read_();if(!c||!h.accountchooser.util[u](c))c=[];if(!a)return c;var e=[];if(a.withEmail){var d=function(a){return h.accountchooser.util.isValidEmail(a.email)};e[v](d)}a.idpList&&0!=a.idpList[z]&&(d=function(c){return 0<=h.accountchooser.util[x](c.providerId||h.accountchooser.util.accountstorage.NO_IDP_,a.idpList)},e[v](d));a.emailDomainList&&0!=a.emailDomainList[z]&&(d=function(c){return(c=h.accountchooser.util.getEmailDomain(c.email))?
0<=h.accountchooser.util[x](c,a.emailDomainList):!0},e[v](d));for(d=0;d<e[z];d++)c=h.accountchooser.util.accountstorage.filter_(c,e[d]);return c};h.accountchooser.util.accountstorage.filter_=function(a,c){for(var e=[],d=0;d<a[z];d++)c(a[d])&&e[v](a[d]);return e};h.accountchooser.util.browserconfig={};h.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";h.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
h.accountchooser.util.browserconfig.storage_=new h.accountchooser.util.Storage(h.accountchooser.util.browserconfig.SETTINGS_KEY_,h.accountchooser.util.browserconfig.COOKIE_NAME_);h.accountchooser.util.browserconfig.getAll=function(){var a=h.accountchooser.util.browserconfig.storage_.read()||{};h.accountchooser.util.log(fa+l[w](a));return a};h.accountchooser.util.browserconfig.setAll=function(a){h.accountchooser.util.log(ma+l[w](a));h.accountchooser.util.browserconfig.storage_.write(a)};
h.accountchooser.util.browserconfig.clearAll=function(){h.accountchooser.util.log(P);h.accountchooser.util.browserconfig.storage_.clear()};h.accountchooser.util.browserconfig.get=function(a){return h.accountchooser.util.browserconfig.getAll()[a]};h.accountchooser.util.browserconfig.set=function(a,c){var e=h.accountchooser.util.browserconfig.getAll();e[a]=c;h.accountchooser.util.browserconfig.setAll(e)};
h.accountchooser.util.browserconfig.clear=function(a){var c=h.accountchooser.util.browserconfig.getAll();delete c[a];h.accountchooser.util.browserconfig.setAll(c)};h.accountchooser.util.browserconfig.isDisabled=function(){return!!h.accountchooser.util.browserconfig.get(V)};h.accountchooser.util.browserconfig.setDisabled=function(a){h.accountchooser.util.browserconfig.set(V,!!a)};})()
