/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){var a=void 0,g=!0,j=null,l=!1,m=window,n=document,p=JSON;function q(b,c){return b.toJSON=c}
var r="origin",s="replace",t="data",u="sessionStorage",v="trim",w="setAttribute",x="attachEvent",y="getTime",z="documentElement",A="toString",B="toJSON",C="split",D="localStorage",E="parent",F="removeItem",G="displayName",H="isArray",I="postMessage",J="push",K="Request",L="stringify",M="indexOf",N="param",O="parse",P="length",Q="prototype",R="clientWidth",S="document",T="body",U="call",V="clientHeight",W="toLowerCase",X="",aa=" from ",ba='" is invalid.',ca="&",da="(^|;) ?",ea="*",fa="2.0",ga="; expires=",
ha="; path=/",ia="=",ja="=([^;]*)(;|$)",ka="=; expires=",la="?",ma="@",na="Clear CDS browser config.",oa="Error request format: ",pa="Failed to clear from DOM storage: ",qa="Failed to clear from cookie: ",sa="Failed to parse request: ",ta="Failed to read from DOM storage: ",ua="Failed to read from cookie: ",va="Failed to write to DOM storage: ",wa="Failed to write to cookie: ",xa="Get CDS browser config: ",ya="Ignore expired JSON-RPC object: [",za="Ignore invalid JSON-RPC object: [",Aa="Invalid JSON-RPC object: not a JSON object.",
Ba="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Ca="Invalid parameter",Da="MSIE",Ea="Method not found",Fa="Parameter %%param%% cannot be an empty array.",Ga="Parameter %%param%% cannot be empty.",Ha="Parameter %%param%% cannot be null.",Ia="Parameter %%param%% is not a function.",Ja="Parameter %%param%% is not an array.",Ka="Read saved accounts from storage: ",La="Received message: ",Ma="Register handler for postMessage failed.",Na="Save accounts to storage: ",Oa="Send message: ",
Pa="Service is disabled. Method is not available.",Qa="Set CDS browser config: ",Ra="Successfully parsing request: ",Sa='The query "',Ta="Unrecognized rpcObject: ",Ua="[object Array]",Va="[object Function]",Wa="]",Xa="account",Ya="accounts",Za="chooserAccounts",$a="cookieName",ab="disabled",bb="domStorageKey",cb="form",db="handler",eb="hidden",Y="id",fb="input",gb="localStorage",hb="message",ib="name",jb="object",kb="onmessage",lb="opt_cookieName",mb="opt_domStorageKey || opt_cookieName",nb="parentClass",
ob="post",pb="query",qb="requestId",rb="serviceName",sb="sessionStorage",tb="targetWindow",ub="type",vb="value",Z;m.accountchooser=m.accountchooser||{};m.cds=m.accountchooser;m.accountchooser.util=m.accountchooser.util||{};m.accountchooser.util.log=function(b){try{m.console&&m.console.log&&m.console.log(b)}catch(c){}};m.accountchooser.util.uuidCounter_=(new Date)[y]();m.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++m.accountchooser.util.uuidCounter_};
m.accountchooser.util.createForm_=function(b,c,d){if(!b)throw"The targetUrl cannot be null.";var e=m[S].createElement(cb);e.method=ob;e.action=b;if(c)for(var f in c)b=m[S].createElement(fb),b[w](ub,eb),b[w](ib,f),c[f]===j||c[f]===a?b[w](vb,X):b[w](vb,c[f]),e.appendChild(b);d&&(e.target=d);m[S][T].appendChild(e);return e};m.accountchooser.util.postTo=function(b,c,d){b=m.accountchooser.util.createForm_(b,c,d);b.submit();m[S][T].removeChild(b)};
m.accountchooser.util.parseUrlParams=function(b){var c={};b=b.slice(b[M](la)+1)[C](ca);for(var d=0;d<b[P];d++){var e=b[d][C](ia);c[e[0]]=2==e[P]?decodeURIComponent(e[1]):a}return c};m.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[M](la)),e=m.accountchooser.util.parseUrlParams(b);m.accountchooser.util.postTo(d,e,c)};m.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=navigator.appVersion[M](Da)&&(b=parseFloat(navigator.appVersion[C](Da)[1]));return 7<b};
m.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[J](c[e]?e+ia+c[e]:e);return b+la+d.join(ca)};m.accountchooser.util.isArray=function(b){return"undefined"!==typeof jQuery?jQuery[H](b):Object[Q][A][U](b)===Ua};m.accountchooser.util.isFunction=function(b){return"undefined"!==typeof jQuery?jQuery.isFunction(b):Object[Q][A][U](b)===Va};
m.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof jQuery)return jQuery.inArray(b,c);if(c[M])return c[M](b);for(var d=c[P],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};m.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof jQuery)return jQuery(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[S]&&b[S][z]&&b[S][z][R]?c=b[S][z][R]:b[S]&&(b[S][T]&&b[S][T][R])&&(c=b[S][T][R]);return c};
m.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof jQuery)return jQuery(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[S]&&b[S][z]&&b[S][z][V]?c=b[S][z][V]:b[S]&&(b[S][T]&&b[S][T][V])&&(c=b[S][T][V]);return c};m.accountchooser.util.trim=function(b){return"undefined"!==typeof jQuery?jQuery[v](b):b==j?X:String[Q][v]?String[Q][v][U](b):b[s](/^[\s\xa0]+/,X)[s](/[\s\xa0]+$/,X)};
m.accountchooser.util.extend=function(b,c,d){if(3>arguments[P])return c||{};if("undefined"!==typeof jQuery){var e=Array[Q].slice[U](arguments,b?0:1);return jQuery.extend.apply(jQuery,e)}if(typeof c!==jb||c==j)c={};for(var e=2,f=arguments[P];e<f;e++){var h=arguments[e];if(h!=j)for(var k in h)h[k]===a||c===h[k]||(b&&typeof h[k]==jb?(m.accountchooser.util[H](h[k])&&!m.accountchooser.util[H](c[k])&&(c[k]=[]),c[k]=m.accountchooser.util.extend(g,c[k],h[k])):c[k]=h[k])}return c};m.accountchooser.param={};
m.accountchooser[N].notNull=function(b,c){(b===a||b===j)&&m.accountchooser[N].throwError_(Ha,c)};m.accountchooser[N].notEmpty=function(b,c){b||m.accountchooser[N].throwError_(Ga,c)};m.accountchooser[N].notEmptyArray=function(b,c){b||m.accountchooser[N].throwError_(Ga,c);m.accountchooser.util[H](b)||m.accountchooser[N].throwError_(Ja,c);b[P]||m.accountchooser[N].throwError_(Fa,c)};
m.accountchooser[N].notEmptyFunction=function(b,c){b||m.accountchooser[N].throwError_(Ga,c);m.accountchooser.util.isFunction(b)||m.accountchooser[N].throwError_(Ia,c)};m.accountchooser[N].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}throw b[s](/\%\%param\%\%/g,c?" '"+c+"'":X);};Function[Q].inheritsFrom=function(b){m.accountchooser[N].notEmptyFunction(b,nb);this.prototype=new b;this[Q].constructor=this;this[Q].parentClass=b[Q]};
m.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;m.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;m.accountchooser.util.isValidEmail=function(b){return b&&j!=m.accountchooser.util.VALID_EMAIL_REGEX_.exec(b)};m.accountchooser.util.isValidDomain=function(b){return b&&j!=m.accountchooser.util.VALID_DOMAIN_REGEX_.exec(b)};
m.accountchooser.util.getEmailDomain=function(b){if((b=m.accountchooser.util[v](b))&&m.accountchooser.util.isValidEmail(b))return b[C](ma)[1][W]()};m.accountchooser.util.getEmailUsername=function(b){if((b=m.accountchooser.util[v](b))&&m.accountchooser.util.isValidEmail(b))return b[C](ma)[0][W]()};m.accountchooser.util.isDomainInNascar=function(b){if(b){var c=m.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};
m.accountchooser.util.Storage=function(b,c,d){m.accountchooser[N].notEmpty(b||c,mb);m.accountchooser.util.Storage.isDomStorageSupported(d)||m.accountchooser[N].notEmpty(c,lb);this.domStorageKey_=b;this.cookieName_=c;this.perSession_=d};m.accountchooser.util.Storage.isDomStorageSupported=function(b){try{return b?sb in m&&m[u]!=j:gb in m&&m[D]!=j}catch(c){return l}};Z=m.accountchooser.util.Storage[Q];
Z.read=function(){if(m.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};Z.write=function(b){m.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};
Z.clear=function(){m.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){m.accountchooser[N].notEmpty(this.domStorageKey_,bb);var b=this.perSession_?m[u]:m[D];try{var c=b.getItem(this.domStorageKey_);if(c)return p[O](c)}catch(d){m.accountchooser.util.log(ta+d)}};Z.writeToDomStorage_=function(b){m.accountchooser[N].notEmpty(this.domStorageKey_,bb);var c=this.perSession_?m[u]:m[D];try{var d=p[L](b);c.setItem(this.domStorageKey_,d)}catch(e){m.accountchooser.util.log(va+e)}};
Z.clearFromDomStorage_=function(){m.accountchooser[N].notEmpty(this.domStorageKey_,bb);var b=this.perSession_?m[u]:m[D];try{b[F](this.domStorageKey_)}catch(c){m.accountchooser.util.log(pa+c)}};Z.readFromCookie_=function(){m.accountchooser[N].notEmpty(this.cookieName_,$a);var b=n.cookie.match(da+this.cookieName_+ja);if(b&&(b=m.accountchooser.util[v](b[2])))try{return p[O](unescape(b))}catch(c){m.accountchooser.util.log(ua+c)}};
Z.writeToCookie_=function(b){m.accountchooser[N].notEmpty(this.cookieName_,$a);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),h=new Date(d,e,f),k=this.perSession_?0:h.toGMTString();n.cookie=this.cookieName_+ia+escape(p[L](b))+ga+k+ha}catch(ra){m.accountchooser.util.log(wa+ra)}};
Z.clearFromCookie_=function(){m.accountchooser[N].notEmpty(this.cookieName_,$a);try{var b=new Date;b.setTime(b[y]()-1);n.cookie=this.cookieName_+ka+b.toGMTString()+ha}catch(c){m.accountchooser.util.log(qa+c)}};m.accountchooser.util.accountstorage={};m.accountchooser.util.accountstorage.ACCOUNTS_=Za;m.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";m.accountchooser.util.accountstorage.storage_=new m.accountchooser.util.Storage(m.accountchooser.util.accountstorage.ACCOUNTS_,m.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
m.accountchooser.util.accountstorage.read_=function(){var b=m.accountchooser.util.accountstorage.storage_.read();m.accountchooser.util.log(Ka+p[L](b));return b};m.accountchooser.util.accountstorage.write_=function(b){m.accountchooser.util.log(Na+p[L](b));m.accountchooser.util.accountstorage.storage_.write(b)};m.accountchooser.util.accountstorage.readAccounts=function(){var b=m.accountchooser.util.accountstorage.read_();if(!b||!m.accountchooser.util[H](b))b=[];return b};
m.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return l;for(var c=l,d=m.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[P];f++)if(m.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=g;break}e&&(!b[G]&&e[G]&&(b.displayName=e[G]),!b.photoUrl&&e.photoUrl&&(b.photoUrl=e.photoUrl));d.unshift(b);m.accountchooser.util.accountstorage.write_(d);return!c};
m.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return l;for(var c=l,d=m.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[P];e++)if(m.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=g;break}m.accountchooser.util.accountstorage.write_(d);return c};m.accountchooser.util.accountstorage.clearAccounts=function(){m.accountchooser.util.accountstorage.storage_.clear()};
m.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=m.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[P];f++)if(m.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);m.accountchooser.util.accountstorage.write_(e);break}};
m.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&m.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[G]&&(c.displayName=b[G]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=a&&(c.legacy=b.legacy)},b.providerId)};
m.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=m.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[P];e++)if(m.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);m.accountchooser.util.accountstorage.write_(d);return f}};m.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?l:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?g:l};m.accountchooser.updateSavedAccount=function(b){m.accountchooser.util.accountstorage.addAccount(b)};
m.accountchooser.removeSavedAccount=function(b){return m.accountchooser.util.accountstorage.removeAccount(b)};m.accountchooser.clearSavedAccounts=function(){m.accountchooser.util.accountstorage.clearAccounts()};m.accountchooser.util.accountstorage.ACCOUNTS_=Za;m.accountchooser.util.accountstorage.storage_=new m.accountchooser.util.Storage(m.accountchooser.util.accountstorage.ACCOUNTS_);m.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
m.accountchooser.util.accountstorage.readAccounts=function(b){var c=m.accountchooser.util.accountstorage.read_();if(!c||!m.accountchooser.util[H](c))c=[];if(!b)return c;var d=[];if(b.withEmail){var e=function(b){return m.accountchooser.util.isValidEmail(b.email)};d[J](e)}b.idpList&&0!=b.idpList[P]&&(e=function(c){return 0<=m.accountchooser.util[M](c.providerId||m.accountchooser.util.accountstorage.NO_IDP_,b.idpList)},d[J](e));b.emailDomainList&&0!=b.emailDomainList[P]&&(e=function(c){return(c=m.accountchooser.util.getEmailDomain(c.email))?
0<=m.accountchooser.util[M](c,b.emailDomainList):g},d[J](e));for(e=0;e<d[P];e++)c=m.accountchooser.util.accountstorage.filter_(c,d[e]);return c};m.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[P];e++)c(b[e])&&d[J](b[e]);return d};m.accountchooser.util.browserconfig={};m.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";m.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
m.accountchooser.util.browserconfig.storage_=new m.accountchooser.util.Storage(m.accountchooser.util.browserconfig.SETTINGS_KEY_,m.accountchooser.util.browserconfig.COOKIE_NAME_);m.accountchooser.util.browserconfig.getAll=function(){var b=m.accountchooser.util.browserconfig.storage_.read()||{};m.accountchooser.util.log(xa+p[L](b));return b};m.accountchooser.util.browserconfig.setAll=function(b){m.accountchooser.util.log(Qa+p[L](b));m.accountchooser.util.browserconfig.storage_.write(b)};
m.accountchooser.util.browserconfig.clearAll=function(){m.accountchooser.util.log(na);m.accountchooser.util.browserconfig.storage_.clear()};m.accountchooser.util.browserconfig.get=function(b){return m.accountchooser.util.browserconfig.getAll()[b]};m.accountchooser.util.browserconfig.set=function(b,c){var d=m.accountchooser.util.browserconfig.getAll();d[b]=c;m.accountchooser.util.browserconfig.setAll(d)};
m.accountchooser.util.browserconfig.clear=function(b){var c=m.accountchooser.util.browserconfig.getAll();delete c[b];m.accountchooser.util.browserconfig.setAll(c)};m.accountchooser.util.browserconfig.isDisabled=function(){return!!m.accountchooser.util.browserconfig.get(ab)};m.accountchooser.util.browserconfig.setDisabled=function(b){m.accountchooser.util.browserconfig.set(ab,!!b)};m.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};
m.accountchooser.util.sanitizeAccount=function(b,c,d){var e={},f=m.accountchooser.util.AccountPropertyKey,h;for(h in b){var k=b[h];switch(h){case f.EMAIL:case f.DISPLAY_NAME:case f.PHOTO_URL:case f.PROVIDER_ID:(k=c?c(h,k):k)&&(e[h]=k);break;default:if(!d)throw'Unrecognized key "'+h+'" for account';}}if(!e[f.EMAIL])throw"No valid email field for the account";return e};
m.accountchooser.util.sanitizeAccounts=function(b,c,d){for(var e=[],f=0,h=b[P];f<h;f++){var k=m.accountchooser.util.sanitizeAccount(b[f],c,d);e[J](k)}return e};m.accountchooser.util.accountSanitizer=function(b,c){if(b==m.accountchooser.util.AccountPropertyKey.PHOTO_URL){if(/https?:\/\//i.test(c))return c}else return html.sanitizeWithPolicy(c,function(){})};m.accountchooser.rpc=m.accountchooser.rpc||{};m.accountchooser.rpc.RpcObject=function(){};
m.accountchooser.rpc.RpcObject[Q].setTimestamp=function(b){this.timestamp_=b||(new Date)[y]()};q(m.accountchooser.rpc.RpcObject[Q],function(){var b={jsonrpc:fa};this.timestamp_!=j&&(b.timestamp=this.timestamp_);return b});m.accountchooser.rpc.RpcObject[Q].toString=function(){return p[L](this[B]())};m.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};m.accountchooser.rpc.AbstractRequest.inheritsFrom(m.accountchooser.rpc.RpcObject);Z=m.accountchooser.rpc.AbstractRequest[Q];
Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};q(Z,function(){var b=m.accountchooser.rpc.RpcObject[Q][B][U](this);this.method_!=j&&(b.method=this.method_);this.params_!=j&&(b.params=this.params_);return b});m.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};m.accountchooser.rpc.Notification.inheritsFrom(m.accountchooser.rpc.AbstractRequest);
m.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};m.accountchooser.rpc[K].inheritsFrom(m.accountchooser.rpc.AbstractRequest);m.accountchooser.rpc[K][Q].setId=function(b){this.id_=b};m.accountchooser.rpc[K][Q].getId=function(){return this.id_};q(m.accountchooser.rpc[K][Q],function(){var b=m.accountchooser.rpc.AbstractRequest[Q][B][U](this);this.id_!=j&&(b.id=this.id_);return b});
m.accountchooser.rpc.Response=function(b,c,d){m.accountchooser[N].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};m.accountchooser.rpc.Response.inheritsFrom(m.accountchooser.rpc.RpcObject);Z=m.accountchooser.rpc.Response[Q];Z.getResult=function(){return this.result_};Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};
q(Z,function(){var b=m.accountchooser.rpc.RpcObject[Q][B][U](this);b.id=this.id_;this.result_!=j?b.result=this.result_:this.error_!=j&&(b.error=this.error_);return b});m.accountchooser.rpc.RequestAckNotification=function(b){m.accountchooser[N].notEmpty(b,qb);this.method_=m.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};m.accountchooser.rpc.RequestAckNotification.inheritsFrom(m.accountchooser.rpc.Notification);m.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
m.accountchooser.rpc.RequestAckNotification[Q].setRequestId=function(b){this.params_.requestId=b};m.accountchooser.rpc.RequestAckNotification[Q].getRequestId=function(){return this.params_.requestId};m.accountchooser.rpc.CdsReadyNotification=function(){this.method_=m.accountchooser.rpc.CdsReadyNotification.METHOD};m.accountchooser.rpc.CdsReadyNotification.inheritsFrom(m.accountchooser.rpc.Notification);m.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
m.accountchooser.rpc.ClientReadyNotification=function(){this.method_=m.accountchooser.rpc.ClientReadyNotification.METHOD};m.accountchooser.rpc.ClientReadyNotification.inheritsFrom(m.accountchooser.rpc.Notification);m.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";m.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=m.accountchooser.rpc.EmptyResponseNotification.METHOD};m.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(m.accountchooser.rpc.Notification);
m.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";m.accountchooser.rpc.StoreRequest=function(b,c,d){m.accountchooser[N].notEmpty(b,Y);m.accountchooser[N].notEmptyArray(c,Ya);c&&(c=m.accountchooser.util.sanitizeAccounts(c));this.method_=m.accountchooser.rpc.StoreRequest.METHOD;this.params_={accounts:c,clientConfig:d};this.id_=b};m.accountchooser.rpc.StoreRequest.inheritsFrom(m.accountchooser.rpc[K]);m.accountchooser.rpc.StoreRequest.METHOD="store";
m.accountchooser.rpc.SelectRequest=function(b,c,d){m.accountchooser[N].notEmpty(b,Y);c&&(c=m.accountchooser.util.sanitizeAccounts(c));this.method_=m.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};m.accountchooser.rpc.SelectRequest.inheritsFrom(m.accountchooser.rpc[K]);m.accountchooser.rpc.SelectRequest.METHOD="select";
m.accountchooser.rpc.UpdateRequest=function(b,c,d){m.accountchooser[N].notEmpty(b,Y);m.accountchooser[N].notEmpty(c,Xa);c&&(c=m.accountchooser.util.sanitizeAccount(c));this.method_=m.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};m.accountchooser.rpc.UpdateRequest.inheritsFrom(m.accountchooser.rpc[K]);m.accountchooser.rpc.UpdateRequest.METHOD="update";
m.accountchooser.rpc.ManageRequest=function(b,c){m.accountchooser[N].notEmpty(b,Y);this.method_=m.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};m.accountchooser.rpc.ManageRequest.inheritsFrom(m.accountchooser.rpc[K]);m.accountchooser.rpc.ManageRequest.METHOD="manage";m.accountchooser.rpc.AboutRequest=function(b,c){m.accountchooser[N].notEmpty(b,Y);this.method_=m.accountchooser.rpc.AboutRequest.METHOD;this.params_={clientConfig:c};this.id_=b};m.accountchooser.rpc.AboutRequest.inheritsFrom(m.accountchooser.rpc[K]);
m.accountchooser.rpc.AboutRequest.METHOD="about";m.accountchooser.rpc.QueryRequest=function(b,c,d,e){m.accountchooser[N].notEmpty(b,Y);m.accountchooser[N].notEmpty(c,pb);d&&(d=m.accountchooser.util.sanitizeAccount(d));this.method_=m.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};m.accountchooser.rpc.QueryRequest.inheritsFrom(m.accountchooser.rpc[K]);m.accountchooser.rpc.QueryRequest.METHOD=pb;
m.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};
m.accountchooser.rpc.parseRpcObject=function(b){var c=j;if(b){try{var d=p[O](b)}catch(e){return m.accountchooser.util.log(Aa),c}if(!d||d.jsonrpc!=fa)m.accountchooser.util.log(Ba);else if(d.method){var f=d.method[W]();f==m.accountchooser.rpc.StoreRequest.METHOD[W]()?d.id&&(d.params&&d.params.accounts)&&(c=new m.accountchooser.rpc.StoreRequest(d.id,d.params.accounts,d.params.clientConfig)):f==m.accountchooser.rpc.SelectRequest.METHOD[W]()?d.id&&(c=new m.accountchooser.rpc.SelectRequest(d.id,d.params.localAccounts,
d.params.clientConfig)):f==m.accountchooser.rpc.UpdateRequest.METHOD[W]()?d.id&&(d.params&&d.params.account)&&(c=new m.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==m.accountchooser.rpc.QueryRequest.METHOD[W]()?c=new m.accountchooser.rpc.QueryRequest(d.id,d.params.query,d.params.account,d.params.clientConfig):f==m.accountchooser.rpc.ClientReadyNotification.METHOD[W]()&&(c=new m.accountchooser.rpc.ClientReadyNotification)}}c?m.accountchooser.util.log(Ra+b):m.accountchooser.util.log(sa+
b);return c};m.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";m.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";m.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";m.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";m.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;m.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;m.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";m.accountchooser.rpc.IDP_TIMEOUT=3E3;m.accountchooser.rpc.RPC_TIMEOUT=3E5;
m.accountchooser.rpc.services_={};m.accountchooser.rpc.register=function(b,c){m.accountchooser[N].notEmpty(b,rb);m.accountchooser[N].notNull(c,db);m.accountchooser.rpc.services_[b]=c};m.accountchooser.rpc.call=function(b,c,d){m.accountchooser[N].notEmpty(b,tb);c=c[A]();m.accountchooser.util.log(Oa+c);b[I](c,d||ea)};m.accountchooser.rpc.init_=function(b){m.addEventListener?m.addEventListener(hb,b,l):m[x]?m[x](kb,b):m[S][x]?m[S][x](kb,b):m.accountchooser.util.log(Ma)};
m.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";m.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
m.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?m.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:m.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[s](/^https?:\/\//,X);var e=[],f=m[u].getItem(d);if(f){m[u][F](d);var h=m.JSON[O](f)||[],f=(new Date)[y]();if(h[P]){h=h[h[P]-1];try{var k=p[O](h);k&&k.timestamp&&f-k.timestamp<m.accountchooser.rpc.RPC_TIMEOUT?(e[J](h),c&&m[u].setItem(d,m.JSON[L](e))):m.accountchooser.util.log(ya+h+Wa)}catch(ra){m.accountchooser.util.log(za+h+Wa)}}}return e};
m.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[s](/^https?:\/\//,X);m[u][F](m.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);m[u][F](m.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?m.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:m.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[J](c[A]());c=m.JSON[L](b);m[u].setItem(d,c)};
m.accountchooser.rpc.triggerSavedRpcs_=function(b){if(m[E]){var c=m.accountchooser.rpc.readSavedRpcObjects(b,l);if(c&&c[P])for(var d=0;d<c[P];d++)m[E][I](c[d],b);else m.accountchooser.rpc[U](m[E],new m.accountchooser.rpc.EmptyResponseNotification)}};m.accountchooser.rpc.saveAndAckRequest_=function(b,c){m.accountchooser.rpc.saveRpcObject(c,b,g);var d=new m.accountchooser.rpc.RequestAckNotification(b.id_);m[E][I](d[A](),c)};
m.accountchooser.rpc.handleQuery_=function(b,c){var d=l;switch(b.params_.query){case m.accountchooser.rpc.Queries.CDS_DISABLED:d=m.accountchooser.rpc.checkCdsDisabled_();break;case m.accountchooser.rpc.Queries.CDS_EMPTY:d=m.accountchooser.rpc.checkCdsEmpty_(b.params_.clientConfig);break;case m.accountchooser.rpc.Queries.ACCOUNT_EXIST:d=m.accountchooser.rpc.checkAccountExist_(b.params_.account,b.params_.clientConfig);break;default:m.accountchooser.rpc.sendInvalidQueryResponse_(b,c);return}d=new m.accountchooser.rpc.Response(b.id_,
d);m[E][I](d[A](),c)};m.accountchooser.rpc.checkCdsDisabled_=function(){return m.accountchooser.util.browserconfig.isDisabled()};m.accountchooser.rpc.checkCdsEmpty_=function(){return!m.accountchooser.util.accountstorage.readAccounts()[P]};m.accountchooser.rpc.checkAccountExist_=function(b){for(var c=m.accountchooser.util.accountstorage.readAccounts(),d=0;d<c[P];++d){var e=c[d];if(m.accountchooser.util.accountstorage.matchAccount_(b,e.email,e.providerId))return g}return l};
m.accountchooser.rpc.getAllAccountsByClientConfig_=function(b){return m.accountchooser.util.accountstorage.readAccounts({withEmail:b&&!b.showAll,idpList:b&&b.idpFilter})};m.accountchooser.rpc.sendErrorResponse_=function(b,c,d){b=new m.accountchooser.rpc.Response(c.id_,a,b);m[E][I](b[A](),d)};m.accountchooser.rpc.sendDisableResponse_=function(b,c){m.accountchooser.rpc.sendErrorResponse_({code:-32601,message:Ea,data:Pa},b,c)};
m.accountchooser.rpc.sendInvalidQueryResponse_=function(b,c){m.accountchooser.rpc.sendErrorResponse_({code:-32602,message:Ca,data:Sa+b.params_.query+ba},b,c)};
m.accountchooser.rpc.process_=function(b){m.accountchooser.util.log(La+b[t]+aa+b[r]);var c=m.accountchooser.rpc.parseRpcObject(b[t]);c?c instanceof m.accountchooser.rpc.ClientReadyNotification?m.accountchooser.rpc.triggerSavedRpcs_(b[r]):c instanceof m.accountchooser.rpc[K]?c instanceof m.accountchooser.rpc.QueryRequest?m.accountchooser.rpc.handleQuery_(c,b[r]):m.accountchooser.rpc.saveAndAckRequest_(c,b[r]):m.accountchooser.util.log(Ta+b[t]):m.accountchooser.util.log(oa+b[t])};m.accountchooser.rpc.init_(m.accountchooser.rpc.process_);})()
