/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){function a(b){throw b;}var g=void 0,h=!0,j=null,k=!1,l=window,m=document,n=JSON,q=jQuery,aa=navigator;function ba(b,c){return b.toJSON=c}
var ca="origin",r="exec",s="replace",t="data",da="extend",u="sessionStorage",v="trim",w="createElement",x="setAttribute",ea="attachEvent",y="getTime",fa="getElementsByTagName",z="documentElement",A="toString",B="html",ga="toJSON",C="queue",D="setTimeout",E="split",ha="inArray",F="location",ia="localStorage",ja="removeItem",G="options",ka="displayName",H="isArray",la="postMessage",I="push",ma="show",J="Request",K="stringify",na="load",L="indexOf",M="param",oa="name",pa="parse",N="length",O="language",
P="prototype",R="labels",qa="clientWidth",S="document",T="body",ra="removeChild",U="call",sa="clientHeight",V="toLowerCase",W="",ta=" <span>",ua=" from ",va=" rtl",wa='", must be under domain "',xa='".',ya='"]',za="\"]', not exist.",Aa="\"]'.",Ba="#",Ca="#ac-language",Da="#ac-market",Ea="#copyright",Fa="#learnmore",Ga="#manage_marketing_box > h1",Ha="#manage_marketing_box > p",Ia="#sample-accountchooser",Ja="#select_marketing_box",Ka="#select_marketing_box > h1",La="#store_marketing_box",Ma="#store_marketing_box > h1",
Na="#store_marketing_box > p",Oa="#update_marketing_box",Pa="#update_marketing_box > h1",Qa="#update_marketing_box > p",Ra="&",Sa="&lang=",Ta="'",Ua="' found!",Va="' has't initialized yet.",Wa="', uuid='",Xa="'.",Ya="': no valid iframeUrl.",Za="(^|;) ?",$a="*",ab="-9999px",bb=".",cb="//",db="/learnmore.html",eb="1px",fb="2.0",gb=":",hb="; expires=",ib="; path=/",jb="</span>",kb="<iframe />",lb="=",mb="=([^;]*)(;|$)",nb="=; expires=",X="?",ob="?lang=",pb="@",rb="Caja process stoped due to timeout.",
sb="CallClient failed: cannot find client window.",tb="Clear CDS browser config.",ub="Error request format: ",vb="Failed to clear from DOM storage: ",wb="Failed to clear from cookie: ",xb="Failed to find callback for response: ",yb="Failed to find widget with uuid '",zb="Failed to get client domain in URL hash.",Ab="Failed to init IDP iframe for '",Bb="Failed to parse request: ",Cb="Failed to read from DOM storage: ",Db="Failed to read from cookie: ",Eb="Failed to write to DOM storage: ",Fb="Failed to write to cookie: ",
Gb="GET",Hb="Get CDS browser config: ",Ib="Guest code rendered successfully.",Jb="Ignore expired JSON-RPC object: [",Kb="Ignore invalid JSON-RPC object: [",Lb='Illegal clientCallbackUrl "',Mb='Illegal negativeCallbackUrl "',Nb='Illegal positiveCallbackUrl "',Ob="Illegal request: ",Pb="Illegal state error: IDP domain '",Qb="Invalid JSON-RPC object: not a JSON object.",Rb="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Sb="Invalid value for 'options.emailMapIdp.[\"",Tb="Invalid value for 'options.emailMapIdp[\"",
Ub="MSIE",Vb="No RPC handler for '",Wb="No content returned in the HTML file.",Xb="Parameter %%param%% cannot be an empty array.",Yb="Parameter %%param%% cannot be empty.",Zb="Parameter %%param%% cannot be null.",$b="Parameter %%param%% is not a function.",ac="Parameter %%param%% is not an array.",bc="Read saved accounts from storage: ",cc="Received message: ",dc="Register handler for postMessage failed.",ec="Save accounts to storage: ",fc="Send message: ",gc="Set CDS browser config: ",hc="Successfully parsing request: ",
ic="Timeout when initializing Caja.",jc="Timeout when loading caja.js.",kc="Timeout when loading raw HTML.",lc="Unimplementated! Child object must provide an impelementation.",mc="Unimplementated! Child object must provide an implementation.",nc="Unrecognized request: ",oc="Unsupported IDP '",pc="Unsupported IDP domain '",qc='[id^="',rc="[object Array]",sc="[object Function]",tc="]",uc="_",vc="about",wc="absolute",xc="ac-market",yc="account",zc="accounts",Ac="ar",Bc="body",Cc="cajole",Dc="callback",
Ec="change",Fc="chooserAccounts",Gc="class",Hc="complete",Ic="cookieName",Jc="disabled",Kc="domStorageKey",Lc="domain",Mc="en",Nc="form",Oc="handler",Pc="head",Qc="height",Rc="hidden",Sc="href",Tc="html",Uc="http://",Vc="https://ssl.gstatic.com/caja/",Y="id",Wc="idpConfig",Xc="iframeUrl",Yc="image/x-icon",Zc="img",$c="input",ad="iw",bd="jsUrl",cd="lang=",dd="left",ed="link",fd="loaded",gd="localStorage",hd="ltr",id="manage",jd="message",kd="msg_",ld="name",md="object",nd="ol.benefit-list > li > p",
od="onmessage",pd="opt_cookieName",qd="opt_domStorageKey || opt_cookieName",rd="parentClass",sd="position",td="post",ud="query",vd="rel",wd="request",xd="requestId",yd="rpcObject",zd="rtl",Ad="sanitize",Bd="script",Cd="semaphore value decrease to ",Dd="serviceMeta",Ed="serviceMeta.name",Fd="serviceName",Gd="sessionStorage",Hd="shortcut icon",Id="src",Jd="string",Kd="stylesheet",Ld="targetWindow",Md="text/css",Nd="text/html",Od="text/javascript",Pd="timeout",Qd="timeoutCallback",Rd="type",Sd="value",
Td="width",Ud="window",Vd="window.notifyWidget: type='",Z;l.accountchooser=l.accountchooser||{};l.cds=l.accountchooser;l.accountchooser.util=l.accountchooser.util||{};l.accountchooser.util.log=function(b){try{l.console&&l.console.log&&l.console.log(b)}catch(c){}};l.accountchooser.util.uuidCounter_=(new Date)[y]();l.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++l.accountchooser.util.uuidCounter_};
l.accountchooser.util.createForm_=function(b,c,d){b||a("The targetUrl cannot be null.");var e=l[S][w](Nc);e.method=td;e.action=b;if(c)for(var f in c)b=l[S][w]($c),b[x](Rd,Rc),b[x](ld,f),c[f]===j||c[f]===g?b[x](Sd,W):b[x](Sd,c[f]),e.appendChild(b);d&&(e.target=d);l[S][T].appendChild(e);return e};l.accountchooser.util.postTo=function(b,c,d){b=l.accountchooser.util.createForm_(b,c,d);b.submit();l[S][T][ra](b)};
l.accountchooser.util.parseUrlParams=function(b){var c={};b=b.slice(b[L](X)+1)[E](Ra);for(var d=0;d<b[N];d++){var e=b[d][E](lb);c[e[0]]=2==e[N]?decodeURIComponent(e[1]):g}return c};l.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[L](X)),e=l.accountchooser.util.parseUrlParams(b);l.accountchooser.util.postTo(d,e,c)};l.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=aa.appVersion[L](Ub)&&(b=parseFloat(aa.appVersion[E](Ub)[1]));return 7<b};
l.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[I](c[e]?e+lb+c[e]:e);return b+X+d.join(Ra)};l.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};l.accountchooser.util.sanitizeAccount=function(b,c){var d={},e=l.accountchooser.util.AccountPropertyKey,f;for(f in b)switch(f){case e.EMAIL:case e.DISPLAY_NAME:case e.PHOTO_URL:case e.PROVIDER_ID:d[f]=b[f];break;default:c||a('Unrecognized key "'+f+'" for account')}return d};
l.accountchooser.util.sanitizeAccounts=function(b){for(var c=[],d=0,e=b[N];d<e;d++){var f=l.accountchooser.util.sanitizeAccount(b[d]);c[I](f)}return c};l.accountchooser.util.isArray=function(b){return"undefined"!==typeof q?q[H](b):Object[P][A][U](b)===rc};l.accountchooser.util.isFunction=function(b){return"undefined"!==typeof q?q.isFunction(b):Object[P][A][U](b)===sc};
l.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof q)return q[ha](b,c);if(c[L])return c[L](b);for(var d=c[N],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};l.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof q)return q(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[S]&&b[S][z]&&b[S][z][qa]?c=b[S][z][qa]:b[S]&&(b[S][T]&&b[S][T][qa])&&(c=b[S][T][qa]);return c};
l.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof q)return q(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[S]&&b[S][z]&&b[S][z][sa]?c=b[S][z][sa]:b[S]&&(b[S][T]&&b[S][T][sa])&&(c=b[S][T][sa]);return c};l.accountchooser.util.trim=function(b){return"undefined"!==typeof q?q[v](b):b==j?W:String[P][v]?String[P][v][U](b):b[s](/^[\s\xa0]+/,W)[s](/[\s\xa0]+$/,W)};
l.accountchooser.util.extend=function(b,c,d){if(3>arguments[N])return c||{};if("undefined"!==typeof q){var e=Array[P].slice[U](arguments,b?0:1);return q[da].apply(q,e)}if(typeof c!==md||c==j)c={};for(var e=2,f=arguments[N];e<f;e++){var i=arguments[e];if(i!=j)for(var p in i)i[p]===g||c===i[p]||(b&&typeof i[p]==md?(l.accountchooser.util[H](i[p])&&!l.accountchooser.util[H](c[p])&&(c[p]=[]),c[p]=l.accountchooser.util[da](h,c[p],i[p])):c[p]=i[p])}return c};l.accountchooser.param={};
l.accountchooser[M].notNull=function(b,c){(b===g||b===j)&&l.accountchooser[M].throwError_(Zb,c)};l.accountchooser[M].notEmpty=function(b,c){b||l.accountchooser[M].throwError_(Yb,c)};l.accountchooser[M].notEmptyArray=function(b,c){b||l.accountchooser[M].throwError_(Yb,c);l.accountchooser.util[H](b)||l.accountchooser[M].throwError_(ac,c);b[N]||l.accountchooser[M].throwError_(Xb,c)};
l.accountchooser[M].notEmptyFunction=function(b,c){b||l.accountchooser[M].throwError_(Yb,c);l.accountchooser.util.isFunction(b)||l.accountchooser[M].throwError_($b,c)};l.accountchooser[M].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}a(b[s](/\%\%param\%\%/g,c?" '"+c+Ta:W))};Function[P].inheritsFrom=function(b){l.accountchooser[M].notEmptyFunction(b,rd);this.prototype=new b;this[P].constructor=this;this[P].parentClass=b[P]};
l.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;l.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;l.accountchooser.util.isValidEmail=function(b){return b&&j!=l.accountchooser.util.VALID_EMAIL_REGEX_[r](b)};l.accountchooser.util.isValidDomain=function(b){return b&&j!=l.accountchooser.util.VALID_DOMAIN_REGEX_[r](b)};
l.accountchooser.util.getEmailDomain=function(b){if((b=l.accountchooser.util[v](b))&&l.accountchooser.util.isValidEmail(b))return b[E](pb)[1][V]()};l.accountchooser.util.getEmailUsername=function(b){if((b=l.accountchooser.util[v](b))&&l.accountchooser.util.isValidEmail(b))return b[E](pb)[0][V]()};l.accountchooser.util.isDomainInNascar=function(b){if(b){var c=l.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};l.accountchooser.util.USERNAME_REGEX=/^\w+(\.\w+)*$/;
l.accountchooser.util.isValidUsername=function(b){return l.accountchooser.config?l.accountchooser.config.disableUsernameFormatCheck?!!b:l.accountchooser.config.usernameRegex?!!b&&j!=l.accountchooser.config.usernameRegex[r](b):!!b&&j!=l.accountchooser.util.USERNAME_REGEX[r](b):!!b&&j!=l.accountchooser.util.USERNAME_REGEX[r](b)};l.accountchooser.util.DOMAIN_REGEX_=/:\/\/(.[^\/?]+)/;l.accountchooser.util.VALID_URL_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+(\:\d+)?$/i;
l.accountchooser.util.getDomainFromUrl=function(b){try{return b.match(l.accountchooser.util.DOMAIN_REGEX_)[1]}catch(c){}};l.accountchooser.util.isValidUrlDomain=function(b){return b?l.accountchooser.util.VALID_URL_DOMAIN_REGEX_.test(b):k};l.accountchooser.util.MOBILE_REGEX_=/iphone|ipad|ipod|android|blackberry|mini|iemobile|windows\sce|palm/i;l.accountchooser.util.isMobileAgent=function(b){return b&&l.accountchooser.util.MOBILE_REGEX_.test(b[V]())};
l.accountchooser.util.SUPPORTED_LANGUAGE_=[Mc,"en_gb","fr","it","de","es","zh_cn","zh_tw","ja","ko","nl","pl","pt","ru","th","tr","bg","ca","hr","cs","da","fil","fi","el","hi","hu",Y,"lv","lt","no","pt_pt","ro","sr","sk","sl","sv","uk","vi",Ac,ad];
l.accountchooser.util.ALTERNATIVE_CODES_MAP_={en_us:Mc,zh:"zh_cn",zh_hans:"zh_cn",zh_hans_cn:"zh_cn",zh_hant:"zh_tw",zh_hant_tw:"zh_tw",nl_nl:"nl",fr_fr:"fr",de_de:"de",it_it:"it",ja_jp:"ja",ko_kr:"ko",pl_pl:"pl",pt_br:"pt",ru_ru:"ru",es_es:"es",th_th:"th",tr_tr:"tr",bg_bg:"bg",ca_es:"ca",hr_hr:"hr",cs_cz:"cs",da_dk:"da",fil_ph:"fil",tl:"fil",fi_fi:"fi",el_gr:"el",hi_in:"hi",hu_hu:"hu",id_id:Y,lv_lv:"lv",lt_lt:"lt",no_no:"no",nb:"no",nb_no:"no",ro_ro:"ro",sr_cyrl_rs:"sr",sk_sk:"sk",sl_si:"sl",sv_se:"sv",
uk_ua:"uk",vi_vn:"vi"};l.accountchooser.util.findLanguageCode=function(b){b=b&&b[s](/-/g,uc)[V]();for(var c;b;){if(-1<q[ha](b,l.accountchooser.util.SUPPORTED_LANGUAGE_)){c=b;break}else if(l.accountchooser.util.ALTERNATIVE_CODES_MAP_[b]){c=l.accountchooser.util.ALTERNATIVE_CODES_MAP_[b];break}b=b[E](uc);b.pop();b=b.join(uc)}return c};l.accountchooser.util.isRightToLeft=function(b){b=l.accountchooser.util.findLanguageCode(b);return b==Ac||b==ad};
l.accountchooser.util.getNamespacedObjectByString=function(b){for(var c=b[E](bb),d=0,e=c[N],f=l;d<e;++d)f=0==d&&c[0]==Ud?l:f[c[d]],l.accountchooser[M].notNull(f,b);return f};l.accountchooser.util.REGISTRY_KEY_PREFIX_="widget_";l.accountchooser.util.widgets_={};l.accountchooser.util.registerWidget=function(b,c){l.accountchooser.util.widgets_[l.accountchooser.util.REGISTRY_KEY_PREFIX_+b]=c};
l.accountchooser.util.unregisterWidget=function(b){delete l.accountchooser.util.widgets_[l.accountchooser.util.REGISTRY_KEY_PREFIX_+b]};l.accountchooser.util.getWidget_=function(b){var c;if(b){var d=l.accountchooser.util.REGISTRY_KEY_PREFIX_+b;c=l.accountchooser.util.widgets_[d]}else for(d in l.accountchooser.util.widgets_){c=l.accountchooser.util.widgets_[d];break}return c};
l.accountchooser.util.notifyWidget=function(b,c,d){l.accountchooser.util.log(Vd+b+Wa+d+Ta);var e=l.accountchooser.util.getWidget_(d);if(e){var f=q[da]({},c);l[D](function(){e.handleNotification(b,f)},200)}else l.accountchooser.util.log(yb+d+Xa)};l.accountchooser.util.Storage=function(b,c,d){l.accountchooser[M].notEmpty(b||c,qd);l.accountchooser.util.Storage.isDomStorageSupported(d)||l.accountchooser[M].notEmpty(c,pd);this.domStorageKey_=b;this.cookieName_=c;this.perSession_=d};
l.accountchooser.util.Storage.isDomStorageSupported=function(b){try{return b?Gd in l&&l[u]!=j:gd in l&&l[ia]!=j}catch(c){return k}};Z=l.accountchooser.util.Storage[P];Z.read=function(){if(l.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};
Z.write=function(b){l.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};Z.clear=function(){l.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){l.accountchooser[M].notEmpty(this.domStorageKey_,Kc);var b=this.perSession_?l[u]:l[ia];try{var c=b.getItem(this.domStorageKey_);if(c)return n[pa](c)}catch(d){l.accountchooser.util.log(Cb+d)}};Z.writeToDomStorage_=function(b){l.accountchooser[M].notEmpty(this.domStorageKey_,Kc);var c=this.perSession_?l[u]:l[ia];try{var d=n[K](b);c.setItem(this.domStorageKey_,d)}catch(e){l.accountchooser.util.log(Eb+e)}};
Z.clearFromDomStorage_=function(){l.accountchooser[M].notEmpty(this.domStorageKey_,Kc);var b=this.perSession_?l[u]:l[ia];try{b[ja](this.domStorageKey_)}catch(c){l.accountchooser.util.log(vb+c)}};Z.readFromCookie_=function(){l.accountchooser[M].notEmpty(this.cookieName_,Ic);var b=m.cookie.match(Za+this.cookieName_+mb);if(b&&(b=l.accountchooser.util[v](b[2])))try{return n[pa](unescape(b))}catch(c){l.accountchooser.util.log(Db+c)}};
Z.writeToCookie_=function(b){l.accountchooser[M].notEmpty(this.cookieName_,Ic);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),i=new Date(d,e,f),p=this.perSession_?0:i.toGMTString();m.cookie=this.cookieName_+lb+escape(n[K](b))+hb+p+ib}catch(Q){l.accountchooser.util.log(Fb+Q)}};
Z.clearFromCookie_=function(){l.accountchooser[M].notEmpty(this.cookieName_,Ic);try{var b=new Date;b.setTime(b[y]()-1);m.cookie=this.cookieName_+nb+b.toGMTString()+ib}catch(c){l.accountchooser.util.log(wb+c)}};l.accountchooser.util.accountstorage={};l.accountchooser.util.accountstorage.ACCOUNTS_=Fc;l.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";l.accountchooser.util.accountstorage.storage_=new l.accountchooser.util.Storage(l.accountchooser.util.accountstorage.ACCOUNTS_,l.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
l.accountchooser.util.accountstorage.read_=function(){var b=l.accountchooser.util.accountstorage.storage_.read();l.accountchooser.util.log(bc+n[K](b));return b};l.accountchooser.util.accountstorage.write_=function(b){l.accountchooser.util.log(ec+n[K](b));l.accountchooser.util.accountstorage.storage_.write(b)};l.accountchooser.util.accountstorage.readAccounts=function(){var b=l.accountchooser.util.accountstorage.read_();if(!b||!l.accountchooser.util[H](b))b=[];return b};
l.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return k;for(var c=k,d=l.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[N];f++)if(l.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=h;break}e&&(!b[ka]&&e[ka]&&(b.displayName=e[ka]),!b.photoUrl&&e.photoUrl&&(b.photoUrl=e.photoUrl));d.unshift(b);l.accountchooser.util.accountstorage.write_(d);return!c};
l.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return k;for(var c=k,d=l.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(l.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=h;break}l.accountchooser.util.accountstorage.write_(d);return c};l.accountchooser.util.accountstorage.clearAccounts=function(){l.accountchooser.util.accountstorage.storage_.clear()};
l.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=l.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[N];f++)if(l.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);l.accountchooser.util.accountstorage.write_(e);break}};
l.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&l.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[ka]&&(c.displayName=b[ka]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=g&&(c.legacy=b.legacy)},b.providerId)};
l.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=l.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(l.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);l.accountchooser.util.accountstorage.write_(d);return f}};l.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?k:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?h:k};l.accountchooser.updateSavedAccount=function(b){l.accountchooser.util.accountstorage.addAccount(b)};
l.accountchooser.removeSavedAccount=function(b){return l.accountchooser.util.accountstorage.removeAccount(b)};l.accountchooser.clearSavedAccounts=function(){l.accountchooser.util.accountstorage.clearAccounts()};l.accountchooser.util.accountstorage.ACCOUNTS_=Fc;l.accountchooser.util.accountstorage.storage_=new l.accountchooser.util.Storage(l.accountchooser.util.accountstorage.ACCOUNTS_);l.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
l.accountchooser.util.accountstorage.readAccounts=function(b){var c=l.accountchooser.util.accountstorage.read_();if(!c||!l.accountchooser.util[H](c))c=[];if(!b)return c;var d=[];if(b.withEmail){var e=function(b){return l.accountchooser.util.isValidEmail(b.email)};d[I](e)}b.idpList&&0!=b.idpList[N]&&(e=function(c){return 0<=l.accountchooser.util[L](c.providerId||l.accountchooser.util.accountstorage.NO_IDP_,b.idpList)},d[I](e));b.emailDomainList&&0!=b.emailDomainList[N]&&(e=function(c){return(c=l.accountchooser.util.getEmailDomain(c.email))?
0<=l.accountchooser.util[L](c,b.emailDomainList):h},d[I](e));for(e=0;e<d[N];e++)c=l.accountchooser.util.accountstorage.filter_(c,d[e]);return c};l.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[N];e++)c(b[e])&&d[I](b[e]);return d};l.accountchooser.util.browserconfig={};l.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";l.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
l.accountchooser.util.browserconfig.storage_=new l.accountchooser.util.Storage(l.accountchooser.util.browserconfig.SETTINGS_KEY_,l.accountchooser.util.browserconfig.COOKIE_NAME_);l.accountchooser.util.browserconfig.getAll=function(){var b=l.accountchooser.util.browserconfig.storage_.read()||{};l.accountchooser.util.log(Hb+n[K](b));return b};l.accountchooser.util.browserconfig.setAll=function(b){l.accountchooser.util.log(gc+n[K](b));l.accountchooser.util.browserconfig.storage_.write(b)};
l.accountchooser.util.browserconfig.clearAll=function(){l.accountchooser.util.log(tb);l.accountchooser.util.browserconfig.storage_.clear()};l.accountchooser.util.browserconfig.get=function(b){return l.accountchooser.util.browserconfig.getAll()[b]};l.accountchooser.util.browserconfig.set=function(b,c){var d=l.accountchooser.util.browserconfig.getAll();d[b]=c;l.accountchooser.util.browserconfig.setAll(d)};
l.accountchooser.util.browserconfig.clear=function(b){var c=l.accountchooser.util.browserconfig.getAll();delete c[b];l.accountchooser.util.browserconfig.setAll(c)};l.accountchooser.util.browserconfig.isDisabled=function(){return!!l.accountchooser.util.browserconfig.get(Jc)};l.accountchooser.util.browserconfig.setDisabled=function(b){l.accountchooser.util.browserconfig.set(Jc,!!b)};l.accountchooser.loader=l.accountchooser.loader||{};l.accountchooser.loader.Loader=function(){};
l.accountchooser.loader.Loader[P].load=function(b,c,d,e){var f=this;this.load_(b,d,function(){c?f.load_(c,d,e):e&&e()})};
l.accountchooser.loader.Loader[P].load_=function(b,c,d){var e=m[fa](Pc)[0]||m[z],f=this.createResourceElement(b);this.finished_=k;var i=this;f.onload=f.onreadystatechange=function(){if(!i.finished_&&(!this.readyState||this.readyState===fd||this.readyState===Hc))i.finished_=h,f.onload=f.onreadystatechange=j,c&&c()};f.onerror=function(){i.finished_=h;e[ra](f);d&&d()};e.insertBefore(f,e.firstChild)};l.accountchooser.loader.Loader[P].createResourceElement=function(){a("Unimplemented! Child object must provide an implementation.")};
l.accountchooser.loader.JsLoader=function(){};l.accountchooser.loader.JsLoader.inheritsFrom(l.accountchooser.loader.Loader);l.accountchooser.loader.JsLoader[P].createResourceElement=function(b){var c=m[w](Bd);c[x](Rd,Od);c[x](Id,b);return c};l.accountchooser.loader.CssLoader=function(){};l.accountchooser.loader.CssLoader.inheritsFrom(l.accountchooser.loader.Loader);
l.accountchooser.loader.CssLoader[P].createResourceElement=function(b){var c=m[w](ed);c[x](Rd,Md);c[x](vd,Kd);c[x](Sc,b);var d=m[w](Zc);d[x](Id,b);var e=this;d.onerror=function(){if(!e.finished_)c.onload()};return c};l.accountchooser.util.Semaphore=function(b,c){l.accountchooser[M].notEmptyFunction(b,Oc);0>c&&a("Semaphore value cannot be negative.");this.handler_=b;this.value_=c||0;this.started_=k};Z=l.accountchooser.util.Semaphore[P];Z.getValue=function(){return this.value_};
Z.increase=function(){this.started_&&a("Cannot increase Semaphore value after calling start().");this.value_++};Z.start=function(){0>=this.value_&&a("Semaphore value must bigger than 0.");this.started_=h};Z.isStarted=function(){return this.started_};Z.decrease=function(){this.started_||a("Cannot decrease Semaphore value before calling start().");0<this.value_&&(this.value_--,l.accountchooser.util.log(Cd+this.value_),0==this.value_&&this.handler_())};l.accountchooser.caja=l.accountchooser.caja||{};
l.accountchooser.caja.loadHtml=function(b,c,d,e){q.ajax({type:Gb,url:b,dataType:Tc,success:d,timeout:c,error:function(b,c,d){e&&e(c,d)}})};l.accountchooser.caja.loadJs_=function(b,c,d){(new l.accountchooser.loader.JsLoader)[na](b,g,c,d)};l.accountchooser.caja.loadedUrls_={};l.accountchooser.caja.loadedCallback_=function(b){if(b&&(b=l.accountchooser.caja.loadedUrls_[b])){b.loaded=h;for(var c=0;c<b.callbacks[N];c++){var d=b.callbacks[c];d&&d()}b.callbacks=[];b.error=k;b.errorCallbacks=[]}};
l.accountchooser.caja.errorCallback_=function(b,c,d){if(b&&(b=l.accountchooser.caja.loadedUrls_[b])){b.loaded=h;b.error=h;for(var e=0;e<b.errorCallbacks[N];e++){var f=b.errorCallbacks[e];f&&f(c,d)}b.errorCallbacks=[];b.callbacks=[]}};
l.accountchooser.caja.loadJs=function(b,c,d){l.accountchooser[M].notEmpty(b,bd);var e=l.accountchooser.caja.loadedUrls_[b];e?e.loaded?e.error?d&&d():c():(e.callbacks[I](c),d&&e.errorCallbacks[I](d)):(l.accountchooser.caja.loadedUrls_[b]={loaded:k,callbacks:[c]},l.accountchooser.caja.loadJs_(b,function(){l.accountchooser.caja.loadedCallback_(b)},function(){l.accountchooser.caja.errorCallback_(b)}))};l.accountchooser.caja=l.accountchooser.caja||{};l.accountchooser.caja.cajaUrl="https://ssl.gstatic.com/caja/4891/caja.js";
l.accountchooser.caja.htmlSanitizerUrl="https://ssl.gstatic.com/caja/4891/html-css-sanitizer-minified.js";l.accountchooser.caja.CAJA_TIMEOUT=5E3;l.accountchooser.caja.WHITELIST_IDS=["AC_LANGUAGE_LIST"];l.accountchooser.caja=l.accountchooser.caja||{};
l.accountchooser.caja.sanitizeHtml=function(b,c,d){function e(b){0>p-(new Date)[y]()?d&&d(Pd):(b=html_sanitize(b,i,f),c(b))}function f(b){if(0<=q[ha](b,l.accountchooser.caja.WHITELIST_IDS))return b}function i(b){return b}var p=(new Date)[y]()+l.accountchooser.caja.CAJA_TIMEOUT;l.accountchooser.caja.loadJs(l.accountchooser.caja.htmlSanitizerUrl,function(){var c=p-(new Date)[y]();50>c?d&&d(Pd):l.accountchooser.caja.loadHtml(b,c,e,d)})};
l.accountchooser.caja.cajoleHtml=function(b,c,d,e){function f(){if(Q)l.accountchooser.util.log(jc);else{var b=Xd-(new Date)[y]();50>b?l.accountchooser.util.log(jc):l.accountchooser.caja.loadHtml(c,b,function(b){l[D](function(){Q?l.accountchooser.util.log(kc):b?(l.accountchooser.caja.cajaInitialized||(l.accountchooser.caja.cajaInitialized=h,caja.initialize({cajaServer:Vc,forceES5Mode:h})),l[D](function(){Q?l.accountchooser.util.log(ic):caja[na](p,i,function(c){c.code(g,Nd,b).run(function(){Q||l.clearTimeout(Yd);
qb=h;d&&d();l.accountchooser.util.log(Ib)})})},10)):l.accountchooser.util.log(Wb)},10)})}}var i={rewrite:function(b){return b}},p=m.getElementById(b),Q=k,qb=k,Yd=l[D](function(){l.accountchooser.util.log(rb);Q=h;!qb&&e&&e()},l.accountchooser.caja.CAJA_TIMEOUT),Xd=(new Date)[y]()+l.accountchooser.caja.CAJA_TIMEOUT;l.accountchooser.caja.loadJs(l.accountchooser.caja.cajaUrl,function(){l[D](f,10)})};l.accountchooser.rpc=l.accountchooser.rpc||{};l.accountchooser.rpc.RpcObject=function(){};
l.accountchooser.rpc.RpcObject[P].setTimestamp=function(b){this.timestamp_=b||(new Date)[y]()};ba(l.accountchooser.rpc.RpcObject[P],function(){var b={jsonrpc:fb};this.timestamp_!=j&&(b.timestamp=this.timestamp_);return b});l.accountchooser.rpc.RpcObject[P].toString=function(){return n[K](this[ga]())};l.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};l.accountchooser.rpc.AbstractRequest.inheritsFrom(l.accountchooser.rpc.RpcObject);Z=l.accountchooser.rpc.AbstractRequest[P];
Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};ba(Z,function(){var b=l.accountchooser.rpc.RpcObject[P][ga][U](this);this.method_!=j&&(b.method=this.method_);this.params_!=j&&(b.params=this.params_);return b});l.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};l.accountchooser.rpc.Notification.inheritsFrom(l.accountchooser.rpc.AbstractRequest);
l.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};l.accountchooser.rpc[J].inheritsFrom(l.accountchooser.rpc.AbstractRequest);l.accountchooser.rpc[J][P].setId=function(b){this.id_=b};l.accountchooser.rpc[J][P].getId=function(){return this.id_};ba(l.accountchooser.rpc[J][P],function(){var b=l.accountchooser.rpc.AbstractRequest[P][ga][U](this);this.id_!=j&&(b.id=this.id_);return b});
l.accountchooser.rpc.Response=function(b,c,d){l.accountchooser[M].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};l.accountchooser.rpc.Response.inheritsFrom(l.accountchooser.rpc.RpcObject);Z=l.accountchooser.rpc.Response[P];Z.getResult=function(){return this.result_};Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};
ba(Z,function(){var b=l.accountchooser.rpc.RpcObject[P][ga][U](this);b.id=this.id_;this.result_!=j?b.result=this.result_:this.error_!=j&&(b.error=this.error_);return b});l.accountchooser.rpc.RequestAckNotification=function(b){l.accountchooser[M].notEmpty(b,xd);this.method_=l.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};l.accountchooser.rpc.RequestAckNotification.inheritsFrom(l.accountchooser.rpc.Notification);l.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
l.accountchooser.rpc.RequestAckNotification[P].setRequestId=function(b){this.params_.requestId=b};l.accountchooser.rpc.RequestAckNotification[P].getRequestId=function(){return this.params_.requestId};l.accountchooser.rpc.CdsReadyNotification=function(){this.method_=l.accountchooser.rpc.CdsReadyNotification.METHOD};l.accountchooser.rpc.CdsReadyNotification.inheritsFrom(l.accountchooser.rpc.Notification);l.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
l.accountchooser.rpc.ClientReadyNotification=function(){this.method_=l.accountchooser.rpc.ClientReadyNotification.METHOD};l.accountchooser.rpc.ClientReadyNotification.inheritsFrom(l.accountchooser.rpc.Notification);l.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";l.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=l.accountchooser.rpc.EmptyResponseNotification.METHOD};l.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(l.accountchooser.rpc.Notification);
l.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";l.accountchooser.rpc.StoreRequest=function(b,c,d){l.accountchooser[M].notEmpty(b,Y);l.accountchooser[M].notEmptyArray(c,zc);c&&(c=l.accountchooser.util.sanitizeAccounts(c));this.method_=l.accountchooser.rpc.StoreRequest.METHOD;this.params_={accounts:c,clientConfig:d};this.id_=b};l.accountchooser.rpc.StoreRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.StoreRequest.METHOD="store";
l.accountchooser.rpc.SelectRequest=function(b,c,d){l.accountchooser[M].notEmpty(b,Y);c&&(c=l.accountchooser.util.sanitizeAccounts(c));this.method_=l.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};l.accountchooser.rpc.SelectRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.SelectRequest.METHOD="select";
l.accountchooser.rpc.UpdateRequest=function(b,c,d){l.accountchooser[M].notEmpty(b,Y);l.accountchooser[M].notEmpty(c,yc);c&&(c=l.accountchooser.util.sanitizeAccount(c));this.method_=l.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};l.accountchooser.rpc.UpdateRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.UpdateRequest.METHOD="update";
l.accountchooser.rpc.ManageRequest=function(b,c){l.accountchooser[M].notEmpty(b,Y);this.method_=l.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};l.accountchooser.rpc.ManageRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.ManageRequest.METHOD=id;l.accountchooser.rpc.AboutRequest=function(b,c){l.accountchooser[M].notEmpty(b,Y);this.method_=l.accountchooser.rpc.AboutRequest.METHOD;this.params_={clientConfig:c};this.id_=b};l.accountchooser.rpc.AboutRequest.inheritsFrom(l.accountchooser.rpc[J]);
l.accountchooser.rpc.AboutRequest.METHOD=vc;l.accountchooser.rpc.QueryRequest=function(b,c,d,e){l.accountchooser[M].notEmpty(b,Y);l.accountchooser[M].notEmpty(c,ud);d&&(d=l.accountchooser.util.sanitizeAccount(d));this.method_=l.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};l.accountchooser.rpc.QueryRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.QueryRequest.METHOD=ud;
l.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};l.accountchooser.rpc.IdpReadyNotification=function(){this.method_=l.accountchooser.rpc.IdpReadyNotification.METHOD};l.accountchooser.rpc.IdpReadyNotification.inheritsFrom(l.accountchooser.rpc.Notification);l.accountchooser.rpc.IdpReadyNotification.METHOD="idpReadyNotification";
l.accountchooser.rpc.IdpAuthRequest=function(b,c){l.accountchooser[M].notEmpty(b,yc);this.method_=l.accountchooser.rpc.IdpAuthRequest.METHOD;this.params_={account:b,clientConfig:c};this.id_=l.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID+gb+b.email};l.accountchooser.rpc.IdpAuthRequest.inheritsFrom(l.accountchooser.rpc[J]);l.accountchooser.rpc.IdpAuthRequest.METHOD="idpAuth";l.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID="idpAuth";
l.accountchooser.rpc.parseRpcObject=function(b){var c=j;if(b){try{var d=n[pa](b)}catch(e){return l.accountchooser.util.log(Qb),c}if(!d||d.jsonrpc!=fb)l.accountchooser.util.log(Rb);else if(d.method){var f=d.method[V]();f==l.accountchooser.rpc.StoreRequest.METHOD[V]()?d.id&&(d.params&&d.params.accounts)&&(c=new l.accountchooser.rpc.StoreRequest(d.id,d.params.accounts,d.params.clientConfig)):f==l.accountchooser.rpc.SelectRequest.METHOD[V]()?d.id&&(c=new l.accountchooser.rpc.SelectRequest(d.id,d.params.localAccounts,
d.params.clientConfig)):f==l.accountchooser.rpc.UpdateRequest.METHOD[V]()?d.id&&(d.params&&d.params.account)&&(c=new l.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==l.accountchooser.rpc.ManageRequest.METHOD[V]()?d.id&&(c=new l.accountchooser.rpc.ManageRequest(d.id,d.params.clientConfig)):f==l.accountchooser.rpc.AboutRequest.METHOD[V]()?d.id&&(c=new l.accountchooser.rpc.AboutRequest(d.id,d.params.clientConfig)):f==l.accountchooser.rpc.IdpReadyNotification.METHOD[V]()&&
(c=new l.accountchooser.rpc.IdpReadyNotification)}else typeof d.id===Jd&&0<=d.id[L](l.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID)&&(c=new l.accountchooser.rpc.Response(d.id,d.result,d.error))}c?l.accountchooser.util.log(hc+b):l.accountchooser.util.log(Bb+b);return c};l.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";l.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";l.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";
l.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";l.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;l.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;l.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";l.accountchooser.rpc.IDP_TIMEOUT=3E3;l.accountchooser.rpc.RPC_TIMEOUT=3E5;l.accountchooser.rpc.services_={};l.accountchooser.rpc.register=function(b,c){l.accountchooser[M].notEmpty(b,Fd);l.accountchooser[M].notNull(c,Oc);l.accountchooser.rpc.services_[b]=c};
l.accountchooser.rpc.call=function(b,c,d){l.accountchooser[M].notEmpty(b,Ld);c=c[A]();l.accountchooser.util.log(fc+c);b[la](c,d||$a)};l.accountchooser.rpc.init_=function(b){l.addEventListener?l.addEventListener(jd,b,k):l[ea]?l[ea](od,b):l[S][ea]?l[S][ea](od,b):l.accountchooser.util.log(dc)};l.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";l.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
l.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?l.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:l.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[s](/^https?:\/\//,W);var e=[],f=l[u].getItem(d);if(f){l[u][ja](d);var i=l.JSON[pa](f)||[],f=(new Date)[y]();if(i[N]){i=i[i[N]-1];try{var p=n[pa](i);p&&p.timestamp&&f-p.timestamp<l.accountchooser.rpc.RPC_TIMEOUT?(e[I](i),c&&l[u].setItem(d,l.JSON[K](e))):l.accountchooser.util.log(Jb+i+tc)}catch(Q){l.accountchooser.util.log(Kb+i+tc)}}}return e};
l.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[s](/^https?:\/\//,W);l[u][ja](l.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);l[u][ja](l.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?l.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:l.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[I](c[A]());c=l.JSON[K](b);l[u].setItem(d,c)};l.accountchooser.rpc.idps={};l.accountchooser.rpc.idpsIndexedByDomain={};l.accountchooser.rpc.emailMapIdp={};
l.accountchooser.rpc.timer_={running:k,id:0,callback:j};l.accountchooser.rpc.clearTimeoutCallback_=function(){if(l.accountchooser.rpc.timer_.running){try{l.clearTimeout(l.accountchooser.rpc.timer_.id)}catch(b){}l.accountchooser.rpc.timer_.running=k;l.accountchooser.rpc.timer_.id=0;l.accountchooser.rpc.timer_.callback=j}};
l.accountchooser.rpc.setTimeoutCallback_=function(b){l.accountchooser[M].notEmptyFunction(b,Qd);l.accountchooser.rpc.clearTimeoutCallback_();l.accountchooser.rpc.timer_.callback=b;l.accountchooser.rpc.timer_.id=l[D](function(){l.accountchooser.rpc.timer_.callback&&l.accountchooser.rpc.timer_.callback[U](l);l.accountchooser.rpc.timer_.running=k;l.accountchooser.rpc.timer_.id=0;l.accountchooser.rpc.timer_.callback=j},l.accountchooser.rpc.IDP_TIMEOUT);l.accountchooser.rpc.timer_.running=h};
l.accountchooser.rpc.initIdpIFrame_=function(b){!b||!l.accountchooser.rpc.idps[b]?l.accountchooser.util.log(oc+b+Xa):l.accountchooser.rpc.idps[b].iframeUrl?l.accountchooser.rpc.initIdpIFrameByConfig_(l.accountchooser.rpc.idps[b]):l.accountchooser.util.log(Ab+b+Ya)};l.accountchooser.rpc.initIdpIFrameByConfig_=function(b){if(b&&!b.iframe){var c=q(kb).css(sd,wc).css(Td,eb).css(Qc,eb).css(dd,ab).appendTo(Bc);b.iframe=c;c.attr(Id,b.iframeUrl)}};
l.accountchooser.rpc.onIdpReady_=function(b){if(!b||!l.accountchooser.rpc.idpsIndexedByDomain[b])l.accountchooser.util.log(pc+b+Xa);else{var c=l.accountchooser.rpc.idpsIndexedByDomain[b];if(c.iframe){b=c.iframe[0].contentWindow;if(c[C]&&c[C][N]){for(var d=0;d<c[C][N];d++)l.accountchooser.rpc[U](b,c[C][d]);c.queue=[]}c.idpReady=h}else l.accountchooser.util.log(Pb+b+Va)}};
l.accountchooser.rpc.callIdp=function(b,c,d,e){b&&l.accountchooser.rpc.idps[b]&&l.accountchooser.rpc.callIdpByConfig(l.accountchooser.rpc.idps[b],c,d,e)};l.accountchooser.rpc.callIdpByDomain=function(b,c,d,e){b&&l.accountchooser.rpc.idpsIndexedByDomain[b]&&l.accountchooser.rpc.callIdpByConfig(l.accountchooser.rpc.idpsIndexedByDomain[b],c,d,e)};
l.accountchooser.rpc.callIdpByConfig=function(b,c,d,e){l.accountchooser[M].notEmpty(b,Wc);l.accountchooser[M].notEmpty(c,wd);l.accountchooser[M].notEmptyFunction(d,Dc);l.accountchooser[M].notEmptyFunction(e,Pd);l.accountchooser.rpc.setTimeoutCallback_(e);l.accountchooser.rpc.addIdpCallback_(b,c,d);if(b.idpReady)l.accountchooser.rpc[U](b.iframe[0].contentWindow,c);else b[C]||(b.queue=[]),b[C][I](c),b.iframe||l.accountchooser.rpc.initIdpIFrameByConfig_(b)};
l.accountchooser.rpc.callIdpByConfig.callbacks_={};l.accountchooser.rpc.addIdpCallback_=function(b,c,d){l.accountchooser.rpc.callIdpByConfig.callbacks_[b.domain+gb+c.id_]={callback:d,idpConfig:b}};l.accountchooser.rpc.getIdpCallback_=function(b,c){var d=b+gb+c.id_,e=l.accountchooser.rpc.callIdpByConfig.callbacks_[d];if(e)return delete l.accountchooser.rpc.callIdpByConfig.callbacks_[d],e.callback};
l.accountchooser.rpc.isSupportedIdp=function(b){if(b&&(b=b.providerId||l.accountchooser.util.getEmailDomain(b.email)))if((b=l.accountchooser.rpc.emailMapIdp[b])&&l.accountchooser.rpc.idps[b])return b;return k};l.accountchooser.rpc.EMPTY_SAVED_RPC="EMPTY_SAVED_RPC";l.accountchooser.rpc.INVALID_CLIENT_DOMAIN="INVALID_CLIENT_DOMAIN";l.accountchooser.rpc.popupMode=k;l.accountchooser.rpc.clientWindow=j;
l.accountchooser.rpc.getDomainInHash_=function(){if(l[F].hash){var b=l[F].hash;b&&b[0]==Ba&&(b=b.substring(1));return b}};l.accountchooser.rpc.triggerSavedRpcs_=function(){if(!l.accountchooser.rpc.popupMode){var b=l.accountchooser.rpc.readSavedRpcObjects(l.accountchooser.rpc.clientDomain_,h);if(b&&b[N])for(var c=0;c<b[N];c++)l.accountchooser.rpc.process_({data:b[c],origin:l.accountchooser.rpc.clientDomain_},h);else a(l.accountchooser.rpc.EMPTY_SAVED_RPC)}};
l.accountchooser.rpc.sendCdsReadyNotification_=function(){if(l.accountchooser.rpc.popupMode){var b=new l.accountchooser.rpc.CdsReadyNotification;l.accountchooser.rpc.clientWindow[la](b[A](),$a)}};
l.accountchooser.rpc.process_=function(b,c){l.accountchooser.util.log(cc+b[t]+ua+b[ca]);var d=b[ca][s](/^https?:\/\//,W),e=l.accountchooser.rpc.parseRpcObject(b[t]);if(e)if(e instanceof l.accountchooser.rpc.ManageRequest&&!c)l.accountchooser.util.log(Ob+b[t]);else if(e instanceof l.accountchooser.rpc.IdpReadyNotification)l.accountchooser.rpc.onIdpReady_(d);else if(e instanceof l.accountchooser.rpc.Response)l.accountchooser.rpc.clearTimeoutCallback_(),(d=l.accountchooser.rpc.getIdpCallback_(d,e))?
d[U](l,e,b[ca],d.context):l.accountchooser.util.log(xb+b[t]);else if(e instanceof l.accountchooser.rpc[J]){if(l.accountchooser.rpc.checkCallbackDomain_(e,d))if(d=l.accountchooser.rpc.services_.serviceLoader){if(e instanceof l.accountchooser.rpc[J]&&!c){var f=new l.accountchooser.rpc.RequestAckNotification(e.id_);l.parent[la](f[A](),b[ca])}d(e,b[ca])}else l.accountchooser.util.log(Vb+e.method_+Ua)}else l.accountchooser.util.log(nc+b[t]);else l.accountchooser.util.log(ub+b[t])};
l.accountchooser.rpc.checkCallbackDomain_=function(b,c){var d=b.params_.clientConfig.clientCallbackUrl&&l.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.clientCallbackUrl);return d&&d!==c?(l.accountchooser.util.log(Lb+b.params_.clientConfig.clientCallbackUrl+wa+c+xa),k):(d=b.params_.clientConfig.positiveCallbackUrl&&l.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.positiveCallbackUrl))&&d!==c?(l.accountchooser.util.log(Nb+b.params_.clientConfig.positiveCallbackUrl+wa+c+xa),
k):(d=b.params_.clientConfig.negativeCallbackUrl&&l.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.negativeCallbackUrl))&&d!==c?(l.accountchooser.util.log(Mb+b.params_.clientConfig.negativeCallbackUrl+wa+c+xa),k):h};
l.accountchooser.rpc.initIdp_=function(b,c){var d=[];if(b)for(var e in b){l.accountchooser[M].notEmpty(b[e].iframeUrl,Xc);var f=b[e].iframeUrl,i=l.accountchooser.util.getDomainFromUrl(f);l.accountchooser[M].notEmpty(i,Lc);f={id:e,domain:i,iframe:j,iframeUrl:f,queue:[],idpReady:k};l.accountchooser.rpc.idps[e]=f;l.accountchooser.rpc.idpsIndexedByDomain[i]=f;b[e].preload&&d[I](e)}if(c)for(var p in c)(e=c[p])?l.accountchooser.rpc.idps[e]?l.accountchooser.rpc.emailMapIdp[p]=e:l.accountchooser.util.log(Sb+
p+za):l.accountchooser.util.log(Tb+p+Aa);return d};
l.accountchooser.rpc.initCds=function(b){var c;if(b){if(b.rpcs)for(var d in b.rpcs)l.accountchooser.rpc.register(d,b.rpcs[d]);c=l.accountchooser.rpc.initIdp_(b.idps,b.emailMapIdp)}b&&b.popupMode?(l.accountchooser.rpc.popupMode=h,l.accountchooser.rpc.clientWindow=l.opener):(l.accountchooser.rpc.popupMode=k,d=l.accountchooser.rpc.getDomainInHash_(),d||(l.accountchooser.util.log(zb),a(l.accountchooser.rpc.INVALID_CLIENT_DOMAIN)),l.accountchooser.rpc.clientDomain_=d);l.accountchooser.rpc.init_(l.accountchooser.rpc.process_);
l.accountchooser.rpc.popupMode&&l.accountchooser.rpc.sendCdsReadyNotification_();if(c&&c[N])for(d=0;d<c[N];d++)l.accountchooser.rpc.initIdpIFrame_(c[d]);b&&!b.popupMode&&l.accountchooser.rpc.triggerSavedRpcs_()};
l.accountchooser.rpc.callClient=function(b){l.accountchooser[M].notEmpty(b,yd);l.accountchooser.util.log(fc+b[A]());l.accountchooser.rpc.popupMode?l.accountchooser.rpc.clientWindow[la](b[A](),$a):l.accountchooser.rpc.clientDomain_?l.accountchooser.rpc.saveRpcObject(l.accountchooser.rpc.clientDomain_,b,k):l.accountchooser.util.log(sb)};l.accountchooser.UiLoader=function(){};Z=l.accountchooser.UiLoader[P];Z.findServiceByLanguage_=function(b,c,d){return!b?j:d&&b[d]&&b[d][c]?b[d][c]:b[c]};
Z.findService_=function(b,c,d,e){var f=j;c&&(b=b.method_,d&&c.mobile&&(f=this.findServiceByLanguage_(c.mobile,b,e)),f||(f=this.findServiceByLanguage_(c.web,b,e)));return f};Z.loadServiceFromWeb=function(){a(mc)};Z.isServiceLoaded=function(){return k};Z.setServiceLoaded=function(){};
Z.loadService=function(b,c,d){var e=l.accountchooser.util.isMobileAgent(aa.userAgent),f=b&&b.params_&&b.params_.clientConfig&&b.params_.clientConfig[O];b=this.findService_(b,c,e,f);l.accountchooser[M].notEmpty(b,Dd);l.accountchooser[M].notEmpty(b[oa],Ed);var i=q[da]({},b,{mobile:!!e,language:f});if(this.isServiceLoaded(i))e=l.accountchooser.util.getNamespacedObjectByString(i[oa]),l.accountchooser[M].notEmpty(e,i[oa]),d(e);else{var p=this;this.loadServiceFromWeb(i,function(){p.setServiceLoaded(i);
var b=l.accountchooser.util.getNamespacedObjectByString(i[oa]);l.accountchooser[M].notEmpty(b,i[oa]);d(b)})}};l.accountchooser.UrlUiLoader=function(){};l.accountchooser.UrlUiLoader.inheritsFrom(l.accountchooser.UiLoader);Z=l.accountchooser.UrlUiLoader[P];Z.getJsFileUrl=function(){a(mc)};Z.getCssFileUrl=function(){a(lc)};Z.isFileLoaded=function(){a(lc)};Z.removeOldCss=function(){a(lc)};Z.removeOldJs=function(){a(lc)};
Z.loadServiceFromWeb=function(b,c){function d(){var d=e.getJsFileUrl(b);e.isFileLoaded(d)?c():(new l.accountchooser.loader.JsLoader)[na](d,j,function(){e.removeOldJs();c()})}var e=this,f=this.getCssFileUrl(b);this.isFileLoaded(f)?d():(new l.accountchooser.loader.CssLoader)[na](f,j,function(){e.removeOldCss();d()})};
l.accountchooser.UrlTemplateUiLoader=function(b,c,d){this.jsUrlTemplate_=b;this.cssUrlTemplate_=c;this.defaultLanguage_=l.accountchooser.util.findLanguageCode(d)||Mc;this.cssUrl_=this.jsUrl_=j};l.accountchooser.UrlTemplateUiLoader.inheritsFrom(l.accountchooser.UrlUiLoader);Z=l.accountchooser.UrlTemplateUiLoader[P];Z.getJsFileUrl=function(b){var c=this.getLanguage_(b[O]);return this.jsUrlTemplate_[s](/\{baseFilename\}/,b.baseFilename)[s](/\{language\}/,c)};
Z.getCssFileUrl=function(b){return this.cssUrlTemplate_[s](/\{baseFilename\}/,b.cssBaseFilename)};Z.isFileLoaded=function(b){return!!this.findTag_(b)};Z.isServiceLoaded=function(b){return this.isFileLoaded(this.getJsFileUrl(b))&&this.isFileLoaded(this.getCssFileUrl(b))};Z.setServiceLoaded=function(b){this.jsUrl_=this.getJsFileUrl(b);this.cssUrl_=this.getCssFileUrl(b)};
Z.loadServiceFromWeb=function(b,c){var d=this;l.accountchooser.UrlUiLoader[P].loadServiceFromWeb[U](d,b,function(){c();var e=m[fa](Bc)[0]||m[T],f=e.getAttribute(Gc)||W;d.isRightToLeft_(b)?(e.dir=zd,f+=va):(e.dir=hd,f=f[s](/rtl/g,W));e[x](Gc,f)})};Z.removeOldTag_=function(b){(b=this.findTag_(b))&&b.parentNode[ra](b)};Z.removeOldCss=function(){this.removeOldTag_(this.cssUrl_)};Z.removeOldJs=function(){this.removeOldTag_(this.jsUrl_)};
Z.findTag_=function(b){if(b)for(var c=(m[fa](Pc)[0]||m[z]).childNodes,d=0,e=c[N];d<e;d++){var f=c.item(d),i=f.nodeName[V]();if(i==Bd&&f.getAttribute(Id)==b||i==ed&&f.getAttribute(Sc)==b)return f}};Z.getLanguage_=function(b){b=b||l.navigator[O];return b=l.accountchooser.util.findLanguageCode(b)||this.defaultLanguage_};Z.isRightToLeft_=function(b){b=this.getLanguage_(b[O]);return l.accountchooser.util.isRightToLeft(b)};l.accountchooser.AjaxUiLoader=function(){this.loadedPackages_=[]};l.accountchooser.AjaxUiLoader.inheritsFrom(l.accountchooser.UiLoader);
l.accountchooser.AjaxUiLoader[P].stringify=function(b){return b.module+gb+b.version+gb+b.packageName+gb+b[O]};l.accountchooser.AjaxUiLoader[P].loadServiceFromWeb=function(b,c){google[na](b.module,b.version,{packages:[b.packageName],language:b[O]||l.navigator[O],callback:c})};l.accountchooser.AjaxUiLoader[P].isServiceLoaded=function(b){b=this[K](b);return-1<q[ha](b,this.loadedPackages_)};l.accountchooser.AjaxUiLoader[P].setServiceLoaded=function(b){b=this[K](b);0>q[ha](b,this.loadedPackages_)&&this.loadedPackages_[I](b)};
l.accountchooser.UiHandler=function(){};l.accountchooser.UiHandler.VALID_URL_REGEX_=/^http(s)?:\/\/(localhost|([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+)(\:\d+)?(\/([^?#]*))?(\?([^#]*))?$/i;Z=l.accountchooser.UiHandler[P];
Z.show=function(b){this.setUp_(b);this.showTitle_();this.showFavIcon_();switch(this.serviceType_){case l.accountchooser.ServiceType.MANAGE:this.showManageContent_();break;case l.accountchooser.ServiceType.SELECT:this.showSelectContent_();break;case l.accountchooser.ServiceType.STORE:this.showStoreContent_();break;case l.accountchooser.ServiceType.UPDATE:this.showUpdateContent_();break;case l.accountchooser.ServiceType.ABOUT:this.showAboutContent_()}this.showFooterContent_();this.initLanguageSelector_();
q(Bc).hide()[ma]()};Z.setUp_=function(b){b=b||{};this.title_=b.title;this.favicon_=b.favicon;this.branding_=b.branding;this.cajaMethod_=b.cajaMethod;this.language_=b[O]||Mc;this.accounts_=b.accounts||[];this.domain_=b.domain;this.serviceType_=b.serviceType;this.onLanguageChanged_=b.onLanguageChanged};Z.showTitle_=function(){this.title_&&(m.title=this.title_)};
Z.showFavIcon_=function(){if(this.favicon_&&l.accountchooser.UiHandler.VALID_URL_REGEX_[r](this.favicon_)){for(var b=m[fa](Pc)[0],c=b[fa](ed),d=0;d<c[N];d++){var e=c[d];e.type==Yc&&e.rel==Hd&&b[ra](e)}e=m[w](ed);e.type=Yc;e.rel=Hd;e.href=this.favicon_;b.appendChild(e)}};
Z.showBrandingContent_=function(){function b(b){var c=q(Da);b&&c[B](b);c[ma]()}if(this.branding_&&l.accountchooser.UiHandler.VALID_URL_REGEX_[r](this.branding_)){var c=this.branding_,c=-1==c[L](X)?c+X:c+Ra,c=c+(cd+this.language_);this.cajaMethod_==Cc?l.accountchooser.caja.cajoleHtml(xc,c,b):l.accountchooser.caja.sanitizeHtml(c,b)}};Z.showSampleAccountChooser_=function(){var b=new l.accountchooser.page.SelectAccountPage,c=q(Ia).empty();b.render(c,g,this.accounts_,g,this.domain_)};
Z.showManageContent_=function(){q(Ga)[B](l.accountchooser[R].manageContainer.header);q(Ha)[B](l.accountchooser[R].manageContainer.description)};Z.showSelectContent_=function(){var b=l.accountchooser[R].selectContainer.header+ta+this.domain_+jb;q(Ka)[B](b);this.showBrandingContent_();q(Ja)[ma]()};
Z.showStoreContent_=function(){var b=this.accounts_&&1<this.accounts_[N],c=l.accountchooser[R].storeContainer.header,d=l.accountchooser[R].storeContainer.headerMultiple;q(Ma)[B](b?d:c);c=l.accountchooser[R].storeContainer.description;d=l.accountchooser[R].storeContainer.descriptionMultiple;q(Na)[B](b?d:c);var e=l.accountchooser[R].storeContainer.benefits;q(nd).each(function(b,c){b<e[N]&&q(c)[B](e[b])});this.showSampleAccountChooser_();q(La)[ma]()};
Z.showUpdateContent_=function(){q(Pa)[B](l.accountchooser[R].updateContainer.header);q(Qa)[B](l.accountchooser[R].updateContainer.description);q(Oa)[ma]()};Z.showAboutContent_=function(){this.title_=l.accountchooser[R].aboutContainer.title;this.showTitle_();this.showAboutContainerMessages_(kd);this.accounts_=this.getAboutContainerSampleAccounts_();this.showSampleAccountChooser_()};
Z.showAboutContainerMessages_=function(b){var c=l.accountchooser[R].aboutContainer,d=q(qc+b+ya);if(d&&c)for(var e=0;e<d[N];e++){var f=q(d[e]),i=f.attr(Y)[s](b,W);c[i]&&f[B](c[i])}};l.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_=2;l.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_=2;
l.accountchooser.UiHandler[P].getAboutContainerSampleAccounts_=function(){var b=l.accountchooser.util.accountstorage.readAccounts(),c=l.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_,d=l.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_,e=l.accountchooser[R].aboutContainer;return b[N]>c?b.slice(0,c):b[N]<d?[e.accountWomanHome,e.accountWomanWork]:b};
l.accountchooser.UiHandler[P].showFooterContent_=function(){q(Ea)[B](l.accountchooser[R].footerContainer.copyright);var b=l.accountchooser[R].footerContainer.learnMoreLink;this.language_&&this.language_!=Mc&&(b=0<=b[L](X)?b+(Sa+this.language_):b+(ob+this.language_));var c=l.accountchooser[R].footerContainer.learnMore;q(Fa)[B](c).attr(Sc,b)};
l.accountchooser.UiHandler[P].initLanguageSelector_=function(){var b=q(Ca);b.unbind(Ec);b.val(this.language_);var c=this;b.change(function(){var d=b.val();if(d!=c.language_&&c.onLanguageChanged_)c.onLanguageChanged_(d)})};
var Wd=q,Zd={options:{popupMode:k,manageMode:k,aboutMode:k,uiLoader:j,idps:{},emailMapIdp:{},uiHandler:new l.accountchooser.UiHandler,enableCajole:k},loadService_:function(b,c){var d=this;this[G].uiLoader.loadService(b,this[G].services,function(e){d.executeService_(e,b,c)})},executeService_:function(b,c,d){b=new b;b.setContainer(this.element);b.setCdsConfig(this.cdsConfig);b.executeRequest[U](b,c);this.showCustomizedUI_(c,d)},showCustomizedUI_:function(b,c){if(this[G].uiHandler){var d={};if(b&&b.params_&&
b.params_.clientConfig){d=b.params_.clientConfig.ui||d;d.language=l.accountchooser.util.findLanguageCode(b.params_.clientConfig[O]);!this[G].enableCajole&&Cc==d.cajaMethod&&(d.cajaMethod=Ad);d.serviceType=b.method_;d.accounts=b.params_.accounts;var e=this;d.onLanguageChanged=function(d){b.params_.clientConfig.language=l.accountchooser.util.findLanguageCode(d);e.loadService_(b,c)}}d.language=d[O]||Mc;d.domain=c[s](/^https?:\/\//,W);this[G].uiHandler[ma](d)}},_create:function(){Wd(this.element).empty();
this.cdsConfig={popupMode:this[G].popupMode,idps:this[G].idps,emailMapIdp:this[G].emailMapIdp};this.cdsConfig.rpcs={serviceLoader:Wd.proxy(this.loadService_,this)};try{l.accountchooser.rpc.initCds(this.cdsConfig)}catch(b){!this[G].manageMode&&!this[G].aboutMode&&(b==l.accountchooser.rpc.EMPTY_SAVED_RPC||b==l.accountchooser.rpc.INVALID_CLIENT_DOMAIN)?this.redirectEmptyRequest():!this[G].manageMode&&!this[G].aboutMode&&a(b)}this[G].manageMode?this.showManagePage():this[G].aboutMode&&this.showAboutPage()},
redirectEmptyRequest:function(){var b=l.accountchooser.rpc.getDomainInHash_();l[F].href=b&&l.accountchooser.util.isValidUrlDomain(b)?Uc+b:l[F].protocol+cb+l[F].host},showManagePage:function(){var b=l.accountchooser.util.browserconfig.isDisabled(),c=l.accountchooser.util.accountstorage.readAccounts();b||!c[N]?this.showLearnMorePage_():this.sendFakeRequest_(l.accountchooser.rpc.ManageRequest,id)},showAboutPage:function(){this.sendFakeRequest_(l.accountchooser.rpc.AboutRequest,vc)},sendFakeRequest_:function(b,
c){var d={language:l.accountchooser.util.parseUrlParams(l[F].href).lang,clientCallbackUrl:l[F].href},d={data:(new b(c,d))[A](),origin:l[F].host};l.accountchooser.rpc.process_(d,h)},showLearnMorePage_:function(){var b=l.accountchooser.util.parseUrlParams(l[F].href).lang,c=db;b&&(c=0<=c[L](X)?c+(Sa+b):c+(ob+b));l[F][s](c)},destroy:function(){Wd(this.element).empty();Wd.Widget[P].destroy[U](this)}};Wd.widget("ui.cds",Zd);})()
