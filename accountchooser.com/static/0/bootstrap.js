/* Copyright 2012 Google Inc. All Rights Reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

(function(){function a(b){throw b;}var g=void 0,j=!0,k=null,l=!1,n=window,p=document,q=JSON,r=jQuery,aa=navigator;function ba(b,c){return b.toJSON=c}
var ca="origin",s="exec",t="replace",u="data",da="extend",v="sessionStorage",w="trim",x="createElement",y="setAttribute",ea="attachEvent",z="getTime",fa="getElementsByTagName",A="documentElement",B="toString",C="html",ga="toJSON",D="queue",E="setTimeout",F="split",ha="inArray",G="location",ia="localStorage",ja="removeItem",H="options",ka="displayName",la="isArray",ma="postMessage",I="push",na="show",J="Request",K="stringify",oa="load",L="indexOf",M="param",pa="name",qa="parse",N="length",O="language",
P="prototype",Q="labels",ra="clientWidth",S="document",T="body",sa="removeChild",U="call",ta="clientHeight",V="toLowerCase",W="",ua=" <span>",va=" from ",wa=" rtl",xa='", must be under domain "',ya='".',za='"]',Aa="\"]', not exist.",Ba="\"]'.",Ca="#",Da="#ac-language",Ea="#ac-market",Fa="#copyright",Ga="#learnmore",Ha="#manage_marketing_box > h1",Ia="#manage_marketing_box > p",Ja="#sample-accountchooser",Ka="#select_marketing_box",La="#select_marketing_box > h1",Ma="#store_marketing_box",Na="#store_marketing_box > h1",
Oa="#store_marketing_box > p",Pa="#update_marketing_box",Qa="#update_marketing_box > h1",Ra="#update_marketing_box > p",Sa="&",Ta="&lang=",Ua="'",Va="' found!",Wa="' has't initialized yet.",Xa="', uuid='",Ya="'.",Za="': no valid iframeUrl.",$a="(^|;) ?",ab="*",bb="-9999px",cb=".",db="//",eb="/learnmore.html",fb="1px",gb="2.0",hb=":",ib="; expires=",jb="; path=/",kb="</span>",lb="<iframe />",mb="=",nb="=([^;]*)(;|$)",ob="=; expires=",X="?",pb="?lang=",qb="@",sb="Caja process stoped due to timeout.",
tb="CallClient failed: cannot find client window.",ub="Clear CDS browser config.",vb="Error request format: ",wb="Failed to clear from DOM storage: ",xb="Failed to clear from cookie: ",yb="Failed to find callback for response: ",zb="Failed to find widget with uuid '",Ab="Failed to get client domain in URL hash.",Bb="Failed to init IDP iframe for '",Cb="Failed to parse request: ",Db="Failed to read from DOM storage: ",Eb="Failed to read from cookie: ",Fb="Failed to write to DOM storage: ",Gb="Failed to write to cookie: ",
Hb="GET",Ib="Get CDS browser config: ",Jb="Guest code rendered successfully.",Kb="Ignore expired JSON-RPC object: [",Lb="Ignore invalid JSON-RPC object: [",Mb='Illegal clientCallbackUrl "',Nb='Illegal negativeCallbackUrl "',Ob='Illegal positiveCallbackUrl "',Pb="Illegal request: ",Qb="Illegal state error: IDP domain '",Rb="Invalid JSON-RPC object: not a JSON object.",Sb="Invalid JSON-RPC request: 'jsonrpc' field should be '2.0'.",Tb="Invalid value for 'options.emailMapIdp.[\"",Ub="Invalid value for 'options.emailMapIdp[\"",
Vb="MSIE",Wb="No RPC handler for '",Xb="No content returned in the HTML file.",Yb="Parameter %%param%% cannot be an empty array.",Zb="Parameter %%param%% cannot be empty.",$b="Parameter %%param%% cannot be null.",ac="Parameter %%param%% is not a function.",bc="Parameter %%param%% is not an array.",cc="Read saved accounts from storage: ",dc="Received message: ",ec="Register handler for postMessage failed.",fc="Save accounts to storage: ",gc="Send message: ",hc="Set CDS browser config: ",ic="Successfully parsing request: ",
jc="Timeout when initializing Caja.",kc="Timeout when loading caja.js.",lc="Timeout when loading raw HTML.",mc="Unimplementated! Child object must provide an impelementation.",nc="Unimplementated! Child object must provide an implementation.",oc="Unrecognized request: ",pc="Unsupported IDP '",qc="Unsupported IDP domain '",rc='[id^="',sc="[object Array]",tc="[object Function]",uc="]",vc="_",wc="about",xc="absolute",yc="ac-market",zc="account",Ac="accounts",Bc="ar",Cc="body",Dc="cajole",Ec="callback",
Fc="change",Gc="chooserAccounts",Hc="class",Ic="complete",Jc="cookieName",Kc="disabled",Lc="domStorageKey",Mc="domain",Nc="en",Oc="form",Pc="handler",Qc="head",Rc="height",Sc="hidden",Tc="href",Uc="html",Vc="http://",Wc="https://ssl.gstatic.com/caja/",Y="id",Xc="idpConfig",Yc="iframeUrl",Zc="image/x-icon",$c="img",ad="input",bd="iw",cd="jsUrl",dd="lang=",ed="left",fd="link",gd="loaded",hd="localStorage",id="ltr",jd="manage",kd="message",ld="msg_",md="name",nd="object",od="ol.benefit-list > li > p",
pd="onmessage",qd="opt_cookieName",rd="opt_domStorageKey || opt_cookieName",sd="parentClass",td="position",ud="post",vd="query",wd="rel",xd="request",yd="requestId",zd="rpcObject",Ad="rtl",Bd="sanitize",Cd="script",Dd="semaphore value decrease to ",Ed="serviceMeta",Fd="serviceMeta.name",Gd="serviceName",Hd="sessionStorage",Id="shortcut icon",Jd="src",Kd="string",Ld="stylesheet",Md="targetWindow",Nd="text/css",Od="text/html",Pd="text/javascript",Qd="timeout",Rd="timeoutCallback",Sd="type",Td="value",
Ud="width",Vd="window",Wd="window.notifyWidget: type='",Z;n.accountchooser=n.accountchooser||{};n.cds=n.accountchooser;n.accountchooser.util=n.accountchooser.util||{};n.accountchooser.util.log=function(b){try{n.console&&n.console.log&&n.console.log(b)}catch(c){}};n.accountchooser.util.uuidCounter_=(new Date)[z]();n.accountchooser.util.generateUuid=function(b){return b&&b.uuid?b.uuid:++n.accountchooser.util.uuidCounter_};
n.accountchooser.util.createForm_=function(b,c,d){b||a("The targetUrl cannot be null.");var e=n[S][x](Oc);e.method=ud;e.action=b;if(c)for(var f in c)b=n[S][x](ad),b[y](Sd,Sc),b[y](md,f),c[f]===k||c[f]===g?b[y](Td,W):b[y](Td,c[f]),e.appendChild(b);d&&(e.target=d);n[S][T].appendChild(e);return e};n.accountchooser.util.postTo=function(b,c,d){b=n.accountchooser.util.createForm_(b,c,d);b.submit();n[S][T][sa](b)};
n.accountchooser.util.parseUrlParams=function(b){var c={};b=b.slice(b[L](X)+1)[F](Sa);for(var d=0;d<b[N];d++){var e=b[d][F](mb);c[e[0]]=2==e[N]?decodeURIComponent(e[1]):g}return c};n.accountchooser.util.formRedirect=function(b,c){var d=b.substring(0,b[L](X)),e=n.accountchooser.util.parseUrlParams(b);n.accountchooser.util.postTo(d,e,c)};n.accountchooser.util.isBrowserSupported=function(){var b=999;-1!=aa.appVersion[L](Vb)&&(b=parseFloat(aa.appVersion[F](Vb)[1]));return 7<b};
n.accountchooser.util.makeUrl=function(b,c){var d=[],e;for(e in c)d[I](c[e]?e+mb+c[e]:e);return b+X+d.join(Sa)};n.accountchooser.util.isArray=function(b){return"undefined"!==typeof r?r[la](b):Object[P][B][U](b)===sc};n.accountchooser.util.isFunction=function(b){return"undefined"!==typeof r?r.isFunction(b):Object[P][B][U](b)===tc};n.accountchooser.util.indexOf=function(b,c){if(c){if("undefined"!==typeof r)return r[ha](b,c);if(c[L])return c[L](b);for(var d=c[N],e=0;e<d;e++)if(e in c&&c[e]===b)return e}return-1};
n.accountchooser.util.windowWidth=function(b){if("undefined"!==typeof r)return r(b).width();var c=0;b.innerWidth?c=b.innerWidth:b[S]&&b[S][A]&&b[S][A][ra]?c=b[S][A][ra]:b[S]&&(b[S][T]&&b[S][T][ra])&&(c=b[S][T][ra]);return c};n.accountchooser.util.windowHeight=function(b){if("undefined"!==typeof r)return r(b).height();var c=0;b.innerHeight?c=b.innerHeight:b[S]&&b[S][A]&&b[S][A][ta]?c=b[S][A][ta]:b[S]&&(b[S][T]&&b[S][T][ta])&&(c=b[S][T][ta]);return c};
n.accountchooser.util.trim=function(b){return"undefined"!==typeof r?r[w](b):b==k?W:String[P][w]?String[P][w][U](b):b[t](/^[\s\xa0]+/,W)[t](/[\s\xa0]+$/,W)};
n.accountchooser.util.extend=function(b,c,d){if(3>arguments[N])return c||{};if("undefined"!==typeof r){var e=Array[P].slice[U](arguments,b?0:1);return r[da].apply(r,e)}if(typeof c!==nd||c==k)c={};for(var e=2,f=arguments[N];e<f;e++){var h=arguments[e];if(h!=k)for(var m in h)h[m]===g||c===h[m]||(b&&typeof h[m]==nd?(n.accountchooser.util[la](h[m])&&!n.accountchooser.util[la](c[m])&&(c[m]=[]),c[m]=n.accountchooser.util[da](j,c[m],h[m])):c[m]=h[m])}return c};n.accountchooser.param={};
n.accountchooser[M].notNull=function(b,c){(b===g||b===k)&&n.accountchooser[M].throwError_($b,c)};n.accountchooser[M].notEmpty=function(b,c){b||n.accountchooser[M].throwError_(Zb,c)};n.accountchooser[M].notEmptyArray=function(b,c){b||n.accountchooser[M].throwError_(Zb,c);n.accountchooser.util[la](b)||n.accountchooser[M].throwError_(bc,c);b[N]||n.accountchooser[M].throwError_(Yb,c)};
n.accountchooser[M].notEmptyFunction=function(b,c){b||n.accountchooser[M].throwError_(Zb,c);n.accountchooser.util.isFunction(b)||n.accountchooser[M].throwError_(ac,c)};n.accountchooser[M].throwError_=function(b,c){try{console&&console.trace&&console.trace()}catch(d){}a(b[t](/\%\%param\%\%/g,c?" '"+c+Ua:W))};Function[P].inheritsFrom=function(b){n.accountchooser[M].notEmptyFunction(b,sd);this.prototype=new b;this[P].constructor=this;this[P].parentClass=b[P]};
n.accountchooser.util.VALID_EMAIL_REGEX_=/^[a-z0-9]+(\.?[-+\w]+)*@([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;n.accountchooser.util.VALID_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+$/i;n.accountchooser.util.isValidEmail=function(b){return b&&k!=n.accountchooser.util.VALID_EMAIL_REGEX_[s](b)};n.accountchooser.util.isValidDomain=function(b){return b&&k!=n.accountchooser.util.VALID_DOMAIN_REGEX_[s](b)};
n.accountchooser.util.getEmailDomain=function(b){if((b=n.accountchooser.util[w](b))&&n.accountchooser.util.isValidEmail(b))return b[F](qb)[1][V]()};n.accountchooser.util.getEmailUsername=function(b){if((b=n.accountchooser.util[w](b))&&n.accountchooser.util.isValidEmail(b))return b[F](qb)[0][V]()};n.accountchooser.util.isDomainInNascar=function(b){if(b){var c=n.accountchooser.config.idps,d;for(d in c){var e=c[d];if(e&&e.domain==b)return d}}};n.accountchooser.util.USERNAME_REGEX=/^\w+(\.\w+)*$/;
n.accountchooser.util.isValidUsername=function(b){return n.accountchooser.config?n.accountchooser.config.disableUsernameFormatCheck?!!b:n.accountchooser.config.usernameRegex?!!b&&k!=n.accountchooser.config.usernameRegex[s](b):!!b&&k!=n.accountchooser.util.USERNAME_REGEX[s](b):!!b&&k!=n.accountchooser.util.USERNAME_REGEX[s](b)};n.accountchooser.util.DOMAIN_REGEX_=/:\/\/(.[^\/?]+)/;n.accountchooser.util.VALID_URL_DOMAIN_REGEX_=/^([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+(\:\d+)?$/i;
n.accountchooser.util.getDomainFromUrl=function(b){try{return b.match(n.accountchooser.util.DOMAIN_REGEX_)[1]}catch(c){}};n.accountchooser.util.isValidUrlDomain=function(b){return b?n.accountchooser.util.VALID_URL_DOMAIN_REGEX_.test(b):l};n.accountchooser.util.MOBILE_REGEX_=/iphone|ipad|ipod|android|blackberry|mini|iemobile|windows\sce|palm/i;n.accountchooser.util.isMobileAgent=function(b){return b&&n.accountchooser.util.MOBILE_REGEX_.test(b[V]())};
n.accountchooser.util.SUPPORTED_LANGUAGE_=[Nc,"en_gb","fr","it","de","es","zh_cn","zh_tw","ja","ko","nl","pl","pt","ru","th","tr","bg","ca","hr","cs","da","fil","fi","el","hi","hu",Y,"lv","lt","no","pt_pt","ro","sr","sk","sl","sv","uk","vi",Bc,bd];
n.accountchooser.util.ALTERNATIVE_CODES_MAP_={en_us:Nc,zh:"zh_cn",zh_hans:"zh_cn",zh_hans_cn:"zh_cn",zh_hant:"zh_tw",zh_hant_tw:"zh_tw",nl_nl:"nl",fr_fr:"fr",de_de:"de",it_it:"it",ja_jp:"ja",ko_kr:"ko",pl_pl:"pl",pt_br:"pt",ru_ru:"ru",es_es:"es",th_th:"th",tr_tr:"tr",bg_bg:"bg",ca_es:"ca",hr_hr:"hr",cs_cz:"cs",da_dk:"da",fil_ph:"fil",tl:"fil",fi_fi:"fi",el_gr:"el",hi_in:"hi",hu_hu:"hu",id_id:Y,lv_lv:"lv",lt_lt:"lt",no_no:"no",nb:"no",nb_no:"no",ro_ro:"ro",sr_cyrl_rs:"sr",sk_sk:"sk",sl_si:"sl",sv_se:"sv",
uk_ua:"uk",vi_vn:"vi"};n.accountchooser.util.findLanguageCode=function(b){b=b&&b[t](/-/g,vc)[V]();for(var c;b;){if(-1<r[ha](b,n.accountchooser.util.SUPPORTED_LANGUAGE_)){c=b;break}else if(n.accountchooser.util.ALTERNATIVE_CODES_MAP_[b]){c=n.accountchooser.util.ALTERNATIVE_CODES_MAP_[b];break}b=b[F](vc);b.pop();b=b.join(vc)}return c};n.accountchooser.util.isRightToLeft=function(b){b=n.accountchooser.util.findLanguageCode(b);return b==Bc||b==bd};
n.accountchooser.util.getNamespacedObjectByString=function(b){for(var c=b[F](cb),d=0,e=c[N],f=n;d<e;++d)f=0==d&&c[0]==Vd?n:f[c[d]],n.accountchooser[M].notNull(f,b);return f};n.accountchooser.util.REGISTRY_KEY_PREFIX_="widget_";n.accountchooser.util.widgets_={};n.accountchooser.util.registerWidget=function(b,c){n.accountchooser.util.widgets_[n.accountchooser.util.REGISTRY_KEY_PREFIX_+b]=c};
n.accountchooser.util.unregisterWidget=function(b){delete n.accountchooser.util.widgets_[n.accountchooser.util.REGISTRY_KEY_PREFIX_+b]};n.accountchooser.util.getWidget_=function(b){var c;if(b){var d=n.accountchooser.util.REGISTRY_KEY_PREFIX_+b;c=n.accountchooser.util.widgets_[d]}else for(d in n.accountchooser.util.widgets_){c=n.accountchooser.util.widgets_[d];break}return c};
n.accountchooser.util.notifyWidget=function(b,c,d){n.accountchooser.util.log(Wd+b+Xa+d+Ua);var e=n.accountchooser.util.getWidget_(d);if(e){var f=r[da]({},c);n[E](function(){e.handleNotification(b,f)},200)}else n.accountchooser.util.log(zb+d+Ya)};n.accountchooser.util.Storage=function(b,c,d){n.accountchooser[M].notEmpty(b||c,rd);n.accountchooser.util.Storage.isDomStorageSupported(d)||n.accountchooser[M].notEmpty(c,qd);this.domStorageKey_=b;this.cookieName_=c;this.perSession_=d};
n.accountchooser.util.Storage.isDomStorageSupported=function(b){try{return b?Hd in n&&n[v]!=k:hd in n&&n[ia]!=k}catch(c){return l}};Z=n.accountchooser.util.Storage[P];Z.read=function(){if(n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_())return this.readFromDomStorage_();if(this.isCookieStorageAllowed_())return this.readFromCookie_()};
Z.write=function(b){n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()?this.writeToDomStorage_(b):this.isCookieStorageAllowed_()&&this.writeToCookie_(b)};Z.clear=function(){n.accountchooser.util.Storage.isDomStorageSupported(this.perSession_)&&this.isDomStorageAllowed_()&&this.clearFromDomStorage_();this.isCookieStorageAllowed_()&&this.clearFromCookie_()};Z.isDomStorageAllowed_=function(){return!!this.domStorageKey_};Z.isCookieStorageAllowed_=function(){return!!this.cookieName_};
Z.readFromDomStorage_=function(){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var b=this.perSession_?n[v]:n[ia];try{var c=b.getItem(this.domStorageKey_);if(c)return q[qa](c)}catch(d){n.accountchooser.util.log(Db+d)}};Z.writeToDomStorage_=function(b){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var c=this.perSession_?n[v]:n[ia];try{var d=q[K](b);c.setItem(this.domStorageKey_,d)}catch(e){n.accountchooser.util.log(Fb+e)}};
Z.clearFromDomStorage_=function(){n.accountchooser[M].notEmpty(this.domStorageKey_,Lc);var b=this.perSession_?n[v]:n[ia];try{b[ja](this.domStorageKey_)}catch(c){n.accountchooser.util.log(wb+c)}};Z.readFromCookie_=function(){n.accountchooser[M].notEmpty(this.cookieName_,Jc);var b=p.cookie.match($a+this.cookieName_+nb);if(b&&(b=n.accountchooser.util[w](b[2])))try{return q[qa](unescape(b))}catch(c){n.accountchooser.util.log(Eb+c)}};
Z.writeToCookie_=function(b){n.accountchooser[M].notEmpty(this.cookieName_,Jc);try{var c=new Date,d=c.getFullYear()+10,e=c.getMonth(),f=c.getDate(),h=new Date(d,e,f),m=this.perSession_?0:h.toGMTString();p.cookie=this.cookieName_+mb+escape(q[K](b))+ib+m+jb}catch(R){n.accountchooser.util.log(Gb+R)}};
Z.clearFromCookie_=function(){n.accountchooser[M].notEmpty(this.cookieName_,Jc);try{var b=new Date;b.setTime(b[z]()-1);p.cookie=this.cookieName_+ob+b.toGMTString()+jb}catch(c){n.accountchooser.util.log(xb+c)}};n.accountchooser.util.accountstorage={};n.accountchooser.util.accountstorage.ACCOUNTS_=Gc;n.accountchooser.util.accountstorage.AC_COOKIE_NAME_="__goog__ac__";n.accountchooser.util.accountstorage.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.accountstorage.ACCOUNTS_,n.accountchooser.util.accountstorage.AC_COOKIE_NAME_);
n.accountchooser.util.accountstorage.read_=function(){var b=n.accountchooser.util.accountstorage.storage_.read();n.accountchooser.util.log(cc+q[K](b));return b};n.accountchooser.util.accountstorage.write_=function(b){n.accountchooser.util.log(fc+q[K](b));n.accountchooser.util.accountstorage.storage_.write(b)};n.accountchooser.util.accountstorage.readAccounts=function(){var b=n.accountchooser.util.accountstorage.read_();if(!b||!n.accountchooser.util[la](b))b=[];return b};
n.accountchooser.util.accountstorage.addAccount=function(b){if(!b||!b.email)return l;for(var c=l,d=n.accountchooser.util.accountstorage.readAccounts(),e,f=0;f<d[N];f++)if(n.accountchooser.util.accountstorage.matchAccount_(d[f],b.email,b.providerId)){e=d[f];d.splice(f,1);c=j;break}e&&(!b[ka]&&e[ka]&&(b.displayName=e[ka]),!b.photoUrl&&e.photoUrl&&(b.photoUrl=e.photoUrl));d.unshift(b);n.accountchooser.util.accountstorage.write_(d);return!c};
n.accountchooser.util.accountstorage.removeAccount=function(b){if(!b||!b.email)return l;for(var c=l,d=n.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(n.accountchooser.util.accountstorage.matchAccount_(d[e],b.email,b.providerId)){d.splice(e,1);c=j;break}n.accountchooser.util.accountstorage.write_(d);return c};n.accountchooser.util.accountstorage.clearAccounts=function(){n.accountchooser.util.accountstorage.storage_.clear()};
n.accountchooser.util.accountstorage.updateAccount=function(b,c,d){if(b)for(var e=n.accountchooser.util.accountstorage.readAccounts(),f=0;f<e[N];f++)if(n.accountchooser.util.accountstorage.matchAccount_(e[f],b,d)){c(e[f]);n.accountchooser.util.accountstorage.write_(e);break}};
n.accountchooser.util.accountstorage.refreshAccount=function(b){b&&b.email&&n.accountchooser.util.accountstorage.updateAccount(b.email,function(c){b[ka]&&(c.displayName=b[ka]);b.photoUrl&&(c.photoUrl=b.photoUrl);b.legacy!=g&&(c.legacy=b.legacy)},b.providerId)};
n.accountchooser.util.accountstorage.fetchAccount=function(b,c){if(b)for(var d=n.accountchooser.util.accountstorage.readAccounts(),e=0;e<d[N];e++)if(n.accountchooser.util.accountstorage.matchAccount_(d[e],b,c)){var f=d[e];d.splice(e,1);d.unshift(f);n.accountchooser.util.accountstorage.write_(d);return f}};n.accountchooser.util.accountstorage.matchAccount_=function(b,c,d){return b.email!=c?l:b.providerId&&d&&b.providerId==d||!b.providerId&&!d?j:l};n.accountchooser.updateSavedAccount=function(b){n.accountchooser.util.accountstorage.addAccount(b)};
n.accountchooser.removeSavedAccount=function(b){return n.accountchooser.util.accountstorage.removeAccount(b)};n.accountchooser.clearSavedAccounts=function(){n.accountchooser.util.accountstorage.clearAccounts()};n.accountchooser.util.accountstorage.ACCOUNTS_=Gc;n.accountchooser.util.accountstorage.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.accountstorage.ACCOUNTS_);n.accountchooser.util.accountstorage.NO_IDP_="NO_IDP";
n.accountchooser.util.accountstorage.readAccounts=function(b){var c=n.accountchooser.util.accountstorage.read_();if(!c||!n.accountchooser.util[la](c))c=[];if(!b)return c;var d=[];if(b.withEmail){var e=function(b){return n.accountchooser.util.isValidEmail(b.email)};d[I](e)}b.idpList&&0!=b.idpList[N]&&(e=function(c){return 0<=n.accountchooser.util[L](c.providerId||n.accountchooser.util.accountstorage.NO_IDP_,b.idpList)},d[I](e));b.emailDomainList&&0!=b.emailDomainList[N]&&(e=function(c){return(c=n.accountchooser.util.getEmailDomain(c.email))?
0<=n.accountchooser.util[L](c,b.emailDomainList):j},d[I](e));for(e=0;e<d[N];e++)c=n.accountchooser.util.accountstorage.filter_(c,d[e]);return c};n.accountchooser.util.accountstorage.filter_=function(b,c){for(var d=[],e=0;e<b[N];e++)c(b[e])&&d[I](b[e]);return d};n.accountchooser.util.browserconfig={};n.accountchooser.util.browserconfig.SETTINGS_KEY_="cdsSettings";n.accountchooser.util.browserconfig.COOKIE_NAME_="__cds__settings__";
n.accountchooser.util.browserconfig.storage_=new n.accountchooser.util.Storage(n.accountchooser.util.browserconfig.SETTINGS_KEY_,n.accountchooser.util.browserconfig.COOKIE_NAME_);n.accountchooser.util.browserconfig.getAll=function(){var b=n.accountchooser.util.browserconfig.storage_.read()||{};n.accountchooser.util.log(Ib+q[K](b));return b};n.accountchooser.util.browserconfig.setAll=function(b){n.accountchooser.util.log(hc+q[K](b));n.accountchooser.util.browserconfig.storage_.write(b)};
n.accountchooser.util.browserconfig.clearAll=function(){n.accountchooser.util.log(ub);n.accountchooser.util.browserconfig.storage_.clear()};n.accountchooser.util.browserconfig.get=function(b){return n.accountchooser.util.browserconfig.getAll()[b]};n.accountchooser.util.browserconfig.set=function(b,c){var d=n.accountchooser.util.browserconfig.getAll();d[b]=c;n.accountchooser.util.browserconfig.setAll(d)};
n.accountchooser.util.browserconfig.clear=function(b){var c=n.accountchooser.util.browserconfig.getAll();delete c[b];n.accountchooser.util.browserconfig.setAll(c)};n.accountchooser.util.browserconfig.isDisabled=function(){return!!n.accountchooser.util.browserconfig.get(Kc)};n.accountchooser.util.browserconfig.setDisabled=function(b){n.accountchooser.util.browserconfig.set(Kc,!!b)};n.accountchooser.loader=n.accountchooser.loader||{};n.accountchooser.loader.Loader=function(){};
n.accountchooser.loader.Loader[P].load=function(b,c,d,e){var f=this;this.load_(b,d,function(){c?f.load_(c,d,e):e&&e()})};
n.accountchooser.loader.Loader[P].load_=function(b,c,d){var e=p[fa](Qc)[0]||p[A],f=this.createResourceElement(b);this.finished_=l;var h=this;f.onload=f.onreadystatechange=function(){if(!h.finished_&&(!this.readyState||this.readyState===gd||this.readyState===Ic))h.finished_=j,f.onload=f.onreadystatechange=k,c&&c()};f.onerror=function(){h.finished_=j;e[sa](f);d&&d()};e.insertBefore(f,e.firstChild)};n.accountchooser.loader.Loader[P].createResourceElement=function(){a("Unimplemented! Child object must provide an implementation.")};
n.accountchooser.loader.JsLoader=function(){};n.accountchooser.loader.JsLoader.inheritsFrom(n.accountchooser.loader.Loader);n.accountchooser.loader.JsLoader[P].createResourceElement=function(b){var c=p[x](Cd);c[y](Sd,Pd);c[y](Jd,b);return c};n.accountchooser.loader.CssLoader=function(){};n.accountchooser.loader.CssLoader.inheritsFrom(n.accountchooser.loader.Loader);
n.accountchooser.loader.CssLoader[P].createResourceElement=function(b){var c=p[x](fd);c[y](Sd,Nd);c[y](wd,Ld);c[y](Tc,b);var d=p[x]($c);d[y](Jd,b);var e=this;d.onerror=function(){if(!e.finished_)c.onload()};return c};n.accountchooser.util.Semaphore=function(b,c){n.accountchooser[M].notEmptyFunction(b,Pc);0>c&&a("Semaphore value cannot be negative.");this.handler_=b;this.value_=c||0;this.started_=l};Z=n.accountchooser.util.Semaphore[P];Z.getValue=function(){return this.value_};
Z.increase=function(){this.started_&&a("Cannot increase Semaphore value after calling start().");this.value_++};Z.start=function(){0>=this.value_&&a("Semaphore value must bigger than 0.");this.started_=j};Z.isStarted=function(){return this.started_};Z.decrease=function(){this.started_||a("Cannot decrease Semaphore value before calling start().");0<this.value_&&(this.value_--,n.accountchooser.util.log(Dd+this.value_),0==this.value_&&this.handler_())};
n.accountchooser.util.AccountPropertyKey={EMAIL:"email",DISPLAY_NAME:"displayName",PHOTO_URL:"photoUrl",PROVIDER_ID:"providerId"};n.accountchooser.util.sanitizeAccount=function(b,c,d){var e={},f=n.accountchooser.util.AccountPropertyKey,h;for(h in b){var m=b[h];switch(h){case f.EMAIL:case f.DISPLAY_NAME:case f.PHOTO_URL:case f.PROVIDER_ID:(m=c?c(h,m):m)&&(e[h]=m);break;default:d||a('Unrecognized key "'+h+'" for account')}}e[f.EMAIL]||a("No valid email field for the account");return e};
n.accountchooser.util.sanitizeAccounts=function(b,c,d){for(var e=[],f=0,h=b[N];f<h;f++){var m=n.accountchooser.util.sanitizeAccount(b[f],c,d);e[I](m)}return e};n.accountchooser.util.accountSanitizer=function(b,c){if(b==n.accountchooser.util.AccountPropertyKey.PHOTO_URL){if(/https?:\/\//i.test(c))return c}else return html.sanitizeWithPolicy(c,function(){})};n.accountchooser.caja=n.accountchooser.caja||{};
n.accountchooser.caja.loadHtml=function(b,c,d,e){r.ajax({type:Hb,url:b,dataType:Uc,success:d,timeout:c,error:function(b,c,d){e&&e(c,d)}})};n.accountchooser.caja.loadJs_=function(b,c,d){(new n.accountchooser.loader.JsLoader)[oa](b,g,c,d)};n.accountchooser.caja.loadedUrls_={};n.accountchooser.caja.loadedCallback_=function(b){if(b&&(b=n.accountchooser.caja.loadedUrls_[b])){b.loaded=j;for(var c=0;c<b.callbacks[N];c++){var d=b.callbacks[c];d&&d()}b.callbacks=[];b.error=l;b.errorCallbacks=[]}};
n.accountchooser.caja.errorCallback_=function(b,c,d){if(b&&(b=n.accountchooser.caja.loadedUrls_[b])){b.loaded=j;b.error=j;for(var e=0;e<b.errorCallbacks[N];e++){var f=b.errorCallbacks[e];f&&f(c,d)}b.errorCallbacks=[];b.callbacks=[]}};
n.accountchooser.caja.loadJs=function(b,c,d){n.accountchooser[M].notEmpty(b,cd);var e=n.accountchooser.caja.loadedUrls_[b];e?e.loaded?e.error?d&&d():c():(e.callbacks[I](c),d&&e.errorCallbacks[I](d)):(n.accountchooser.caja.loadedUrls_[b]={loaded:l,callbacks:[c]},n.accountchooser.caja.loadJs_(b,function(){n.accountchooser.caja.loadedCallback_(b)},function(){n.accountchooser.caja.errorCallback_(b)}))};n.accountchooser.caja=n.accountchooser.caja||{};n.accountchooser.caja.cajaUrl="https://ssl.gstatic.com/caja/4891/caja.js";
n.accountchooser.caja.htmlSanitizerUrl="https://ssl.gstatic.com/caja/4891/html-css-sanitizer-minified.js";n.accountchooser.caja.CAJA_TIMEOUT=5E3;n.accountchooser.caja.WHITELIST_IDS=["AC_LANGUAGE_LIST"];n.accountchooser.caja=n.accountchooser.caja||{};
n.accountchooser.caja.sanitizeHtml=function(b,c,d){function e(b){0>m-(new Date)[z]()?d&&d(Qd):(b=html_sanitize(b,h,f),c(b))}function f(b){if(0<=r[ha](b,n.accountchooser.caja.WHITELIST_IDS))return b}function h(b){return b}var m=(new Date)[z]()+n.accountchooser.caja.CAJA_TIMEOUT;n.accountchooser.caja.loadJs(n.accountchooser.caja.htmlSanitizerUrl,function(){var c=m-(new Date)[z]();50>c?d&&d(Qd):n.accountchooser.caja.loadHtml(b,c,e,d)})};
n.accountchooser.caja.cajoleHtml=function(b,c,d,e){function f(){if(R)n.accountchooser.util.log(kc);else{var b=Yd-(new Date)[z]();50>b?n.accountchooser.util.log(kc):n.accountchooser.caja.loadHtml(c,b,function(b){n[E](function(){R?n.accountchooser.util.log(lc):b?(n.accountchooser.caja.cajaInitialized||(n.accountchooser.caja.cajaInitialized=j,caja.initialize({cajaServer:Wc,forceES5Mode:j})),n[E](function(){R?n.accountchooser.util.log(jc):caja[oa](m,h,function(c){c.code(g,Od,b).run(function(){R||n.clearTimeout(Zd);
rb=j;d&&d();n.accountchooser.util.log(Jb)})})},10)):n.accountchooser.util.log(Xb)},10)})}}var h={rewrite:function(b){return b}},m=p.getElementById(b),R=l,rb=l,Zd=n[E](function(){n.accountchooser.util.log(sb);R=j;!rb&&e&&e()},n.accountchooser.caja.CAJA_TIMEOUT),Yd=(new Date)[z]()+n.accountchooser.caja.CAJA_TIMEOUT;n.accountchooser.caja.loadJs(n.accountchooser.caja.cajaUrl,function(){n[E](f,10)})};n.accountchooser.rpc=n.accountchooser.rpc||{};n.accountchooser.rpc.RpcObject=function(){};
n.accountchooser.rpc.RpcObject[P].setTimestamp=function(b){this.timestamp_=b||(new Date)[z]()};ba(n.accountchooser.rpc.RpcObject[P],function(){var b={jsonrpc:gb};this.timestamp_!=k&&(b.timestamp=this.timestamp_);return b});n.accountchooser.rpc.RpcObject[P].toString=function(){return q[K](this[ga]())};n.accountchooser.rpc.AbstractRequest=function(b,c){this.method_=b;this.params_=c};n.accountchooser.rpc.AbstractRequest.inheritsFrom(n.accountchooser.rpc.RpcObject);Z=n.accountchooser.rpc.AbstractRequest[P];
Z.setMethod=function(b){this.method_=b};Z.getMethod=function(){return this.method_};Z.setParameters=function(b){this.params_=b};Z.getParameters=function(){return this.params_};ba(Z,function(){var b=n.accountchooser.rpc.RpcObject[P][ga][U](this);this.method_!=k&&(b.method=this.method_);this.params_!=k&&(b.params=this.params_);return b});n.accountchooser.rpc.Notification=function(b,c){this.method_=b;this.params_=c};n.accountchooser.rpc.Notification.inheritsFrom(n.accountchooser.rpc.AbstractRequest);
n.accountchooser.rpc.Request=function(b,c,d){this.method_=b;this.params_=c;this.id_=d};n.accountchooser.rpc[J].inheritsFrom(n.accountchooser.rpc.AbstractRequest);n.accountchooser.rpc[J][P].setId=function(b){this.id_=b};n.accountchooser.rpc[J][P].getId=function(){return this.id_};ba(n.accountchooser.rpc[J][P],function(){var b=n.accountchooser.rpc.AbstractRequest[P][ga][U](this);this.id_!=k&&(b.id=this.id_);return b});
n.accountchooser.rpc.Response=function(b,c,d){n.accountchooser[M].notEmpty(b,Y);this.id_=b;this.result_=c;this.error_=d};n.accountchooser.rpc.Response.inheritsFrom(n.accountchooser.rpc.RpcObject);Z=n.accountchooser.rpc.Response[P];Z.getResult=function(){return this.result_};Z.setResult=function(b){this.result_=b};Z.getError=function(){return this.error_};Z.setError=function(b){this.error_=b};Z.setId=function(b){this.id_=b};Z.getId=function(){return this.id_};
ba(Z,function(){var b=n.accountchooser.rpc.RpcObject[P][ga][U](this);b.id=this.id_;this.result_!=k?b.result=this.result_:this.error_!=k&&(b.error=this.error_);return b});n.accountchooser.rpc.RequestAckNotification=function(b){n.accountchooser[M].notEmpty(b,yd);this.method_=n.accountchooser.rpc.RequestAckNotification.METHOD;this.params_={requestId:b}};n.accountchooser.rpc.RequestAckNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.RequestAckNotification.METHOD="requestAckNotification";
n.accountchooser.rpc.RequestAckNotification[P].setRequestId=function(b){this.params_.requestId=b};n.accountchooser.rpc.RequestAckNotification[P].getRequestId=function(){return this.params_.requestId};n.accountchooser.rpc.CdsReadyNotification=function(){this.method_=n.accountchooser.rpc.CdsReadyNotification.METHOD};n.accountchooser.rpc.CdsReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.CdsReadyNotification.METHOD="cdsReadyNotification";
n.accountchooser.rpc.ClientReadyNotification=function(){this.method_=n.accountchooser.rpc.ClientReadyNotification.METHOD};n.accountchooser.rpc.ClientReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.ClientReadyNotification.METHOD="clientReadyNotification";n.accountchooser.rpc.EmptyResponseNotification=function(){this.method_=n.accountchooser.rpc.EmptyResponseNotification.METHOD};n.accountchooser.rpc.EmptyResponseNotification.inheritsFrom(n.accountchooser.rpc.Notification);
n.accountchooser.rpc.EmptyResponseNotification.METHOD="emptyResponseNotification";n.accountchooser.rpc.StoreRequest=function(b,c,d){n.accountchooser[M].notEmpty(b,Y);n.accountchooser[M].notEmptyArray(c,Ac);c&&(c=n.accountchooser.util.sanitizeAccounts(c));this.method_=n.accountchooser.rpc.StoreRequest.METHOD;this.params_={accounts:c,clientConfig:d};this.id_=b};n.accountchooser.rpc.StoreRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.StoreRequest.METHOD="store";
n.accountchooser.rpc.SelectRequest=function(b,c,d){n.accountchooser[M].notEmpty(b,Y);c&&(c=n.accountchooser.util.sanitizeAccounts(c));this.method_=n.accountchooser.rpc.SelectRequest.METHOD;this.params_={localAccounts:c,clientConfig:d};this.id_=b};n.accountchooser.rpc.SelectRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.SelectRequest.METHOD="select";
n.accountchooser.rpc.UpdateRequest=function(b,c,d){n.accountchooser[M].notEmpty(b,Y);n.accountchooser[M].notEmpty(c,zc);c&&(c=n.accountchooser.util.sanitizeAccount(c));this.method_=n.accountchooser.rpc.UpdateRequest.METHOD;this.params_={account:c,clientConfig:d};this.id_=b};n.accountchooser.rpc.UpdateRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.UpdateRequest.METHOD="update";
n.accountchooser.rpc.ManageRequest=function(b,c){n.accountchooser[M].notEmpty(b,Y);this.method_=n.accountchooser.rpc.ManageRequest.METHOD;this.params_={clientConfig:c};this.id_=b};n.accountchooser.rpc.ManageRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.ManageRequest.METHOD=jd;n.accountchooser.rpc.AboutRequest=function(b,c){n.accountchooser[M].notEmpty(b,Y);this.method_=n.accountchooser.rpc.AboutRequest.METHOD;this.params_={clientConfig:c};this.id_=b};n.accountchooser.rpc.AboutRequest.inheritsFrom(n.accountchooser.rpc[J]);
n.accountchooser.rpc.AboutRequest.METHOD=wc;n.accountchooser.rpc.QueryRequest=function(b,c,d,e){n.accountchooser[M].notEmpty(b,Y);n.accountchooser[M].notEmpty(c,vd);d&&(d=n.accountchooser.util.sanitizeAccount(d));this.method_=n.accountchooser.rpc.QueryRequest.METHOD;this.params_={query:c,account:d,clientConfig:e};this.id_=b};n.accountchooser.rpc.QueryRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.QueryRequest.METHOD=vd;
n.accountchooser.rpc.Queries={CDS_DISABLED:"cdsDisabled",CDS_EMPTY:"cdsEmpty",ACCOUNT_EXIST:"accountExist"};n.accountchooser.rpc.IdpReadyNotification=function(){this.method_=n.accountchooser.rpc.IdpReadyNotification.METHOD};n.accountchooser.rpc.IdpReadyNotification.inheritsFrom(n.accountchooser.rpc.Notification);n.accountchooser.rpc.IdpReadyNotification.METHOD="idpReadyNotification";
n.accountchooser.rpc.IdpAuthRequest=function(b,c){n.accountchooser[M].notEmpty(b,zc);this.method_=n.accountchooser.rpc.IdpAuthRequest.METHOD;this.params_={account:b,clientConfig:c};this.id_=n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID+hb+b.email};n.accountchooser.rpc.IdpAuthRequest.inheritsFrom(n.accountchooser.rpc[J]);n.accountchooser.rpc.IdpAuthRequest.METHOD="idpAuth";n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID="idpAuth";
n.accountchooser.rpc.parseRpcObject=function(b){var c=k;if(b){try{var d=q[qa](b)}catch(e){return n.accountchooser.util.log(Rb),c}if(!d||d.jsonrpc!=gb)n.accountchooser.util.log(Sb);else if(d.method){var f=d.method[V]();f==n.accountchooser.rpc.StoreRequest.METHOD[V]()?d.id&&(d.params&&d.params.accounts)&&(c=new n.accountchooser.rpc.StoreRequest(d.id,d.params.accounts,d.params.clientConfig)):f==n.accountchooser.rpc.SelectRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.SelectRequest(d.id,d.params.localAccounts,
d.params.clientConfig)):f==n.accountchooser.rpc.UpdateRequest.METHOD[V]()?d.id&&(d.params&&d.params.account)&&(c=new n.accountchooser.rpc.UpdateRequest(d.id,d.params.account,d.params.clientConfig)):f==n.accountchooser.rpc.ManageRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.ManageRequest(d.id,d.params.clientConfig)):f==n.accountchooser.rpc.AboutRequest.METHOD[V]()?d.id&&(c=new n.accountchooser.rpc.AboutRequest(d.id,d.params.clientConfig)):f==n.accountchooser.rpc.IdpReadyNotification.METHOD[V]()&&
(c=new n.accountchooser.rpc.IdpReadyNotification)}else typeof d.id===Kd&&0<=d.id[L](n.accountchooser.rpc.IdpAuthRequest.DEFAULT_ID)&&(c=new n.accountchooser.rpc.Response(d.id,d.result,d.error))}c?n.accountchooser.util.log(ic+b):n.accountchooser.util.log(Cb+b);return c};n.accountchooser.rpc.DEFAULT_CDS_DOMAIN="https://www.accountchooser.com";n.accountchooser.rpc.DEFAULT_CDS_IFRAME_PATH="/iframe.html";n.accountchooser.rpc.DEFAULT_CDS_POPUP_PATH="/popup.html";
n.accountchooser.rpc.DEFAULT_CDS_REDIRECT_PATH="/redirect.html";n.accountchooser.rpc.DEFAULT_POPUP_WIDTH=520;n.accountchooser.rpc.DEFAULT_POPUP_HEIGHT=550;n.accountchooser.rpc.EMPTY_RESPONSE_CALLBACK="empty";n.accountchooser.rpc.IDP_TIMEOUT=3E3;n.accountchooser.rpc.RPC_TIMEOUT=3E5;n.accountchooser.rpc.services_={};n.accountchooser.rpc.register=function(b,c){n.accountchooser[M].notEmpty(b,Gd);n.accountchooser[M].notNull(c,Pc);n.accountchooser.rpc.services_[b]=c};
n.accountchooser.rpc.call=function(b,c,d){n.accountchooser[M].notEmpty(b,Md);c=c[B]();n.accountchooser.util.log(gc+c);b[ma](c,d||ab)};n.accountchooser.rpc.init_=function(b){n.addEventListener?n.addEventListener(kd,b,l):n[ea]?n[ea](pd,b):n[S][ea]?n[S][ea](pd,b):n.accountchooser.util.log(ec)};n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_="IN_RPC_";n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_="OUT_RPC_";
n.accountchooser.rpc.readSavedRpcObjects=function(b,c){var d;d=c?n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b[t](/^https?:\/\//,W);var e=[],f=n[v].getItem(d);if(f){n[v][ja](d);var h=n.JSON[qa](f)||[],f=(new Date)[z]();if(h[N]){h=h[h[N]-1];try{var m=q[qa](h);m&&m.timestamp&&f-m.timestamp<n.accountchooser.rpc.RPC_TIMEOUT?(e[I](h),c&&n[v].setItem(d,n.JSON[K](e))):n.accountchooser.util.log(Kb+h+uc)}catch(R){n.accountchooser.util.log(Lb+h+uc)}}}return e};
n.accountchooser.rpc.saveRpcObject=function(b,c,d){b=b[t](/^https?:\/\//,W);n[v][ja](n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_+b);n[v][ja](n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_+b);d=d?n.accountchooser.rpc.SAVED_IN_RPC_PREFIX_:n.accountchooser.rpc.SAVED_OUT_RPC_PREFIX_;d+=b;b=[];c.setTimestamp();b[I](c[B]());c=n.JSON[K](b);n[v].setItem(d,c)};n.accountchooser.rpc.idps={};n.accountchooser.rpc.idpsIndexedByDomain={};n.accountchooser.rpc.emailMapIdp={};
n.accountchooser.rpc.timer_={running:l,id:0,callback:k};n.accountchooser.rpc.clearTimeoutCallback_=function(){if(n.accountchooser.rpc.timer_.running){try{n.clearTimeout(n.accountchooser.rpc.timer_.id)}catch(b){}n.accountchooser.rpc.timer_.running=l;n.accountchooser.rpc.timer_.id=0;n.accountchooser.rpc.timer_.callback=k}};
n.accountchooser.rpc.setTimeoutCallback_=function(b){n.accountchooser[M].notEmptyFunction(b,Rd);n.accountchooser.rpc.clearTimeoutCallback_();n.accountchooser.rpc.timer_.callback=b;n.accountchooser.rpc.timer_.id=n[E](function(){n.accountchooser.rpc.timer_.callback&&n.accountchooser.rpc.timer_.callback[U](n);n.accountchooser.rpc.timer_.running=l;n.accountchooser.rpc.timer_.id=0;n.accountchooser.rpc.timer_.callback=k},n.accountchooser.rpc.IDP_TIMEOUT);n.accountchooser.rpc.timer_.running=j};
n.accountchooser.rpc.initIdpIFrame_=function(b){!b||!n.accountchooser.rpc.idps[b]?n.accountchooser.util.log(pc+b+Ya):n.accountchooser.rpc.idps[b].iframeUrl?n.accountchooser.rpc.initIdpIFrameByConfig_(n.accountchooser.rpc.idps[b]):n.accountchooser.util.log(Bb+b+Za)};n.accountchooser.rpc.initIdpIFrameByConfig_=function(b){if(b&&!b.iframe){var c=r(lb).css(td,xc).css(Ud,fb).css(Rc,fb).css(ed,bb).appendTo(Cc);b.iframe=c;c.attr(Jd,b.iframeUrl)}};
n.accountchooser.rpc.onIdpReady_=function(b){if(!b||!n.accountchooser.rpc.idpsIndexedByDomain[b])n.accountchooser.util.log(qc+b+Ya);else{var c=n.accountchooser.rpc.idpsIndexedByDomain[b];if(c.iframe){b=c.iframe[0].contentWindow;if(c[D]&&c[D][N]){for(var d=0;d<c[D][N];d++)n.accountchooser.rpc[U](b,c[D][d]);c.queue=[]}c.idpReady=j}else n.accountchooser.util.log(Qb+b+Wa)}};
n.accountchooser.rpc.callIdp=function(b,c,d,e){b&&n.accountchooser.rpc.idps[b]&&n.accountchooser.rpc.callIdpByConfig(n.accountchooser.rpc.idps[b],c,d,e)};n.accountchooser.rpc.callIdpByDomain=function(b,c,d,e){b&&n.accountchooser.rpc.idpsIndexedByDomain[b]&&n.accountchooser.rpc.callIdpByConfig(n.accountchooser.rpc.idpsIndexedByDomain[b],c,d,e)};
n.accountchooser.rpc.callIdpByConfig=function(b,c,d,e){n.accountchooser[M].notEmpty(b,Xc);n.accountchooser[M].notEmpty(c,xd);n.accountchooser[M].notEmptyFunction(d,Ec);n.accountchooser[M].notEmptyFunction(e,Qd);n.accountchooser.rpc.setTimeoutCallback_(e);n.accountchooser.rpc.addIdpCallback_(b,c,d);if(b.idpReady)n.accountchooser.rpc[U](b.iframe[0].contentWindow,c);else b[D]||(b.queue=[]),b[D][I](c),b.iframe||n.accountchooser.rpc.initIdpIFrameByConfig_(b)};
n.accountchooser.rpc.callIdpByConfig.callbacks_={};n.accountchooser.rpc.addIdpCallback_=function(b,c,d){n.accountchooser.rpc.callIdpByConfig.callbacks_[b.domain+hb+c.id_]={callback:d,idpConfig:b}};n.accountchooser.rpc.getIdpCallback_=function(b,c){var d=b+hb+c.id_,e=n.accountchooser.rpc.callIdpByConfig.callbacks_[d];if(e)return delete n.accountchooser.rpc.callIdpByConfig.callbacks_[d],e.callback};
n.accountchooser.rpc.isSupportedIdp=function(b){if(b&&(b=b.providerId||n.accountchooser.util.getEmailDomain(b.email)))if((b=n.accountchooser.rpc.emailMapIdp[b])&&n.accountchooser.rpc.idps[b])return b;return l};n.accountchooser.rpc.EMPTY_SAVED_RPC="EMPTY_SAVED_RPC";n.accountchooser.rpc.INVALID_CLIENT_DOMAIN="INVALID_CLIENT_DOMAIN";n.accountchooser.rpc.popupMode=l;n.accountchooser.rpc.clientWindow=k;
n.accountchooser.rpc.getDomainInHash_=function(){if(n[G].hash){var b=n[G].hash;b&&b[0]==Ca&&(b=b.substring(1));return b}};n.accountchooser.rpc.triggerSavedRpcs_=function(){if(!n.accountchooser.rpc.popupMode){var b=n.accountchooser.rpc.readSavedRpcObjects(n.accountchooser.rpc.clientDomain_,j);if(b&&b[N])for(var c=0;c<b[N];c++)n.accountchooser.rpc.process_({data:b[c],origin:n.accountchooser.rpc.clientDomain_},j);else a(n.accountchooser.rpc.EMPTY_SAVED_RPC)}};
n.accountchooser.rpc.sendCdsReadyNotification_=function(){if(n.accountchooser.rpc.popupMode){var b=new n.accountchooser.rpc.CdsReadyNotification;n.accountchooser.rpc.clientWindow[ma](b[B](),ab)}};
n.accountchooser.rpc.process_=function(b,c){n.accountchooser.util.log(dc+b[u]+va+b[ca]);var d=b[ca][t](/^https?:\/\//,W),e=n.accountchooser.rpc.parseRpcObject(b[u]);if(e)if(e instanceof n.accountchooser.rpc.ManageRequest&&!c)n.accountchooser.util.log(Pb+b[u]);else if(e instanceof n.accountchooser.rpc.IdpReadyNotification)n.accountchooser.rpc.onIdpReady_(d);else if(e instanceof n.accountchooser.rpc.Response)n.accountchooser.rpc.clearTimeoutCallback_(),(d=n.accountchooser.rpc.getIdpCallback_(d,e))?
d[U](n,e,b[ca],d.context):n.accountchooser.util.log(yb+b[u]);else if(e instanceof n.accountchooser.rpc[J]){if(n.accountchooser.rpc.checkCallbackDomain_(e,d))if(d=n.accountchooser.rpc.services_.serviceLoader){if(e instanceof n.accountchooser.rpc[J]&&!c){var f=new n.accountchooser.rpc.RequestAckNotification(e.id_);n.parent[ma](f[B](),b[ca])}d(e,b[ca])}else n.accountchooser.util.log(Wb+e.method_+Va)}else n.accountchooser.util.log(oc+b[u]);else n.accountchooser.util.log(vb+b[u])};
n.accountchooser.rpc.checkCallbackDomain_=function(b,c){var d=b.params_.clientConfig.clientCallbackUrl&&n.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.clientCallbackUrl);return d&&d!==c?(n.accountchooser.util.log(Mb+b.params_.clientConfig.clientCallbackUrl+xa+c+ya),l):(d=b.params_.clientConfig.positiveCallbackUrl&&n.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.positiveCallbackUrl))&&d!==c?(n.accountchooser.util.log(Ob+b.params_.clientConfig.positiveCallbackUrl+xa+c+ya),
l):(d=b.params_.clientConfig.negativeCallbackUrl&&n.accountchooser.util.getDomainFromUrl(b.params_.clientConfig.negativeCallbackUrl))&&d!==c?(n.accountchooser.util.log(Nb+b.params_.clientConfig.negativeCallbackUrl+xa+c+ya),l):j};
n.accountchooser.rpc.initIdp_=function(b,c){var d=[];if(b)for(var e in b){n.accountchooser[M].notEmpty(b[e].iframeUrl,Yc);var f=b[e].iframeUrl,h=n.accountchooser.util.getDomainFromUrl(f);n.accountchooser[M].notEmpty(h,Mc);f={id:e,domain:h,iframe:k,iframeUrl:f,queue:[],idpReady:l};n.accountchooser.rpc.idps[e]=f;n.accountchooser.rpc.idpsIndexedByDomain[h]=f;b[e].preload&&d[I](e)}if(c)for(var m in c)(e=c[m])?n.accountchooser.rpc.idps[e]?n.accountchooser.rpc.emailMapIdp[m]=e:n.accountchooser.util.log(Tb+
m+Aa):n.accountchooser.util.log(Ub+m+Ba);return d};
n.accountchooser.rpc.initCds=function(b){var c;if(b){if(b.rpcs)for(var d in b.rpcs)n.accountchooser.rpc.register(d,b.rpcs[d]);c=n.accountchooser.rpc.initIdp_(b.idps,b.emailMapIdp)}b&&b.popupMode?(n.accountchooser.rpc.popupMode=j,n.accountchooser.rpc.clientWindow=n.opener):(n.accountchooser.rpc.popupMode=l,d=n.accountchooser.rpc.getDomainInHash_(),d||(n.accountchooser.util.log(Ab),a(n.accountchooser.rpc.INVALID_CLIENT_DOMAIN)),n.accountchooser.rpc.clientDomain_=d);n.accountchooser.rpc.init_(n.accountchooser.rpc.process_);
n.accountchooser.rpc.popupMode&&n.accountchooser.rpc.sendCdsReadyNotification_();if(c&&c[N])for(d=0;d<c[N];d++)n.accountchooser.rpc.initIdpIFrame_(c[d]);b&&!b.popupMode&&n.accountchooser.rpc.triggerSavedRpcs_()};
n.accountchooser.rpc.callClient=function(b){n.accountchooser[M].notEmpty(b,zd);n.accountchooser.util.log(gc+b[B]());n.accountchooser.rpc.popupMode?n.accountchooser.rpc.clientWindow[ma](b[B](),ab):n.accountchooser.rpc.clientDomain_?n.accountchooser.rpc.saveRpcObject(n.accountchooser.rpc.clientDomain_,b,l):n.accountchooser.util.log(tb)};n.accountchooser.UiLoader=function(){};Z=n.accountchooser.UiLoader[P];Z.findServiceByLanguage_=function(b,c,d){return!b?k:d&&b[d]&&b[d][c]?b[d][c]:b[c]};
Z.findService_=function(b,c,d,e){var f=k;c&&(b=b.method_,d&&c.mobile&&(f=this.findServiceByLanguage_(c.mobile,b,e)),f||(f=this.findServiceByLanguage_(c.web,b,e)));return f};Z.loadServiceFromWeb=function(){a(nc)};Z.isServiceLoaded=function(){return l};Z.setServiceLoaded=function(){};
Z.loadService=function(b,c,d){var e=n.accountchooser.util.isMobileAgent(aa.userAgent),f=b&&b.params_&&b.params_.clientConfig&&b.params_.clientConfig[O];b=this.findService_(b,c,e,f);n.accountchooser[M].notEmpty(b,Ed);n.accountchooser[M].notEmpty(b[pa],Fd);var h=r[da]({},b,{mobile:!!e,language:f});if(this.isServiceLoaded(h))e=n.accountchooser.util.getNamespacedObjectByString(h[pa]),n.accountchooser[M].notEmpty(e,h[pa]),d(e);else{var m=this;this.loadServiceFromWeb(h,function(){m.setServiceLoaded(h);
var b=n.accountchooser.util.getNamespacedObjectByString(h[pa]);n.accountchooser[M].notEmpty(b,h[pa]);d(b)})}};n.accountchooser.UrlUiLoader=function(){};n.accountchooser.UrlUiLoader.inheritsFrom(n.accountchooser.UiLoader);Z=n.accountchooser.UrlUiLoader[P];Z.getJsFileUrl=function(){a(nc)};Z.getCssFileUrl=function(){a(mc)};Z.isFileLoaded=function(){a(mc)};Z.removeOldCss=function(){a(mc)};Z.removeOldJs=function(){a(mc)};
Z.loadServiceFromWeb=function(b,c){function d(){var d=e.getJsFileUrl(b);e.isFileLoaded(d)?c():(new n.accountchooser.loader.JsLoader)[oa](d,k,function(){e.removeOldJs();c()})}var e=this,f=this.getCssFileUrl(b);this.isFileLoaded(f)?d():(new n.accountchooser.loader.CssLoader)[oa](f,k,function(){e.removeOldCss();d()})};
n.accountchooser.UrlTemplateUiLoader=function(b,c,d){this.jsUrlTemplate_=b;this.cssUrlTemplate_=c;this.defaultLanguage_=n.accountchooser.util.findLanguageCode(d)||Nc;this.cssUrl_=this.jsUrl_=k};n.accountchooser.UrlTemplateUiLoader.inheritsFrom(n.accountchooser.UrlUiLoader);Z=n.accountchooser.UrlTemplateUiLoader[P];Z.getJsFileUrl=function(b){var c=this.getLanguage_(b[O]);return this.jsUrlTemplate_[t](/\{baseFilename\}/,b.baseFilename)[t](/\{language\}/,c)};
Z.getCssFileUrl=function(b){return this.cssUrlTemplate_[t](/\{baseFilename\}/,b.cssBaseFilename)};Z.isFileLoaded=function(b){return!!this.findTag_(b)};Z.isServiceLoaded=function(b){return this.isFileLoaded(this.getJsFileUrl(b))&&this.isFileLoaded(this.getCssFileUrl(b))};Z.setServiceLoaded=function(b){this.jsUrl_=this.getJsFileUrl(b);this.cssUrl_=this.getCssFileUrl(b)};
Z.loadServiceFromWeb=function(b,c){var d=this;n.accountchooser.UrlUiLoader[P].loadServiceFromWeb[U](d,b,function(){c();var e=p[fa](Cc)[0]||p[T],f=e.getAttribute(Hc)||W;d.isRightToLeft_(b)?(e.dir=Ad,f+=wa):(e.dir=id,f=f[t](/rtl/g,W));e[y](Hc,f)})};Z.removeOldTag_=function(b){(b=this.findTag_(b))&&b.parentNode[sa](b)};Z.removeOldCss=function(){this.removeOldTag_(this.cssUrl_)};Z.removeOldJs=function(){this.removeOldTag_(this.jsUrl_)};
Z.findTag_=function(b){if(b)for(var c=(p[fa](Qc)[0]||p[A]).childNodes,d=0,e=c[N];d<e;d++){var f=c.item(d),h=f.nodeName[V]();if(h==Cd&&f.getAttribute(Jd)==b||h==fd&&f.getAttribute(Tc)==b)return f}};Z.getLanguage_=function(b){b=b||n.navigator[O];return b=n.accountchooser.util.findLanguageCode(b)||this.defaultLanguage_};Z.isRightToLeft_=function(b){b=this.getLanguage_(b[O]);return n.accountchooser.util.isRightToLeft(b)};n.accountchooser.AjaxUiLoader=function(){this.loadedPackages_=[]};n.accountchooser.AjaxUiLoader.inheritsFrom(n.accountchooser.UiLoader);
n.accountchooser.AjaxUiLoader[P].stringify=function(b){return b.module+hb+b.version+hb+b.packageName+hb+b[O]};n.accountchooser.AjaxUiLoader[P].loadServiceFromWeb=function(b,c){google[oa](b.module,b.version,{packages:[b.packageName],language:b[O]||n.navigator[O],callback:c})};n.accountchooser.AjaxUiLoader[P].isServiceLoaded=function(b){b=this[K](b);return-1<r[ha](b,this.loadedPackages_)};n.accountchooser.AjaxUiLoader[P].setServiceLoaded=function(b){b=this[K](b);0>r[ha](b,this.loadedPackages_)&&this.loadedPackages_[I](b)};
n.accountchooser.UiHandler=function(){};n.accountchooser.UiHandler.VALID_URL_REGEX_=/^http(s)?:\/\/(localhost|([a-z0-9]([-a-z0-9]*[a-z0-9])?\.)+[a-z0-9]+)(\:\d+)?(\/([^?#]*))?(\?([^#]*))?$/i;Z=n.accountchooser.UiHandler[P];
Z.show=function(b){this.setUp_(b);this.showTitle_();this.showFavIcon_();switch(this.serviceType_){case n.accountchooser.ServiceType.MANAGE:this.showManageContent_();break;case n.accountchooser.ServiceType.SELECT:this.showSelectContent_();break;case n.accountchooser.ServiceType.STORE:this.showStoreContent_();break;case n.accountchooser.ServiceType.UPDATE:this.showUpdateContent_();break;case n.accountchooser.ServiceType.ABOUT:this.showAboutContent_()}this.showFooterContent_();this.initLanguageSelector_();
r(Cc).hide()[na]()};Z.setUp_=function(b){b=b||{};this.title_=b.title;this.favicon_=b.favicon;this.branding_=b.branding;this.cajaMethod_=b.cajaMethod;this.language_=b[O]||Nc;this.accounts_=b.accounts||[];this.domain_=b.domain;this.serviceType_=b.serviceType;this.onLanguageChanged_=b.onLanguageChanged};Z.showTitle_=function(){this.title_&&(p.title=this.title_)};
Z.showFavIcon_=function(){if(this.favicon_&&n.accountchooser.UiHandler.VALID_URL_REGEX_[s](this.favicon_)){for(var b=p[fa](Qc)[0],c=b[fa](fd),d=0;d<c[N];d++){var e=c[d];e.type==Zc&&e.rel==Id&&b[sa](e)}e=p[x](fd);e.type=Zc;e.rel=Id;e.href=this.favicon_;b.appendChild(e)}};
Z.showBrandingContent_=function(){function b(b){var c=r(Ea);b&&c[C](b);c[na]()}if(this.branding_&&n.accountchooser.UiHandler.VALID_URL_REGEX_[s](this.branding_)){var c=this.branding_,c=-1==c[L](X)?c+X:c+Sa,c=c+(dd+this.language_);this.cajaMethod_==Dc?n.accountchooser.caja.cajoleHtml(yc,c,b):n.accountchooser.caja.sanitizeHtml(c,b)}};Z.showSampleAccountChooser_=function(){var b=new n.accountchooser.page.SelectAccountPage,c=r(Ja).empty();b.render(c,g,this.accounts_,g,this.domain_)};
Z.showManageContent_=function(){r(Ha)[C](n.accountchooser[Q].manageContainer.header);r(Ia)[C](n.accountchooser[Q].manageContainer.description)};Z.showSelectContent_=function(){var b=n.accountchooser[Q].selectContainer.header+ua+this.domain_+kb;r(La)[C](b);this.showBrandingContent_();r(Ka)[na]()};
Z.showStoreContent_=function(){var b=this.accounts_&&1<this.accounts_[N],c=n.accountchooser[Q].storeContainer.header,d=n.accountchooser[Q].storeContainer.headerMultiple;r(Na)[C](b?d:c);c=n.accountchooser[Q].storeContainer.description;d=n.accountchooser[Q].storeContainer.descriptionMultiple;r(Oa)[C](b?d:c);var e=n.accountchooser[Q].storeContainer.benefits;r(od).each(function(b,c){b<e[N]&&r(c)[C](e[b])});this.showSampleAccountChooser_();r(Ma)[na]()};
Z.showUpdateContent_=function(){r(Qa)[C](n.accountchooser[Q].updateContainer.header);r(Ra)[C](n.accountchooser[Q].updateContainer.description);r(Pa)[na]()};Z.showAboutContent_=function(){this.title_=n.accountchooser[Q].aboutContainer.title;this.showTitle_();this.showAboutContainerMessages_(ld);this.accounts_=this.getAboutContainerSampleAccounts_();this.showSampleAccountChooser_()};
Z.showAboutContainerMessages_=function(b){var c=n.accountchooser[Q].aboutContainer,d=r(rc+b+za);if(d&&c)for(var e=0;e<d[N];e++){var f=r(d[e]),h=f.attr(Y)[t](b,W);c[h]&&f[C](c[h])}};n.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_=2;n.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_=2;
n.accountchooser.UiHandler[P].getAboutContainerSampleAccounts_=function(){var b=n.accountchooser.util.accountstorage.readAccounts(),c=n.accountchooser.UiHandler.MAX_SAMPLE_ACCOUNTS_COUNT_,d=n.accountchooser.UiHandler.MIN_SAMPLE_ACCOUNTS_COUNT_,e=n.accountchooser[Q].aboutContainer;return b[N]>c?b.slice(0,c):b[N]<d?[e.accountWomanHome,e.accountWomanWork]:b};
n.accountchooser.UiHandler[P].showFooterContent_=function(){r(Fa)[C](n.accountchooser[Q].footerContainer.copyright);var b=n.accountchooser[Q].footerContainer.learnMoreLink;this.language_&&this.language_!=Nc&&(b=0<=b[L](X)?b+(Ta+this.language_):b+(pb+this.language_));var c=n.accountchooser[Q].footerContainer.learnMore;r(Ga)[C](c).attr(Tc,b)};
n.accountchooser.UiHandler[P].initLanguageSelector_=function(){var b=r(Da);b.unbind(Fc);b.val(this.language_);var c=this;b.change(function(){var d=b.val();if(d!=c.language_&&c.onLanguageChanged_)c.onLanguageChanged_(d)})};
var Xd=r,$d={options:{popupMode:l,manageMode:l,aboutMode:l,uiLoader:k,idps:{},emailMapIdp:{},uiHandler:new n.accountchooser.UiHandler,enableCajole:l},loadService_:function(b,c){var d=this;this[H].uiLoader.loadService(b,this[H].services,function(e){d.executeService_(e,b,c)})},executeService_:function(b,c,d){b=new b;b.setContainer(this.element);b.setCdsConfig(this.cdsConfig);b.executeRequest[U](b,c);this.showCustomizedUI_(c,d)},showCustomizedUI_:function(b,c){if(this[H].uiHandler){var d={};if(b&&b.params_&&
b.params_.clientConfig){d=b.params_.clientConfig.ui||d;d.language=n.accountchooser.util.findLanguageCode(b.params_.clientConfig[O]);!this[H].enableCajole&&Dc==d.cajaMethod&&(d.cajaMethod=Bd);d.serviceType=b.method_;d.accounts=n.accountchooser.util.sanitizeAccounts(b.params_.accounts||[],n.accountchooser.util.accountSanitizer);var e=this;d.onLanguageChanged=function(d){b.params_.clientConfig.language=n.accountchooser.util.findLanguageCode(d);e.loadService_(b,c)}}d.language=d[O]||Nc;d.domain=c[t](/^https?:\/\//,
W);this[H].uiHandler[na](d)}},_create:function(){Xd(this.element).empty();this.cdsConfig={popupMode:this[H].popupMode,idps:this[H].idps,emailMapIdp:this[H].emailMapIdp};this.cdsConfig.rpcs={serviceLoader:Xd.proxy(this.loadService_,this)};try{n.accountchooser.rpc.initCds(this.cdsConfig)}catch(b){!this[H].manageMode&&!this[H].aboutMode&&(b==n.accountchooser.rpc.EMPTY_SAVED_RPC||b==n.accountchooser.rpc.INVALID_CLIENT_DOMAIN)?this.redirectEmptyRequest():!this[H].manageMode&&!this[H].aboutMode&&a(b)}this[H].manageMode?
this.showManagePage():this[H].aboutMode&&this.showAboutPage()},redirectEmptyRequest:function(){var b=n.accountchooser.rpc.getDomainInHash_();n[G].href=b&&n.accountchooser.util.isValidUrlDomain(b)?Vc+b:n[G].protocol+db+n[G].host},showManagePage:function(){var b=n.accountchooser.util.browserconfig.isDisabled(),c=n.accountchooser.util.accountstorage.readAccounts();b||!c[N]?this.showLearnMorePage_():this.sendFakeRequest_(n.accountchooser.rpc.ManageRequest,jd)},showAboutPage:function(){this.sendFakeRequest_(n.accountchooser.rpc.AboutRequest,
wc)},sendFakeRequest_:function(b,c){var d={language:n.accountchooser.util.parseUrlParams(n[G].href).lang,clientCallbackUrl:n[G].href},d={data:(new b(c,d))[B](),origin:n[G].host};n.accountchooser.rpc.process_(d,j)},showLearnMorePage_:function(){var b=n.accountchooser.util.parseUrlParams(n[G].href).lang,c=eb;b&&(c=0<=c[L](X)?c+(Ta+b):c+(pb+b));n[G][t](c)},destroy:function(){Xd(this.element).empty();Xd.Widget[P].destroy[U](this)}};Xd.widget("ui.cds",$d);})()
